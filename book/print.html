<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js oranda-dark">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>rsketch</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="Documentation for rsketch - A Rust project template with gRPC and multi-language code generation">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">
        <link rel="stylesheet" href="oranda-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "oranda-dark" : "oranda-dark";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('orandamdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('orandamdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('orandamdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('oranda-dark')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="chapter-item expanded "><a href="01-background.html"><strong aria-hidden="true">1.</strong> Background</a></li><li class="chapter-item expanded "><a href="02-architecture-overview.html"><strong aria-hidden="true">2.</strong> Architecture Overview</a></li><li class="chapter-item expanded "><a href="03-record-manager.html"><strong aria-hidden="true">3.</strong> Table Manager</a></li><li class="chapter-item expanded "><a href="04-core-storage-components.html"><strong aria-hidden="true">4.</strong> Core Storage Components</a></li><li class="chapter-item expanded "><a href="05-file-system-integration.html"><strong aria-hidden="true">5.</strong> File System Integration</a></li><li class="chapter-item expanded "><a href="06-performance-optimization.html"><strong aria-hidden="true">6.</strong> Performance Optimization</a></li><li class="chapter-item expanded "><a href="07-reliability-and-recovery.html"><strong aria-hidden="true">7.</strong> Reliability and Recovery</a></li><li class="chapter-item expanded "><a href="08-configuration-and-api.html"><strong aria-hidden="true">8.</strong> Configuration and API</a></li><li class="chapter-item expanded "><a href="09-monitoring-and-observability.html"><strong aria-hidden="true">9.</strong> Monitoring and Observability</a></li><li class="chapter-item expanded "><a href="10-deployment-and-operations.html"><strong aria-hidden="true">10.</strong> Deployment and Operations</a></li><li class="chapter-item expanded "><a href="11-security.html"><strong aria-hidden="true">11.</strong> Security</a></li><li class="chapter-item expanded "><a href="12-testing-strategy.html"><strong aria-hidden="true">12.</strong> Testing Strategy</a></li><li class="chapter-item expanded "><a href="13-future-enhancements.html"><strong aria-hidden="true">13.</strong> Future Enhancements</a></li><li class="chapter-item expanded "><a href="14-implementation-roadmap.html"><strong aria-hidden="true">14.</strong> Implementation Roadmap</a></li><li class="chapter-item expanded "><a href="15-distributed-architecture.html"><strong aria-hidden="true">15.</strong> Distributed Architecture</a></li><li class="chapter-item expanded "><a href="16-component-design.html"><strong aria-hidden="true">16.</strong> Component Design</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="oranda-dark">Oranda Dark</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="oranda-light">Oranda Light</button></li>

                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">rsketch</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/crrow/rsketch" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="rsketch-storage-engine-documentation"><a class="header" href="#rsketch-storage-engine-documentation">RSketch Storage Engine Documentation</a></h1>
<p>Welcome to the RSketch storage engine documentation. This documentation covers the design and implementation of a high-performance, memory-mapped storage engine optimized for low-latency, high-throughput applications.</p>
<h2 id="what-youll-learn"><a class="header" href="#what-youll-learn">What You'll Learn</a></h2>
<p>This documentation provides comprehensive coverage of:</p>
<ul>
<li><strong>Architecture Design</strong>: Core principles and component overview</li>
<li><strong>Implementation Details</strong>: Record management, storage, and indexing</li>
<li><strong>Performance Optimization</strong>: Memory access patterns, I/O optimization, and concurrency</li>
<li><strong>Operations</strong>: Deployment, monitoring, security, and maintenance</li>
<li><strong>Development</strong>: API design, testing strategies, and implementation roadmap</li>
</ul>
<h2 id="target-audience"><a class="header" href="#target-audience">Target Audience</a></h2>
<p>This documentation is designed for:</p>
<ul>
<li><strong>System Architects</strong> planning high-performance storage solutions</li>
<li><strong>Software Engineers</strong> implementing storage systems</li>
<li><strong>DevOps Engineers</strong> deploying and operating storage infrastructure</li>
<li><strong>Performance Engineers</strong> optimizing system performance</li>
</ul>
<h2 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h2>
<p>Start with the <a href="./01-background.html">Background</a> chapter to understand the problem domain and requirements, then proceed through the documentation in order for a complete understanding of the system design.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="background"><a class="header" href="#background">Background</a></h1>
<h2 id="problem-statement"><a class="header" href="#problem-statement">Problem Statement</a></h2>
<p>In cryptocurrency trading systems, the OrderManager component faces significant performance challenges during high-volume market conditions. When market trends trigger rapid price movements, thousands of users can simultaneously submit orders, creating intense database load. Even with traditional solutions like database sharding and horizontal scaling, the system may still experience latency spikes that cause users to miss time-sensitive trading opportunities.</p>
<p>This document analyzes the storage requirements for a high-performance order management system and proposes optimizations to achieve sub-millisecond latency.</p>
<h2 id="requirements-analysis"><a class="header" href="#requirements-analysis">Requirements Analysis</a></h2>
<h3 id="performance-requirements"><a class="header" href="#performance-requirements">Performance Requirements</a></h3>
<ul>
<li><strong>Latency</strong>: Target p99 latency &lt; 10ms for order operations</li>
<li><strong>Throughput</strong>: Support 100,000+ orders per second during peak trading</li>
<li><strong>Availability</strong>: 99.99% uptime with minimal impact from storage operations</li>
</ul>
<h3 id="data-characteristics"><a class="header" href="#data-characteristics">Data Characteristics</a></h3>
<p>The system primarily handles "live order" data with specific access patterns:</p>
<ol>
<li><strong>Write-Heavy Workload</strong>: Orders are frequently inserted as users place new trades</li>
<li><strong>Read-Heavy Queries</strong>: Users continuously query their active orders and market depth</li>
<li><strong>Rare Updates</strong>: Orders are seldom modified (price adjustments, partial cancellations)</li>
<li><strong>Lifecycle Management</strong>: Completed orders are archived to cold storage (e.g., ClickHouse) for analytics</li>
</ol>
<h3 id="consistency-requirements"><a class="header" href="#consistency-requirements">Consistency Requirements</a></h3>
<ul>
<li><strong>Strong Consistency</strong>: Critical for order placement and matching</li>
<li><strong>Eventual Consistency</strong>: Acceptable for non-critical read operations</li>
<li><strong>Durability</strong>: Orders must survive system crashes without data loss</li>
</ul>
<h2 id="current-architecture-limitations"><a class="header" href="#current-architecture-limitations">Current Architecture Limitations</a></h2>
<h3 id="traditional-rdbms-approach-mysql"><a class="header" href="#traditional-rdbms-approach-mysql">Traditional RDBMS Approach (MySQL)</a></h3>
<p>A typical MySQL-based order management system involves multiple I/O operations per transaction:</p>
<ol>
<li><strong>Network Round-trip</strong>: Application â†” MySQL server communication</li>
<li><strong>Transaction Log (binlog)</strong>: Write-ahead logging for durability</li>
<li><strong>Data Pages</strong>: Actual row data writes to storage</li>
<li><strong>Index Updates</strong>: B-tree index maintenance for quick lookups</li>
<li><strong>Replication</strong>: If using master-slave setup for high availability</li>
</ol>
<p><strong>Total I/O Analysis</strong>:</p>
<ul>
<li>1 network operation (typically 0.1-1ms in local datacenter)</li>
<li>2-4 disk operations (1-10ms each on traditional storage)</li>
<li><strong>Result</strong>: 2-40ms total latency per operation</li>
</ul>
<h3 id="embedded-database-approach-rocksdb"><a class="header" href="#embedded-database-approach-rocksdb">Embedded Database Approach (RocksDB)</a></h3>
<p>While embedded databases eliminate network overhead, they still face challenges:</p>
<p><strong>Advantages</strong>:</p>
<ul>
<li>No network latency between application and storage</li>
<li>Optimized LSM-tree structure for write-heavy workloads</li>
<li>Efficient compression and bloom filters</li>
</ul>
<p><strong>Limitations</strong>:</p>
<ul>
<li>Write-Ahead Log (WAL) still requires disk I/O for durability</li>
<li>Cloud block storage adds network latency (EBS, persistent disks)</li>
<li>LSM compaction can cause periodic latency spikes</li>
</ul>
<h2 id="storage-io-analysis"><a class="header" href="#storage-io-analysis">Storage I/O Analysis</a></h2>
<h3 id="disk-storage-performance"><a class="header" href="#disk-storage-performance">Disk Storage Performance</a></h3>
<ul>
<li><strong>Cloud Block Storage (EBS, GCP PD)</strong>: 1-10ms latency</li>
<li><strong>Local NVMe SSDs</strong>: 0.1-1ms latency</li>
<li><strong>Memory</strong>: 50-100 nanoseconds latency</li>
</ul>
<h3 id="the-io-bottleneck"><a class="header" href="#the-io-bottleneck">The I/O Bottleneck</a></h3>
<p>Storage I/O remains the primary performance bottleneck because:</p>
<ol>
<li><strong>Mechanical Limitations</strong>: Even SSDs have microsecond-level latencies</li>
<li><strong>Durability vs. Performance Trade-off</strong>: WAL writes ensure crash recovery but add latency</li>
<li><strong>Cloud Storage Overhead</strong>: Network-attached storage adds round-trip time</li>
</ol>
<h2 id="ç³»ç»Ÿæ¶æ„åˆ†æ"><a class="header" href="#ç³»ç»Ÿæ¶æ„åˆ†æ">ç³»ç»Ÿæ¶æ„åˆ†æ</a></h2>
<h3 id="ä¼ ç»Ÿæ¶æ„çš„æ ¹æœ¬æ€§å±€é™"><a class="header" href="#ä¼ ç»Ÿæ¶æ„çš„æ ¹æœ¬æ€§å±€é™">ä¼ ç»Ÿæ¶æ„çš„æ ¹æœ¬æ€§å±€é™</a></h3>
<p>ä¼ ç»Ÿæ•°æ®åº“æ¶æ„åœ¨äº¤æ˜“ç³»ç»Ÿåœºæ™¯ä¸‹å­˜åœ¨ä»¥ä¸‹æ ¹æœ¬æ€§é—®é¢˜ï¼š</p>
<h4 id="å¤šå±‚æŠ½è±¡å¼€é”€"><a class="header" href="#å¤šå±‚æŠ½è±¡å¼€é”€">å¤šå±‚æŠ½è±¡å¼€é”€</a></h4>
<pre><code>ä¼ ç»Ÿæ•°æ®åº“è¯·æ±‚è·¯å¾„:
åº”ç”¨ç¨‹åº â†’ SQLè§£æ â†’ æŸ¥è¯¢ä¼˜åŒ– â†’ æ‰§è¡Œè®¡åˆ’ â†’ å­˜å‚¨å¼•æ“ â†’ ç¼“å†²æ±  â†’ ç£ç›˜I/O
æ¯ä¸€å±‚éƒ½å¢åŠ å»¶è¿Ÿ: ~500Î¼s + ~200Î¼s + ~300Î¼s + ~100Î¼s + ~50Î¼s + ~2ms = ~3.15ms
</code></pre>
<h4 id="é€šç”¨æ€§-vs-ä¸“ç”¨æ€§æƒè¡¡"><a class="header" href="#é€šç”¨æ€§-vs-ä¸“ç”¨æ€§æƒè¡¡">é€šç”¨æ€§ vs ä¸“ç”¨æ€§æƒè¡¡</a></h4>
<ul>
<li><strong>é€šç”¨æ•°æ®åº“</strong>: è®¾è®¡ä¸ºæ”¯æŒå„ç§å·¥ä½œè´Ÿè½½ï¼Œä½†åœ¨ç‰¹å®šåœºæ™¯ä¸‹ä¸å¤Ÿä¼˜åŒ–</li>
<li><strong>äº¤æ˜“ç³»ç»Ÿéœ€æ±‚</strong>: é«˜åº¦ä¸“é—¨åŒ–çš„æ•°æ®è®¿é—®æ¨¡å¼å’Œæ€§èƒ½è¦æ±‚</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>: ä¸ºç‰¹å®šå·¥ä½œè´Ÿè½½å®šåˆ¶å­˜å‚¨å¼•æ“</li>
</ul>
<h3 id="æ€§èƒ½ç“¶é¢ˆæ·±åº¦åˆ†æ"><a class="header" href="#æ€§èƒ½ç“¶é¢ˆæ·±åº¦åˆ†æ">æ€§èƒ½ç“¶é¢ˆæ·±åº¦åˆ†æ</a></h3>
<h4 id="å»¶è¿Ÿåˆ†è§£åˆ†æ"><a class="header" href="#å»¶è¿Ÿåˆ†è§£åˆ†æ">å»¶è¿Ÿåˆ†è§£åˆ†æ</a></h4>
<p>é’ˆå¯¹p99 &lt; 10msçš„ç›®æ ‡ï¼Œæˆ‘ä»¬éœ€è¦åˆ†è§£æ¯ä¸ªç»„ä»¶çš„å»¶è¿Ÿè´¡çŒ®ï¼š</p>
<pre><code>ç›®æ ‡å»¶è¿Ÿé¢„ç®—åˆ†é…:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ€»ç›®æ ‡å»¶è¿Ÿ: 10ms (å†…ç½‘ä¼˜åŒ–)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç½‘ç»œä¼ è¾“:     0.1ms (1%)                â”‚
â”‚ æ¥å£å±‚:       0.5ms (5%)                â”‚
â”‚ å­˜å‚¨å¼•æ“:     6ms (60%)                 â”‚
â”‚ æŒä¹…åŒ–å±‚:     0.5ms (5%)                â”‚
â”‚ ç¡¬ä»¶å±‚:       0.4ms (4%)                â”‚
â”‚ ç¼“å†²æ—¶é—´:     2.5ms (25%)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 id="ioå»¶è¿Ÿå±‚æ¬¡åˆ†æ"><a class="header" href="#ioå»¶è¿Ÿå±‚æ¬¡åˆ†æ">I/Oå»¶è¿Ÿå±‚æ¬¡åˆ†æ</a></h4>
<pre><code>å­˜å‚¨ä»‹è´¨å»¶è¿Ÿå¯¹æ¯”:
CPU L1ç¼“å­˜:     ~1ns     (åŸºå‡†)
CPU L2ç¼“å­˜:     ~3ns     (3x)
CPU L3ç¼“å­˜:     ~12ns    (12x)
ç³»ç»Ÿå†…å­˜:       ~100ns   (100x)
æœ¬åœ°NVMe SSD:   ~25Î¼s    (25,000x)
ç½‘ç»œSSD:       ~100Î¼s   (100,000x)
SATA SSD:      ~500Î¼s   (500,000x)
æœºæ¢°ç¡¬ç›˜:      ~10ms    (10,000,000x)
</code></pre>
<h3 id="æ¶æ„è®¾è®¡åŸåˆ™"><a class="header" href="#æ¶æ„è®¾è®¡åŸåˆ™">æ¶æ„è®¾è®¡åŸåˆ™</a></h3>
<h4 id="1-åˆ†å±‚ä¼˜åŒ–ç­–ç•¥"><a class="header" href="#1-åˆ†å±‚ä¼˜åŒ–ç­–ç•¥">1. åˆ†å±‚ä¼˜åŒ–ç­–ç•¥</a></h4>
<pre><code>æ€§èƒ½ä¼˜åŒ–è·¯å¾„å›¾:
é˜¶æ®µ1: æ¶ˆé™¤SQLå±‚ (50ms â†’ 10ms)
  â”œâ”€â”€ ç›´æ¥äºŒè¿›åˆ¶åè®®
  â”œâ”€â”€ é¢„ç¼–è¯‘æŸ¥è¯¢
  â””â”€â”€ è¿æ¥æ± ä¼˜åŒ–

é˜¶æ®µ2: å†…å­˜åŒ–å­˜å‚¨ (10ms â†’ 5ms)
  â”œâ”€â”€ å†…å­˜æ˜ å°„æ–‡ä»¶
  â”œâ”€â”€ é›¶æ‹·è´I/O
  â””â”€â”€ å›ºå®šå¤§å°è®°å½•

é˜¶æ®µ3: ç¡¬ä»¶ä¼˜åŒ– (5ms â†’ 2ms)
  â”œâ”€â”€ CPUç¼“å­˜å¯¹é½
  â”œâ”€â”€ NUMAæ„ŸçŸ¥åˆ†é…
  â””â”€â”€ æ‰¹å¤„ç†æ“ä½œ
</code></pre>
<h4 id="2-ä¸“ç”¨åŒ–è®¾è®¡ç†å¿µ"><a class="header" href="#2-ä¸“ç”¨åŒ–è®¾è®¡ç†å¿µ">2. ä¸“ç”¨åŒ–è®¾è®¡ç†å¿µ</a></h4>
<ul>
<li><strong>å•ä¸€èŒè´£</strong>: æ¯ä¸ªè¡¨ä¸“é—¨å­˜å‚¨ä¸€ç§ä¸šåŠ¡å¯¹è±¡</li>
<li><strong>å›ºå®šç»“æ„</strong>: æ¶ˆé™¤åŠ¨æ€å†…å­˜åˆ†é…å’Œç¢ç‰‡åŒ–</li>
<li><strong>ç±»å‹å®‰å…¨</strong>: ç¼–è¯‘æ—¶ç¡®å®šçš„æ•°æ®ç»“æ„</li>
<li><strong>ç›´æ¥è®¿é—®</strong>: ç»•è¿‡ä¼ ç»Ÿæ•°æ®åº“çš„æŠ½è±¡å±‚</li>
</ul>
<h2 id="è§£å†³æ–¹æ¡ˆæ¶æ„æ¦‚è¿°"><a class="header" href="#è§£å†³æ–¹æ¡ˆæ¶æ„æ¦‚è¿°">è§£å†³æ–¹æ¡ˆæ¶æ„æ¦‚è¿°</a></h2>
<h3 id="æ ¸å¿ƒè®¾è®¡å“²å­¦"><a class="header" href="#æ ¸å¿ƒè®¾è®¡å“²å­¦">æ ¸å¿ƒè®¾è®¡å“²å­¦</a></h3>
<h4 id="memory-firstæ¶æ„"><a class="header" href="#memory-firstæ¶æ„">Memory-Firstæ¶æ„</a></h4>
<ul>
<li><strong>çƒ­æ•°æ®å¸¸é©»å†…å­˜</strong>: æ´»è·ƒäº¤æ˜“æ•°æ®å®Œå…¨å­˜åœ¨RAMä¸­</li>
<li><strong>åˆ†å±‚å­˜å‚¨</strong>: çƒ­/æ¸©/å†·æ•°æ®è‡ªåŠ¨åˆ†å±‚ç®¡ç†</li>
<li><strong>å¼‚æ­¥æŒä¹…åŒ–</strong>: å°†æŒä¹…åŒ–ä»å…³é”®è·¯å¾„ä¸­è§£è€¦</li>
</ul>
<h4 id="ç¡¬ä»¶æ„ŸçŸ¥è®¾è®¡"><a class="header" href="#ç¡¬ä»¶æ„ŸçŸ¥è®¾è®¡">ç¡¬ä»¶æ„ŸçŸ¥è®¾è®¡</a></h4>
<ul>
<li><strong>NUMAæ‹“æ‰‘æ„ŸçŸ¥</strong>: æ•°æ®å’Œè®¡ç®—ç»‘å®šåˆ°ç›¸åŒNUMAèŠ‚ç‚¹</li>
<li><strong>CPUç¼“å­˜å‹å¥½</strong>: æ•°æ®ç»“æ„å¯¹é½åˆ°ç¼“å­˜è¡Œè¾¹ç•Œ</li>
<li><strong>å­˜å‚¨ä»‹è´¨ä¼˜åŒ–</strong>: é’ˆå¯¹NVMe SSDç‰¹æ€§ä¼˜åŒ–I/Oæ¨¡å¼</li>
</ul>
<h4 id="ä¸“ç”¨å­˜å‚¨å¼•æ“"><a class="header" href="#ä¸“ç”¨å­˜å‚¨å¼•æ“">ä¸“ç”¨å­˜å‚¨å¼•æ“</a></h4>
<ul>
<li><strong>è¡¨é©±åŠ¨æ¶æ„</strong>: æ¯ç§ä¸šåŠ¡å¯¹è±¡ä¸€ä¸ªä¸“ç”¨è¡¨</li>
<li><strong>é›¶æŠ½è±¡å¼€é”€</strong>: ç›´æ¥å†…å­˜è®¿é—®ï¼Œæ— åºåˆ—åŒ–</li>
<li><strong>ç¼–è¯‘æ—¶ä¼˜åŒ–</strong>: åˆ©ç”¨Rusté›¶æˆæœ¬æŠ½è±¡ç‰¹æ€§</li>
</ul>
<h3 id="ç³»ç»Ÿåˆ†å±‚æ¶æ„"><a class="header" href="#ç³»ç»Ÿåˆ†å±‚æ¶æ„">ç³»ç»Ÿåˆ†å±‚æ¶æ„</a></h3>
<pre><code>FileStoreå­˜å‚¨å¼•æ“åˆ†å±‚è®¾è®¡:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒ æ¥å£å±‚ (API Gateway Layer)           â”‚
â”‚   - gRPC/HTTPå¤šåè®®æ”¯æŒ                 â”‚
â”‚   - è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡å‘ç°                   â”‚
â”‚   - è®¤è¯æˆæƒå’Œé™æµ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¼ ä¸šåŠ¡æœåŠ¡å±‚ (Business Service Layer)  â”‚
â”‚   - è®¢å•ç”Ÿå‘½å‘¨æœŸç®¡ç†                     â”‚
â”‚   - ä¸šåŠ¡è§„åˆ™éªŒè¯                         â”‚
â”‚   - äº‹ä»¶å‘å¸ƒå’ŒçŠ¶æ€ç®¡ç†                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”§ æ•°æ®æœåŠ¡å±‚ (Data Service Layer)      â”‚
â”‚   - è¡¨ç®¡ç†å’ŒæŸ¥è¯¢æ‰§è¡Œ                     â”‚
â”‚   - äº‹åŠ¡åè°ƒå’ŒMVCC                      â”‚
â”‚   - ç´¢å¼•ç®¡ç†å’Œä¼˜åŒ–                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ—ï¸ å­˜å‚¨å¼•æ“å±‚ (Storage Engine Layer)    â”‚
â”‚   - å†…å­˜æ± ç®¡ç†å’Œé¡µé¢åˆ†é…                 â”‚
â”‚   - å¹¶å‘æ§åˆ¶å’Œé”ç®¡ç†                     â”‚
â”‚   - ç‰ˆæœ¬é“¾å’Œåƒåœ¾å›æ”¶                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¾ æŒä¹…åŒ–å±‚ (Persistence Layer)        â”‚
â”‚   - WALå’Œå¿«ç…§ç®¡ç†                       â”‚
â”‚   - å¼‚æ­¥åˆ·ç›˜å’Œæ¢å¤                       â”‚
â”‚   - å¤‡ä»½å’Œå½’æ¡£                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš¡ ç¡¬ä»¶æŠ½è±¡å±‚ (Hardware Layer)          â”‚
â”‚   - NVMeç›´æ¥è®¿é—®                        â”‚
â”‚   - NUMAå†…å­˜ç®¡ç†                        â”‚
â”‚   - CPUç¼“å­˜ä¼˜åŒ–                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 id="å…³é”®æŠ€æœ¯å†³ç­–"><a class="header" href="#å…³é”®æŠ€æœ¯å†³ç­–">å…³é”®æŠ€æœ¯å†³ç­–</a></h3>
<h4 id="1-å†…å­˜æ˜ å°„-vs-ä¼ ç»Ÿio"><a class="header" href="#1-å†…å­˜æ˜ å°„-vs-ä¼ ç»Ÿio">1. å†…å­˜æ˜ å°„ vs ä¼ ç»ŸI/O</a></h4>
<p><strong>é€‰æ‹©</strong>: å†…å­˜æ˜ å°„æ–‡ä»¶ (mmap)
<strong>ç†ç”±</strong>:</p>
<ul>
<li>æ¶ˆé™¤ç”¨æˆ·æ€/å†…æ ¸æ€åˆ‡æ¢å¼€é”€</li>
<li>åˆ©ç”¨OSé¡µé¢ç¼“å­˜æœºåˆ¶</li>
<li>æ”¯æŒé›¶æ‹·è´æ•°æ®è®¿é—®</li>
<li>è‡ªåŠ¨å†…å­˜ç®¡ç†å’Œæ¢é¡µ</li>
</ul>
<h4 id="2-å›ºå®š-vs-å˜é•¿è®°å½•"><a class="header" href="#2-å›ºå®š-vs-å˜é•¿è®°å½•">2. å›ºå®š vs å˜é•¿è®°å½•</a></h4>
<p><strong>é€‰æ‹©</strong>: å›ºå®šå¤§å°è®°å½•
<strong>ç†ç”±</strong>:</p>
<ul>
<li>æ¶ˆé™¤å†…å­˜ç¢ç‰‡åŒ–</li>
<li>O(1)åœ°å€è®¡ç®—</li>
<li>é«˜æ•ˆçš„å†…å­˜é¢„å–</li>
<li>ç®€åŒ–å¹¶å‘æ§åˆ¶</li>
</ul>
<h4 id="3-åŒæ­¥-vs-å¼‚æ­¥æŒä¹…åŒ–"><a class="header" href="#3-åŒæ­¥-vs-å¼‚æ­¥æŒä¹…åŒ–">3. åŒæ­¥ vs å¼‚æ­¥æŒä¹…åŒ–</a></h4>
<p><strong>é€‰æ‹©</strong>: æ··åˆç­–ç•¥
<strong>å…³é”®è·¯å¾„</strong>: åŒæ­¥åˆ°WAL (æœ¬åœ°NVMe, ~500Î¼s)
<strong>æ•°æ®æ–‡ä»¶</strong>: å¼‚æ­¥åˆ·ç›˜ (åå°æ‰¹é‡å†™å…¥)
<strong>å¿«ç…§</strong>: å®šæœŸå¼‚æ­¥å¿«ç…§ (ä¸é˜»å¡ä¸šåŠ¡)</p>
<h2 id="ä¸‹ä¸€æ­¥è®¾è®¡ç»†èŠ‚"><a class="header" href="#ä¸‹ä¸€æ­¥è®¾è®¡ç»†èŠ‚">ä¸‹ä¸€æ­¥è®¾è®¡ç»†èŠ‚</a></h2>
<p>The following sections will detail our approach to building a low-latency, persistent storage system that meets these requirements through:</p>
<ol>
<li><strong>åˆ†å±‚æ¶æ„è®¾è®¡</strong>: è¯¦ç»†çš„ç»„ä»¶èŒè´£åˆ’åˆ†å’Œæ¥å£å®šä¹‰</li>
<li><strong>å­˜å‚¨å¼•æ“æ ¸å¿ƒ</strong>: å†…å­˜ç®¡ç†ã€ç´¢å¼•ç³»ç»Ÿã€å¹¶å‘æ§åˆ¶çš„å…·ä½“å®ç°</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</strong>: ä»ç¡¬ä»¶åˆ°åº”ç”¨å±‚çš„å…¨æ ˆä¼˜åŒ–æ–¹æ¡ˆ</li>
<li><strong>åˆ†å¸ƒå¼ç³»ç»Ÿè€ƒè™‘</strong>: å¯æ‰©å±•æ€§ã€ä¸€è‡´æ€§ã€å®¹é”™æ€§çš„å¹³è¡¡è®¾è®¡</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="filestoreåˆ†å±‚æ¶æ„è®¾è®¡"><a class="header" href="#filestoreåˆ†å±‚æ¶æ„è®¾è®¡">FileStoreåˆ†å±‚æ¶æ„è®¾è®¡</a></h1>
<h2 id="æ¶æ„æ€»è§ˆ"><a class="header" href="#æ¶æ„æ€»è§ˆ">æ¶æ„æ€»è§ˆ</a></h2>
<p>FileStoreæ˜¯ä¸€ä¸ªä¸“ä¸ºäº¤æ˜“ç³»ç»Ÿè®¾è®¡çš„é«˜æ€§èƒ½å­˜å‚¨å¼•æ“ï¼Œé‡‡ç”¨åˆ†å±‚æ¶æ„æ¥å®ç°äºšæ¯«ç§’çº§å»¶è¿Ÿå’Œé«˜ååé‡ã€‚ç³»ç»ŸåŸºäºå†…å­˜æ˜ å°„æŠ€æœ¯ï¼Œé€šè¿‡ç¡¬ä»¶æ„ŸçŸ¥ä¼˜åŒ–å’Œä¸“ç”¨æ•°æ®ç»“æ„æ¥è¾¾åˆ°æè‡´æ€§èƒ½ã€‚</p>
<h2 id="æ ¸å¿ƒè®¾è®¡å“²å­¦-1"><a class="header" href="#æ ¸å¿ƒè®¾è®¡å“²å­¦-1">æ ¸å¿ƒè®¾è®¡å“²å­¦</a></h2>
<h3 id="1-ç®€åŒ–æ¶æ„åŸåˆ™"><a class="header" href="#1-ç®€åŒ–æ¶æ„åŸåˆ™">1. ç®€åŒ–æ¶æ„åŸåˆ™</a></h3>
<p>é’ˆå¯¹å†…ç½‘ç¯å¢ƒå’Œçº¯å­˜å‚¨éœ€æ±‚ï¼Œé‡‡ç”¨å››å±‚ç²¾ç®€æ¶æ„ï¼š</p>
<ul>
<li><strong>æ¥å£å±‚</strong>: é«˜æ€§èƒ½é€šä¿¡æ¥å£ (gRPC/TCP)</li>
<li><strong>å­˜å‚¨å¼•æ“å±‚</strong>: æ ¸å¿ƒæ•°æ®ç®¡ç†å’Œç´¢å¼•</li>
<li><strong>æŒä¹…åŒ–å±‚</strong>: é«˜æ•ˆWALå’Œå¼‚æ­¥åˆ·ç›˜</li>
<li><strong>ç¡¬ä»¶å±‚</strong>: ç›´æ¥ç¡¬ä»¶è®¿é—®ä¼˜åŒ–</li>
</ul>
<h3 id="2-æè‡´æ€§èƒ½ç†å¿µ"><a class="header" href="#2-æè‡´æ€§èƒ½ç†å¿µ">2. æè‡´æ€§èƒ½ç†å¿µ</a></h3>
<ul>
<li><strong>é›¶ä¸šåŠ¡å¼€é”€</strong>: æ— ä¸šåŠ¡é€»è¾‘å±‚ï¼Œç›´è¾¾å­˜å‚¨å¼•æ“</li>
<li><strong>é›¶æŠ½è±¡å¼€é”€</strong>: ç›´æ¥å†…å­˜è®¿é—®ï¼Œæ¶ˆé™¤åºåˆ—åŒ–å¼€é”€</li>
<li><strong>ç¼–è¯‘æ—¶ä¼˜åŒ–</strong>: åˆ©ç”¨Rusté›¶æˆæœ¬æŠ½è±¡</li>
<li><strong>ç¡¬ä»¶ç›´é€š</strong>: ç»•è¿‡OSå±‚ï¼Œç›´æ¥è®¿é—®NVMeå’Œå†…å­˜</li>
</ul>
<h2 id="å››å±‚ç²¾ç®€æ¶æ„è®¾è®¡"><a class="header" href="#å››å±‚ç²¾ç®€æ¶æ„è®¾è®¡">å››å±‚ç²¾ç®€æ¶æ„è®¾è®¡</a></h2>
<h3 id="æ¶æ„æ€»è§ˆå›¾"><a class="header" href="#æ¶æ„æ€»è§ˆå›¾">æ¶æ„æ€»è§ˆå›¾</a></h3>
<pre><code class="language-mermaid">graph TB
    subgraph "FileStore ç®€åŒ–æ¶æ„ (å†…ç½‘ç¯å¢ƒ)"
        subgraph "ç¬¬ä¸€å±‚ï¼šé«˜æ€§èƒ½æ¥å£å±‚"
            INT[åè®®å¤„ç†å™¨&lt;br/&gt;gRPC/TCPç›´è¿]
            CONN[è¿æ¥ç®¡ç†å™¨&lt;br/&gt;é›¶æ‹·è´ç¼“å†²åŒº]
            MON[åŸºç¡€ç›‘æ§&lt;br/&gt;å»¶è¿Ÿ/QPSç»Ÿè®¡]
        end

        subgraph "ç¬¬äºŒå±‚ï¼šå­˜å‚¨å¼•æ“æ ¸å¿ƒ"
            subgraph "è¡¨ç®¡ç†å¼•æ“"
                TBL[è¡¨æ³¨å†Œä¸­å¿ƒ]
                CRUD[è®°å½•CRUDå¼•æ“]
                QE[æŸ¥è¯¢æ‰§è¡Œå™¨]
                CACHE[ç»“æœç¼“å­˜]
            end
            
            subgraph "ç´¢å¼•ç³»ç»Ÿ"
                PI[ä¸»ç´¢å¼•å¼•æ“&lt;br/&gt;RecordIDâ†’Slot]
                SI[äºŒçº§ç´¢å¼•å¼•æ“&lt;br/&gt;Fieldâ†’RecordIDs]
                IDX_CACHE[ç´¢å¼•ç¼“å­˜]
                OPT[æŸ¥è¯¢ä¼˜åŒ–å™¨]
            end
            
            subgraph "å¹¶å‘æ§åˆ¶å¼•æ“"
                MVCC[MVCCç‰ˆæœ¬ç®¡ç†]
                LOCK[æ— é”æ•°æ®ç»“æ„]
                TXN[äº‹åŠ¡åè°ƒå™¨]
                DEAD[æ­»é”æ£€æµ‹å™¨]
            end
            
            subgraph "å†…å­˜ç®¡ç†å¼•æ“"
                NUMA[NUMAæ„ŸçŸ¥åˆ†é…å™¨]
                PAGE[é¡µé¢åˆ†é…å™¨]
                POOL[å†…å­˜æ± ç®¡ç†å™¨]
                HOT[çƒ­ç‚¹æ•°æ®ç®¡ç†]
            end
        end

        subgraph "ç¬¬ä¸‰å±‚ï¼šé«˜æ•ˆæŒä¹…åŒ–å±‚"
            subgraph "æé€ŸWALå¼•æ“"
                WAL_WRITE[ç›´æ¥NVMeå†™å…¥]
                WAL_BATCH[æ‰¹é‡æ—¥å¿—å†™å…¥]
                WAL_ZERO[é›¶æ‹·è´æ—¥å¿—ç¼“å†²]
            end
            
            subgraph "æ™ºèƒ½åˆ·ç›˜ç®¡ç†å™¨"
                FLUSH_BATCH[é¡µé¢çº§æ‰¹é‡åˆ·ç›˜]
                FLUSH_ASYNC[åå°å¼‚æ­¥åˆ·ç›˜]
                FLUSH_PRIORITY[çƒ­é¡µé¢ä¼˜å…ˆçº§]
            end
            
            subgraph "å¿«é€Ÿæ¢å¤å¼•æ“"
                CHECKPOINT[å¢é‡æ£€æŸ¥ç‚¹]
                RECOVERY[å¹¶è¡Œæ¢å¤]
                SNAPSHOT[å†…å­˜å¿«ç…§]
            end
        end

        subgraph "ç¬¬å››å±‚ï¼šç¡¬ä»¶ç›´é€šå±‚"
            subgraph "ç”¨æˆ·æ€å­˜å‚¨å¼•æ“"
                SPDK[SPDK NVMeé©±åŠ¨]
                IOQUEUE[ç”¨æˆ·æ€I/Oé˜Ÿåˆ—]
                DMA[ç›´æ¥å†…å­˜è®¿é—®]
            end
            
            subgraph "NUMAå†…å­˜ä¼˜åŒ–å™¨"
                LOCAL_MEM[æœ¬åœ°å†…å­˜åˆ†é…]
                CROSS_MIN[è·¨èŠ‚ç‚¹è®¿é—®æœ€å°åŒ–]
                HUGE_PAGE[å¤§é¡µé¢ç®¡ç†]
            end
            
            subgraph "CPUæ€§èƒ½åŠ é€Ÿå™¨"
                CACHE_ALIGN[ç¼“å­˜è¡Œå¯¹é½]
                SIMD[SIMDå‘é‡åŒ–]
                THREAD_BIND[çº¿ç¨‹CPUç»‘å®š]
            end
        end
    end

    INT --&gt; TBL
    CONN --&gt; CRUD
    MON --&gt; QE
    
    TBL --&gt; PI
    CRUD --&gt; SI
    QE --&gt; IDX_CACHE
    CACHE --&gt; OPT
    
    PI --&gt; MVCC
    SI --&gt; LOCK
    IDX_CACHE --&gt; TXN
    OPT --&gt; DEAD
    
    MVCC --&gt; NUMA
    LOCK --&gt; PAGE
    TXN --&gt; POOL
    DEAD --&gt; HOT
    
    NUMA --&gt; WAL_WRITE
    PAGE --&gt; WAL_BATCH
    POOL --&gt; WAL_ZERO
    HOT --&gt; FLUSH_BATCH
    
    WAL_WRITE --&gt; SPDK
    WAL_BATCH --&gt; IOQUEUE
    FLUSH_BATCH --&gt; DMA
    FLUSH_ASYNC --&gt; LOCAL_MEM
    
    SPDK --&gt; CACHE_ALIGN
    IOQUEUE --&gt; SIMD
    DMA --&gt; THREAD_BIND
</code></pre>
<h3 id="æ¶æ„æ¼”è¿›å¯¹æ¯”"><a class="header" href="#æ¶æ„æ¼”è¿›å¯¹æ¯”">æ¶æ„æ¼”è¿›å¯¹æ¯”</a></h3>
<pre><code class="language-mermaid">graph LR
    subgraph "æ¶æ„ç®€åŒ–å¯¹æ¯” - å»¶è¿Ÿä¼˜åŒ–"
        subgraph "åŸå…­å±‚æ¶æ„ (å¤æ‚ä¸šåŠ¡ç³»ç»Ÿ)"
            A1[ç½‘ç»œä¼ è¾“: 2ms]
            A2[APIç½‘å…³: 1ms]
            A3[ä¸šåŠ¡æœåŠ¡: 2ms]
            A4[æ•°æ®æœåŠ¡: 3ms]
            A5[å­˜å‚¨å¼•æ“: 2ms]
            A6[æŒä¹…åŒ–å±‚: 1ms]
            A7[ç¡¬ä»¶å±‚: 1ms]
            TOTAL_A[æ€»å»¶è¿Ÿ: 12ms]
        end

        subgraph "æ–°å››å±‚æ¶æ„ (å†…ç½‘å­˜å‚¨å¼•æ“)"
            B1[ç½‘ç»œä¼ è¾“: 0.1ms]
            B2[æ¥å£å±‚: 0.5ms]
            B3[å­˜å‚¨å¼•æ“: 6ms]
            B4[æŒä¹…åŒ–å±‚: 0.5ms]
            B5[ç¡¬ä»¶å±‚: 0.4ms]
            BUFFER[ç¼“å†²æ—¶é—´: 2.5ms]
            TOTAL_B[æ€»å»¶è¿Ÿ: 10ms&lt;br/&gt;å®é™…å¯è¾¾: 7.5ms]
        end

        subgraph "æ€§èƒ½æå‡åˆ†æ"
            IMPROVE1[ç½‘ç»œä¼˜åŒ–: 20xæå‡&lt;br/&gt;2ms â†’ 0.1ms]
            IMPROVE2[ä¸šåŠ¡ç®€åŒ–: å»é™¤3ms&lt;br/&gt;ä¸šåŠ¡é€»è¾‘å¼€é”€]
            IMPROVE3[å­˜å‚¨ä¼˜åŒ–: é›†ä¸­åŒ–&lt;br/&gt;60%è®¡ç®—é¢„ç®—]
            IMPROVE4[I/Oä¼˜åŒ–: 2.5xæå‡&lt;br/&gt;ç”¨æˆ·æ€ç›´é€š]
        end
    end

    A1 --&gt; A2 --&gt; A3 --&gt; A4 --&gt; A5 --&gt; A6 --&gt; A7 --&gt; TOTAL_A
    B1 --&gt; B2 --&gt; B3 --&gt; B4 --&gt; B5 --&gt; BUFFER --&gt; TOTAL_B
    
    A1 -.-&gt; IMPROVE1
    A3 -.-&gt; IMPROVE2
    A5 -.-&gt; IMPROVE3
    A6 -.-&gt; IMPROVE4
</code></pre>
<h3 id="-ç¬¬ä¸€å±‚é«˜æ€§èƒ½æ¥å£å±‚-high-performance-interface-layer"><a class="header" href="#-ç¬¬ä¸€å±‚é«˜æ€§èƒ½æ¥å£å±‚-high-performance-interface-layer">âš¡ ç¬¬ä¸€å±‚ï¼šé«˜æ€§èƒ½æ¥å£å±‚ (High-Performance Interface Layer)</a></h3>
<p><strong>æ ¸å¿ƒèŒè´£</strong>:</p>
<ul>
<li>æç®€é€šä¿¡åè®® (ä¼˜åŒ–çš„gRPC/ç›´æ¥TCP)</li>
<li>é›¶æ‹·è´æ•°æ®ä¼ è¾“</li>
<li>è¿æ¥æ± å’Œä¼šè¯å¤ç”¨</li>
<li>åŸºç¡€ç›‘æ§å’Œåº¦é‡</li>
</ul>
<p><strong>ç®€åŒ–ç»„ä»¶</strong>:</p>
<pre><code>High-Performance Interface
â”œâ”€â”€ åè®®å¤„ç†å™¨ (Protocol Handler)
â”‚   â”œâ”€â”€ ä¼˜åŒ–gRPCæœåŠ¡ (æœ€å°åŒ–åºåˆ—åŒ–)
â”‚   â”œâ”€â”€ ç›´æ¥TCPé€šä¿¡ (ç»•è¿‡HTTPå¼€é”€)
â”‚   â””â”€â”€ å…±äº«å†…å­˜IPC (åŒæœºéƒ¨ç½²)
â”œâ”€â”€ è¿æ¥ç®¡ç†å™¨ (Connection Manager)
â”‚   â”œâ”€â”€ è¿æ¥æ±  (é¿å…è¿æ¥å»ºç«‹å¼€é”€)
â”‚   â”œâ”€â”€ ä¼šè¯å¤ç”¨ (æ‰¹é‡è¯·æ±‚)
â”‚   â””â”€â”€ é›¶æ‹·è´ç¼“å†²åŒºç®¡ç†
â””â”€â”€ æ€§èƒ½ç›‘æ§ (Minimal Metrics)
    â”œâ”€â”€ å»¶è¿Ÿç»Ÿè®¡ (P50/P99)
    â”œâ”€â”€ ååé‡è®¡æ•° (QPS)
    â””â”€â”€ é”™è¯¯ç‡ç›‘æ§
</code></pre>
<p><strong>æè‡´æ€§èƒ½è®¾è®¡</strong>:</p>
<ul>
<li><strong>å»¶è¿Ÿç›®æ ‡</strong>: &lt; 500Î¼s (5%çš„æ€»å»¶è¿Ÿé¢„ç®—)</li>
<li><strong>é›¶ä¸šåŠ¡é€»è¾‘</strong>: ç›´æ¥è·¯ç”±åˆ°å­˜å‚¨å¼•æ“</li>
<li><strong>é›¶æ‹·è´</strong>: å†…å­˜æ˜ å°„ + ç›´æ¥æŒ‡é’ˆä¼ é€’</li>
<li><strong>æ‰¹é‡å¤„ç†</strong>: å¤šè¯·æ±‚æ‰¹é‡æ‰§è¡Œ</li>
</ul>
<h3 id="-ç¬¬äºŒå±‚å­˜å‚¨å¼•æ“æ ¸å¿ƒ-storage-engine-core"><a class="header" href="#-ç¬¬äºŒå±‚å­˜å‚¨å¼•æ“æ ¸å¿ƒ-storage-engine-core">ğŸ—ï¸ ç¬¬äºŒå±‚ï¼šå­˜å‚¨å¼•æ“æ ¸å¿ƒ (Storage Engine Core)</a></h3>
<p><strong>æ ¸å¿ƒèŒè´£</strong>:</p>
<ul>
<li>è¡¨ç®¡ç†å’Œè®°å½•æ“ä½œ (æ•´åˆåŸæ•°æ®æœåŠ¡å±‚åŠŸèƒ½)</li>
<li>é«˜æ€§èƒ½ç´¢å¼•ç³»ç»Ÿå’ŒæŸ¥è¯¢æ‰§è¡Œ</li>
<li>MVCCå¹¶å‘æ§åˆ¶å’Œäº‹åŠ¡ç®¡ç†</li>
<li>å†…å­˜ç®¡ç†å’Œç¡¬ä»¶èµ„æºè°ƒåº¦</li>
</ul>
<p><strong>ç»Ÿä¸€ç»„ä»¶æ¶æ„</strong>:</p>
<pre><code>Unified Storage Engine
â”œâ”€â”€ è¡¨ç®¡ç†å¼•æ“ (Table Management Engine)
â”‚   â”œâ”€â”€ è¡¨æ³¨å†Œå’Œschemaç®¡ç† (Table Registry)
â”‚   â”œâ”€â”€ è®°å½•CRUDå¼•æ“ (Record CRUD Engine)
â”‚   â”œâ”€â”€ æŸ¥è¯¢æ‰§è¡Œå™¨ (Query Executor)
â”‚   â””â”€â”€ ç»“æœç¼“å­˜ (Result Cache)
â”œâ”€â”€ é«˜æ€§èƒ½ç´¢å¼•ç³»ç»Ÿ (High-Performance Index System)
â”‚   â”œâ”€â”€ ä¸»ç´¢å¼•å¼•æ“ (Primary Index: RecordID â†’ Slot)
â”‚   â”œâ”€â”€ äºŒçº§ç´¢å¼•å¼•æ“ (Secondary Index: Field â†’ RecordIDs)
â”‚   â”œâ”€â”€ ç´¢å¼•ç¼“å­˜ç®¡ç† (Index Cache Manager)
â”‚   â””â”€â”€ æŸ¥è¯¢ä¼˜åŒ–å™¨ (Query Optimizer)
â”œâ”€â”€ å¹¶å‘æ§åˆ¶å¼•æ“ (Concurrency Control Engine)
â”‚   â”œâ”€â”€ MVCCç‰ˆæœ¬ç®¡ç† (MVCC Version Manager)
â”‚   â”œâ”€â”€ æ— é”æ•°æ®ç»“æ„ (Lock-Free Structures)
â”‚   â”œâ”€â”€ äº‹åŠ¡åè°ƒå™¨ (Transaction Coordinator)
â”‚   â””â”€â”€ æ­»é”æ£€æµ‹å™¨ (Deadlock Detector)
â””â”€â”€ å†…å­˜ç®¡ç†å¼•æ“ (Memory Management Engine)
    â”œâ”€â”€ NUMAæ„ŸçŸ¥åˆ†é…å™¨ (NUMA-Aware Allocator)
    â”œâ”€â”€ é¡µé¢åˆ†é…å™¨ (Page-Aligned Allocator)
    â”œâ”€â”€ å†…å­˜æ± ç®¡ç†å™¨ (Memory Pool Manager)
    â””â”€â”€ çƒ­ç‚¹æ•°æ®ç®¡ç† (Hot Data Manager)
</code></pre>
<p><strong>æè‡´æ€§èƒ½è®¾è®¡</strong>:</p>
<ul>
<li><strong>å»¶è¿Ÿç›®æ ‡</strong>: &lt; 6ms (60%çš„æ€»å»¶è¿Ÿé¢„ç®—ï¼ŒåŒ…å«åŸæ•°æ®æœåŠ¡å±‚åŠŸèƒ½)</li>
<li><strong>é›¶æŠ½è±¡å¼€é”€</strong>: ç›´æ¥å†…å­˜è®¿é—®ï¼Œæ— åºåˆ—åŒ–/ååºåˆ—åŒ–</li>
<li><strong>CPUç¼“å­˜ä¼˜åŒ–</strong>: æ•°æ®ç»“æ„64å­—èŠ‚å¯¹é½ï¼Œæ‰¹å¤„ç†æ“ä½œ</li>
<li><strong>NUMAæœ¬åœ°åŒ–</strong>: çº¿ç¨‹å’Œæ•°æ®ç»‘å®šåˆ°åŒä¸€NUMAèŠ‚ç‚¹</li>
</ul>
<h3 id="-ç¬¬ä¸‰å±‚é«˜æ•ˆæŒä¹…åŒ–å±‚-high-performance-persistence-layer"><a class="header" href="#-ç¬¬ä¸‰å±‚é«˜æ•ˆæŒä¹…åŒ–å±‚-high-performance-persistence-layer">ğŸ’¾ ç¬¬ä¸‰å±‚ï¼šé«˜æ•ˆæŒä¹…åŒ–å±‚ (High-Performance Persistence Layer)</a></h3>
<p><strong>æ ¸å¿ƒèŒè´£</strong>:</p>
<ul>
<li>æé€ŸWALå†™å…¥ (åŒæ­¥ä¿è¯ä¸€è‡´æ€§)</li>
<li>æ™ºèƒ½å¼‚æ­¥åˆ·ç›˜ (ä¼˜åŒ–I/Oåå)</li>
<li>è½»é‡çº§å¿«ç…§å’Œæ¢å¤</li>
<li>æœ€å°åŒ–I/Oå¼€é”€</li>
</ul>
<p><strong>ä¼˜åŒ–ç»„ä»¶</strong>:</p>
<pre><code>High-Performance Persistence
â”œâ”€â”€ æé€ŸWALå¼•æ“ (Ultra-Fast WAL Engine)
â”‚   â”œâ”€â”€ ç›´æ¥NVMeå†™å…¥ (Direct NVMe Write)
â”‚   â”œâ”€â”€ æ‰¹é‡æ—¥å¿—å†™å…¥ (Batched Log Write)
â”‚   â”œâ”€â”€ é›¶æ‹·è´æ—¥å¿—ç¼“å†² (Zero-Copy Log Buffer)
â”‚   â””â”€â”€ å¹¶å‘æ—¥å¿—å†™å…¥ (Concurrent Log Writers)
â”œâ”€â”€ æ™ºèƒ½åˆ·ç›˜ç®¡ç†å™¨ (Smart Flush Manager)
â”‚   â”œâ”€â”€ é¡µé¢çº§æ‰¹é‡åˆ·ç›˜ (Page-Level Batch Flush)
â”‚   â”œâ”€â”€ åå°å¼‚æ­¥åˆ·ç›˜ (Background Async Flush)
â”‚   â”œâ”€â”€ çƒ­é¡µé¢ä¼˜å…ˆçº§ (Hot Page Priority)
â”‚   â””â”€â”€ I/Oåˆå¹¶ä¼˜åŒ– (I/O Coalescing)
â””â”€â”€ å¿«é€Ÿæ¢å¤å¼•æ“ (Fast Recovery Engine)
    â”œâ”€â”€ å¢é‡æ£€æŸ¥ç‚¹ (Incremental Checkpoint)
    â”œâ”€â”€ å¹¶è¡Œæ¢å¤ (Parallel Recovery)
    â”œâ”€â”€ å†…å­˜å¿«ç…§ (Memory Snapshot)
    â””â”€â”€ ä¸€è‡´æ€§å¿«é€ŸéªŒè¯ (Fast Consistency Check)
</code></pre>
<p><strong>æè‡´æ€§èƒ½è®¾è®¡</strong>:</p>
<ul>
<li><strong>WALå»¶è¿Ÿ</strong>: &lt; 500Î¼s (ç›´æ¥NVMeè®¿é—®ï¼Œ5%çš„æ€»å»¶è¿Ÿé¢„ç®—)</li>
<li><strong>å¼‚æ­¥åˆ·ç›˜</strong>: åå°æ‰¹é‡I/Oï¼Œä¸å½±å“å‰å°å»¶è¿Ÿ</li>
<li><strong>é›¶æ‹·è´</strong>: å†…å­˜ç›´æ¥æ˜ å°„åˆ°å­˜å‚¨</li>
<li><strong>å¹¶å‘å†™å…¥</strong>: å¤šä¸ªWALå†™å…¥å™¨å¹¶è¡Œå·¥ä½œ</li>
</ul>
<h3 id="-ç¬¬å››å±‚ç¡¬ä»¶ç›´é€šå±‚-hardware-direct-access-layer"><a class="header" href="#-ç¬¬å››å±‚ç¡¬ä»¶ç›´é€šå±‚-hardware-direct-access-layer">âš¡ ç¬¬å››å±‚ï¼šç¡¬ä»¶ç›´é€šå±‚ (Hardware Direct Access Layer)</a></h3>
<p><strong>æ ¸å¿ƒèŒè´£</strong>:</p>
<ul>
<li>NVMeç”¨æˆ·æ€ç›´æ¥è®¿é—® (ç»•è¿‡å†…æ ¸)</li>
<li>NUMAæ„ŸçŸ¥å†…å­˜ç®¡ç†</li>
<li>CPUç¼“å­˜ä¼˜åŒ–å’ŒSIMDåŠ é€Ÿ</li>
<li>ç½‘ç»œé›¶æ‹·è´ä¼˜åŒ– (å†…ç½‘ç¯å¢ƒ)</li>
</ul>
<p><strong>ç›´é€šç»„ä»¶</strong>:</p>
<pre><code>Hardware Direct Access
â”œâ”€â”€ ç”¨æˆ·æ€å­˜å‚¨å¼•æ“ (User-Space Storage Engine)
â”‚   â”œâ”€â”€ SPDK NVMeé©±åŠ¨ (SPDK NVMe Driver)
â”‚   â”œâ”€â”€ ç”¨æˆ·æ€I/Oé˜Ÿåˆ— (User-Space I/O Queues)
â”‚   â”œâ”€â”€ ç›´æ¥å†…å­˜è®¿é—® (Direct Memory Access)
â”‚   â””â”€â”€ ä¸­æ–­ç»‘å®šä¼˜åŒ– (Interrupt Affinity)
â”œâ”€â”€ NUMAå†…å­˜ä¼˜åŒ–å™¨ (NUMA Memory Optimizer)
â”‚   â”œâ”€â”€ æœ¬åœ°å†…å­˜åˆ†é… (Local Memory Allocation)
â”‚   â”œâ”€â”€ è·¨èŠ‚ç‚¹è®¿é—®æœ€å°åŒ– (Cross-Node Access Minimization)
â”‚   â”œâ”€â”€ å¤§é¡µé¢ç®¡ç† (Huge Page Management)
â”‚   â””â”€â”€ å†…å­˜é¢„å–ç­–ç•¥ (Memory Prefetching Strategy)
â””â”€â”€ CPUæ€§èƒ½åŠ é€Ÿå™¨ (CPU Performance Accelerator)
    â”œâ”€â”€ ç¼“å­˜è¡Œå¯¹é½ (Cache Line Alignment)
    â”œâ”€â”€ åˆ†æ”¯é¢„æµ‹ä¼˜åŒ– (Branch Prediction Optimization)
    â”œâ”€â”€ SIMDå‘é‡åŒ– (SIMD Vectorization)
    â””â”€â”€ çº¿ç¨‹CPUç»‘å®š (Thread-CPU Affinity)
</code></pre>
<p><strong>ç¡¬ä»¶çº§æ€§èƒ½è®¾è®¡</strong>:</p>
<ul>
<li><strong>å­˜å‚¨å»¶è¿Ÿ</strong>: &lt; 400Î¼s (ç”¨æˆ·æ€NVMeè®¿é—®ï¼Œ4%çš„æ€»å»¶è¿Ÿé¢„ç®—)</li>
<li><strong>å†…å­˜å»¶è¿Ÿ</strong>: &lt; 50ns (NUMAæœ¬åœ°è®¿é—®)</li>
<li><strong>CPUç¼“å­˜</strong>: &lt; 5ns (L1ç¼“å­˜å‘½ä¸­ç‡ &gt; 95%)</li>
<li><strong>ç½‘ç»œå»¶è¿Ÿ</strong>: &lt; 100Î¼s (å†…ç½‘RDMA/å…±äº«å†…å­˜ï¼Œ1%çš„æ€»å»¶è¿Ÿé¢„ç®—)</li>
</ul>
<h2 id="ç²¾ç®€å±‚é—´é€šä¿¡"><a class="header" href="#ç²¾ç®€å±‚é—´é€šä¿¡">ç²¾ç®€å±‚é—´é€šä¿¡</a></h2>
<h3 id="é«˜æ•ˆæ¥å£è®¾è®¡"><a class="header" href="#é«˜æ•ˆæ¥å£è®¾è®¡">é«˜æ•ˆæ¥å£è®¾è®¡</a></h3>
<ul>
<li><strong>ç›´æ¥è°ƒç”¨</strong>: å±‚é—´ç›´æ¥å‡½æ•°è°ƒç”¨ï¼Œé¿å…ç½‘ç»œå¼€é”€</li>
<li><strong>é›¶æ‹·è´</strong>: æŒ‡é’ˆä¼ é€’ï¼Œé¿å…æ•°æ®å¤åˆ¶</li>
<li><strong>æ‰¹é‡å¤„ç†</strong>: å•æ¬¡è°ƒç”¨å¤„ç†å¤šä¸ªè¯·æ±‚</li>
<li><strong>æœ€å°ç›‘æ§</strong>: ä»…å…³é”®æ€§èƒ½æŒ‡æ ‡</li>
</ul>
<h3 id="ç®€åŒ–æ•°æ®æµ"><a class="header" href="#ç®€åŒ–æ•°æ®æµ">ç®€åŒ–æ•°æ®æµ</a></h3>
<pre><code>æç®€è¯·æ±‚æµç¨‹ (å†…ç½‘ç¯å¢ƒ):
Client â†’ é«˜æ€§èƒ½æ¥å£å±‚ â†’ å­˜å‚¨å¼•æ“æ ¸å¿ƒ â†’ æŒä¹…åŒ–å±‚ â†’ ç¡¬ä»¶ç›´é€šå±‚
  â†“         (0.5ms)        (6ms)        (0.5ms)     (0.4ms)
Response â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Direct Memory Access â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
</code></pre>
<h3 id="æ€§èƒ½ä¿è¯æœºåˆ¶"><a class="header" href="#æ€§èƒ½ä¿è¯æœºåˆ¶">æ€§èƒ½ä¿è¯æœºåˆ¶</a></h3>
<ul>
<li><strong>ä¸¥æ ¼å»¶è¿Ÿé¢„ç®—</strong>: æ¯å±‚å»¶è¿Ÿé¢„ç®—ç¡¬æ€§çº¦æŸ</li>
<li><strong>å¿«é€Ÿå¤±è´¥</strong>: è¶…æ—¶ç«‹å³è¿”å›é”™è¯¯ï¼Œä¸ç­‰å¾…</li>
<li><strong>é™çº§ç­–ç•¥</strong>: å…³é—­éå…³é”®åŠŸèƒ½ï¼Œä¿è¯æ ¸å¿ƒæ€§èƒ½</li>
<li><strong>å®æ—¶ç›‘æ§</strong>: P99å»¶è¿Ÿå®æ—¶ç›‘æ§å’Œå‘Šè­¦</li>
</ul>
<h2 id="å…³é”®æŠ€æœ¯å†³ç­–-1"><a class="header" href="#å…³é”®æŠ€æœ¯å†³ç­–-1">å…³é”®æŠ€æœ¯å†³ç­–</a></h2>
<h3 id="1-å†…å­˜-vs-ç£ç›˜å­˜å‚¨ç­–ç•¥"><a class="header" href="#1-å†…å­˜-vs-ç£ç›˜å­˜å‚¨ç­–ç•¥">1. å†…å­˜ vs ç£ç›˜å­˜å‚¨ç­–ç•¥</a></h3>
<p><strong>å†³ç­–</strong>: æ¿€è¿›çš„å†…å­˜ä¼˜å…ˆç­–ç•¥ (å†…ç½‘ç¯å¢ƒä¼˜åŠ¿)</p>
<ul>
<li><strong>çƒ­æ•°æ®</strong>: 100%å¸¸é©»å†…å­˜ (æ— ç£ç›˜è®¿é—®)</li>
<li><strong>æ¸©æ•°æ®</strong>: å†…å­˜ + å¼‚æ­¥åˆ·ç›˜ (åå°æŒä¹…åŒ–)</li>
<li><strong>å†·æ•°æ®</strong>: å‹ç¼©å­˜å‚¨ (å®šæœŸå½’æ¡£)</li>
</ul>
<h3 id="2-åŒæ­¥-vs-å¼‚æ­¥æŒä¹…åŒ–"><a class="header" href="#2-åŒæ­¥-vs-å¼‚æ­¥æŒä¹…åŒ–">2. åŒæ­¥ vs å¼‚æ­¥æŒä¹…åŒ–</a></h3>
<p><strong>å†³ç­–</strong>: æ··åˆç­–ç•¥ + å†…ç½‘ä¼˜åŒ–</p>
<ul>
<li><strong>å…³é”®è·¯å¾„</strong>: å¿«é€ŸWALå†™å…¥ (&lt;500Î¼såˆ°æœ¬åœ°NVMe)</li>
<li><strong>æ•°æ®æ–‡ä»¶</strong>: å¼‚æ­¥æ‰¹é‡åˆ·ç›˜ (ä¸å½±å“å‰å°)</li>
<li><strong>ç½‘ç»œåŒæ­¥</strong>: åˆ©ç”¨å†…ç½‘é«˜é€Ÿç½‘ç»œåšå®æ—¶å¤‡ä»½</li>
</ul>
<h3 id="3-å•æœº-vs-åˆ†å¸ƒå¼æ¶æ„"><a class="header" href="#3-å•æœº-vs-åˆ†å¸ƒå¼æ¶æ„">3. å•æœº vs åˆ†å¸ƒå¼æ¶æ„</a></h3>
<p><strong>å†³ç­–</strong>: å•æœºä¼˜åŒ–ä¼˜å…ˆ (å†…ç½‘ç¯å¢ƒ)</p>
<ul>
<li><strong>ç¬¬ä¸€é˜¶æ®µ</strong>: å•æœºæè‡´æ€§èƒ½ä¼˜åŒ–</li>
<li><strong>ç¬¬äºŒé˜¶æ®µ</strong>: åŒæœºæˆ¿ä¸»å¤‡ (å†…ç½‘é«˜é€Ÿå¤åˆ¶)</li>
<li><strong>ç¬¬ä¸‰é˜¶æ®µ</strong>: å¿…è¦æ—¶åˆ†ç‰‡ (ä½†ä¼˜å…ˆå‚ç›´æ‰©å±•)</li>
</ul>
<h3 id="4-ä¸€è‡´æ€§æ¨¡å‹é€‰æ‹©"><a class="header" href="#4-ä¸€è‡´æ€§æ¨¡å‹é€‰æ‹©">4. ä¸€è‡´æ€§æ¨¡å‹é€‰æ‹©</a></h3>
<p><strong>å†³ç­–</strong>: ç®€åŒ–ä¸€è‡´æ€§ (å†…ç½‘ä¿¡ä»»ç¯å¢ƒ)</p>
<ul>
<li><strong>å†™ä¸€è‡´æ€§</strong>: å¼ºä¸€è‡´æ€§WAL + å¼‚æ­¥æ•°æ®æ–‡ä»¶</li>
<li><strong>è¯»ä¸€è‡´æ€§</strong>: ç›´æ¥å†…å­˜è¯»å–ï¼Œæ— ä¸€è‡´æ€§å¼€é”€</li>
<li><strong>è·¨è¡¨ä¸€è‡´æ€§</strong>: åº”ç”¨å±‚ä¿è¯ (å‡å°‘ç³»ç»Ÿå¤æ‚æ€§)</li>
</ul>
<h2 id="æ€§èƒ½ç›®æ ‡é‡æ–°åˆ†é…"><a class="header" href="#æ€§èƒ½ç›®æ ‡é‡æ–°åˆ†é…">æ€§èƒ½ç›®æ ‡é‡æ–°åˆ†é…</a></h2>
<h3 id="å†…ç½‘ä¼˜åŒ–å»¶è¿Ÿåˆ†è§£"><a class="header" href="#å†…ç½‘ä¼˜åŒ–å»¶è¿Ÿåˆ†è§£">å†…ç½‘ä¼˜åŒ–å»¶è¿Ÿåˆ†è§£</a></h3>
<pre><code>æ€»å»¶è¿Ÿç›®æ ‡: P99 &lt; 10ms (å†…ç½‘ç¯å¢ƒ)
â”œâ”€â”€ ç½‘ç»œä¼ è¾“: 0.1ms (1%) â† å†…ç½‘RDMA/å…±äº«å†…å­˜
â”œâ”€â”€ æ¥å£å±‚: 0.5ms (5%) â† æœ€å°åŒ–åè®®å¼€é”€
â”œâ”€â”€ å­˜å‚¨å¼•æ“: 6ms (60%) â† æ ¸å¿ƒè®¡ç®—å¯†é›†
â”œâ”€â”€ æŒä¹…åŒ–å±‚: 0.5ms (5%) â† ç›´æ¥NVMeè®¿é—®
â”œâ”€â”€ ç¡¬ä»¶å±‚: 0.4ms (4%) â† ç”¨æˆ·æ€I/O
â””â”€â”€ ç¼“å†²æ—¶é—´: 2.5ms (25%) â† é¢„ç•™çªå‘å¤„ç†
</code></pre>
<h3 id="ååé‡ç›®æ ‡"><a class="header" href="#ååé‡ç›®æ ‡">ååé‡ç›®æ ‡</a></h3>
<ul>
<li><strong>è¯»æ“ä½œ</strong>: 1M+ QPS (ç‚¹æŸ¥è¯¢)</li>
<li><strong>å†™æ“ä½œ</strong>: 100K+ QPS (æ’å…¥/æ›´æ–°)</li>
<li><strong>å¤åˆæ“ä½œ</strong>: 50K+ QPS (äº‹åŠ¡å¤„ç†)</li>
<li><strong>æ‰¹é‡æ“ä½œ</strong>: 10M+ records/second (æ‰¹å¤„ç†)</li>
</ul>
<h3 id="èµ„æºåˆ©ç”¨ç‡"><a class="header" href="#èµ„æºåˆ©ç”¨ç‡">èµ„æºåˆ©ç”¨ç‡</a></h3>
<ul>
<li><strong>CPUåˆ©ç”¨ç‡</strong>: 70-80% (é¿å…è¿‡è½½)</li>
<li><strong>å†…å­˜åˆ©ç”¨ç‡</strong>: 80-90% (å……åˆ†åˆ©ç”¨)</li>
<li><strong>å­˜å‚¨I/O</strong>: 60-70% (ç•™ä½™é‡å¤„ç†çªå‘)</li>
<li><strong>ç½‘ç»œå¸¦å®½</strong>: 50-60% (é¿å…ç½‘ç»œæ‹¥å¡)</li>
</ul>
<h2 id="å¯æ‰©å±•æ€§è®¾è®¡"><a class="header" href="#å¯æ‰©å±•æ€§è®¾è®¡">å¯æ‰©å±•æ€§è®¾è®¡</a></h2>
<h3 id="æ°´å¹³æ‰©å±•ç­–ç•¥"><a class="header" href="#æ°´å¹³æ‰©å±•ç­–ç•¥">æ°´å¹³æ‰©å±•ç­–ç•¥</a></h3>
<ul>
<li><strong>æ— çŠ¶æ€æœåŠ¡</strong>: ä¸šåŠ¡æœåŠ¡å±‚æ°´å¹³æ‰©å±•</li>
<li><strong>æ•°æ®åˆ†ç‰‡</strong>: æŒ‰ä¸šåŠ¡ç»´åº¦åˆ†ç‰‡å­˜å‚¨</li>
<li><strong>è¯»å†™åˆ†ç¦»</strong>: è¯»å‰¯æœ¬æ”¯æŒæŸ¥è¯¢æ‰©å±•</li>
<li><strong>ç¼“å­˜å±‚</strong>: åˆ†å¸ƒå¼ç¼“å­˜å‡å°‘å­˜å‚¨å‹åŠ›</li>
</ul>
<h3 id="å‚ç›´æ‰©å±•ä¼˜åŒ–"><a class="header" href="#å‚ç›´æ‰©å±•ä¼˜åŒ–">å‚ç›´æ‰©å±•ä¼˜åŒ–</a></h3>
<ul>
<li><strong>ç¡¬ä»¶å‡çº§</strong>: æ›´å¿«çš„CPU/å†…å­˜/å­˜å‚¨</li>
<li><strong>NUMAä¼˜åŒ–</strong>: å¤šè·¯æœåŠ¡å™¨æ€§èƒ½ä¼˜åŒ–</li>
<li><strong>GPUåŠ é€Ÿ</strong>: ç‰¹å®šè®¡ç®—ä»»åŠ¡GPUåŠ é€Ÿ</li>
<li><strong>ä¸“ç”¨ç¡¬ä»¶</strong>: FPGA/æ™ºèƒ½ç½‘å¡ç­‰ä¸“ç”¨è®¾å¤‡</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="table-manager"><a class="header" href="#table-manager">Table Manager</a></h1>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ul>
<li><a href="03-record-manager.html#core-concepts">Core Concepts</a>
<ul>
<li><a href="03-record-manager.html#what-is-a-table">What is a Table?</a></li>
<li><a href="03-record-manager.html#what-are-records">What are Records?</a></li>
</ul>
</li>
<li><a href="03-record-manager.html#table-manager-architecture">Table Manager Architecture</a></li>
<li><a href="03-record-manager.html#table-organization">Table Organization</a>
<ul>
<li><a href="03-record-manager.html#table-structure">Table Structure</a></li>
<li><a href="03-record-manager.html#record-layout">Record Layout</a></li>
</ul>
</li>
<li><a href="03-record-manager.html#record-operations">Record Operations</a>
<ul>
<li><a href="03-record-manager.html#storage-and-addressing">Storage and Addressing</a></li>
<li><a href="03-record-manager.html#record-ids-snowflake-format">Record IDs (Snowflake Format)</a></li>
<li><a href="03-record-manager.html#record-lifecycle">Record Lifecycle</a></li>
</ul>
</li>
<li><a href="03-record-manager.html#index-system">Index System</a>
<ul>
<li><a href="03-record-manager.html#primary-index">Primary Index</a></li>
<li><a href="03-record-manager.html#secondary-indexes">Secondary Indexes</a></li>
<li><a href="03-record-manager.html#index-storage">Index Storage</a></li>
<li><a href="03-record-manager.html#query-processing">Query Processing</a></li>
</ul>
</li>
<li><a href="03-record-manager.html#advanced-features">Advanced Features</a>
<ul>
<li><a href="03-record-manager.html#multi-version-concurrency-mvcc">Multi-Version Concurrency (MVCC)</a></li>
<li><a href="03-record-manager.html#schema-management">Schema Management</a></li>
<li><a href="03-record-manager.html#zero-copy-storage">Zero-Copy Storage</a></li>
</ul>
</li>
<li><a href="03-record-manager.html#performance">Performance</a>
<ul>
<li><a href="03-record-manager.html#data-types-and-storage">Data Types and Storage</a></li>
<li><a href="03-record-manager.html#performance-comparison">Performance Comparison</a></li>
<li><a href="03-record-manager.html#optimization-strategies">Optimization Strategies</a></li>
</ul>
</li>
<li><a href="03-record-manager.html#page-aware-storage-design">Page-Aware Storage Design</a>
<ul>
<li><a href="03-record-manager.html#readwrite-amplification-problem">Read/Write Amplification Problem</a></li>
<li><a href="03-record-manager.html#page-aligned-record-layout">Page-Aligned Record Layout</a></li>
<li><a href="03-record-manager.html#batch-operations">Batch Operations</a></li>
<li><a href="03-record-manager.html#hot-page-management">Hot Page Management</a></li>
</ul>
</li>
<li><a href="03-record-manager.html#data-integrity">Data Integrity</a></li>
<li><a href="03-record-manager.html#catalog-system">Catalog System</a>
<ul>
<li><a href="03-record-manager.html#catalog-structure">Catalog Structure</a></li>
<li><a href="03-record-manager.html#catalog-operations">Catalog Operations</a></li>
<li><a href="03-record-manager.html#catalog-persistence">Catalog Persistence</a></li>
</ul>
</li>
</ul>
<h2 id="core-concepts"><a class="header" href="#core-concepts">Core Concepts</a></h2>
<h3 id="what-is-a-table"><a class="header" href="#what-is-a-table">What is a Table?</a></h3>
<p>A <strong>table</strong> is the primary organization unit in this storage engine. It's a specialized container that stores one type of business data with optimal performance.</p>
<p><strong>Key Characteristics</strong>:</p>
<ul>
<li><strong>Single Data Type</strong>: Each table stores only one kind of business object (orders, users, transactions)</li>
<li><strong>Fixed Record Size</strong>: All records in a table have the same size, determined at table creation</li>
<li><strong>Memory-Mapped</strong>: Direct access to data without serialization overhead</li>
<li><strong>High Performance</strong>: Optimized for sub-millisecond access times</li>
</ul>
<p><strong>Table Examples</strong>:</p>
<ul>
<li><strong>Orders Table</strong>: 512 bytes per record - trading orders with symbol, quantity, price</li>
<li><strong>Users Table</strong>: 256 bytes per record - user profiles and account information</li>
<li><strong>Logs Table</strong>: 128 bytes per record - system events and audit trails</li>
<li><strong>Config Table</strong>: 1024 bytes per record - complex configuration settings</li>
</ul>
<h3 id="what-are-records"><a class="header" href="#what-are-records">What are Records?</a></h3>
<p><strong>Records</strong> are the individual data entries stored within tables. Each record represents one business entity.</p>
<p><strong>Record Characteristics</strong>:</p>
<ul>
<li><strong>Structured Data</strong>: Fixed schema with typed fields (like a programming struct)</li>
<li><strong>Unique Identity</strong>: Every record has a Snowflake ID for direct access</li>
<li><strong>Binary Storage</strong>: Data stored in CPU-native format for maximum speed</li>
<li><strong>Atomic Operations</strong>: Read or write entire records without corruption</li>
</ul>
<p><strong>Why This Design Works</strong>:</p>
<ul>
<li><strong>vs Traditional Database</strong>: No SQL parsing, direct memory access</li>
<li><strong>vs JSON/XML</strong>: Binary format is 100x faster than text parsing</li>
<li><strong>vs Key-Value Store</strong>: Structured schema enables efficient queries</li>
<li><strong>vs Document Store</strong>: Fixed size eliminates memory fragmentation</li>
</ul>
<p><strong>Performance Advantage</strong>:</p>
<pre><code>Traditional Database:
Request â†’ Parse SQL â†’ Plan Query â†’ Buffer Pool â†’ Disk I/O â†’ Response
         â†‘ 5-20ms of overhead â†‘

Table Manager:
Request â†’ Table Lookup â†’ Direct Memory Access â†’ Response  
         â†‘ &lt;1ms total time â†‘
</code></pre>
<h2 id="table-manager-architecture"><a class="header" href="#table-manager-architecture">Table Manager Architecture</a></h2>
<p>The Table Manager is the central component that handles all table and record operations. It replaces the traditional "Record Manager" concept with a more focused, table-centric approach.</p>
<p><strong>Core Design Principle</strong>:
Instead of managing records independently, the Table Manager treats each table as a self-contained unit that knows how to manage its own records efficiently.</p>
<p><strong>Architecture Components</strong>:</p>
<pre><code>Table Manager
â”œâ”€â”€ Table Registry          # Active tables lookup
â”œâ”€â”€ Storage Engine         # Memory mapping and I/O
â”œâ”€â”€ Transaction Manager    # MVCC and concurrent access  
â”œâ”€â”€ Catalog Service       # Schema and metadata
â””â”€â”€ Index Manager         # Secondary indexes
</code></pre>
<p><strong>Table Manager Responsibilities</strong>:</p>
<ul>
<li><strong>Table Lifecycle</strong>: Create, drop, and manage table instances</li>
<li><strong>Record Operations</strong>: Insert, update, delete, query records within tables</li>
<li><strong>Schema Management</strong>: Validate records against table schemas</li>
<li><strong>Memory Management</strong>: Allocate and track record slots within tables</li>
<li><strong>Concurrency Control</strong>: Coordinate MVCC versions and transactions</li>
<li><strong>Performance Optimization</strong>: Cache hot data, batch operations</li>
</ul>
<p><strong>Key Benefits of Table-Centric Design</strong>:</p>
<ul>
<li><strong>Simplified Architecture</strong>: Fewer abstraction layers, clearer responsibilities</li>
<li><strong>Better Performance</strong>: Direct table â†’ storage mapping</li>
<li><strong>Type Safety</strong>: Each table enforces its record schema</li>
<li><strong>Locality</strong>: Related records (same type) stored together</li>
<li><strong>Scalability</strong>: Tables can be independently optimized and managed</li>
</ul>
<h2 id="table-organization"><a class="header" href="#table-organization">Table Organization</a></h2>
<h3 id="table-structure"><a class="header" href="#table-structure">Table Structure</a></h3>
<p>Each table is a self-contained storage unit optimized for a specific record type.</p>
<p><strong>Table Design Principles</strong>:</p>
<ul>
<li><strong>Homogeneous Records</strong>: All records in a table have identical structure and size</li>
<li><strong>Contiguous Storage</strong>: Records stored sequentially in memory-mapped files</li>
<li><strong>Fixed Allocation</strong>: Record slots pre-allocated for predictable performance</li>
<li><strong>Type Safety</strong>: Schema enforced at the table level</li>
</ul>
<p><strong>Table Components</strong>:</p>
<pre><code>Table Structure:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Table Header (metadata, schema, stats)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Allocation Bitmap (track free/used slots)  â”‚  
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Record Slot 0                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Record Slot 1                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ...                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Record Slot N                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 id="record-layout"><a class="header" href="#record-layout">Record Layout</a></h3>
<p>Every record within a table follows the same binary layout:</p>
<pre><code>Record Structure (size varies by table):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Record Header (32 bytes)                   â”‚  â† Metadata
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Application Data (table-specific size)     â”‚  â† Your data
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Record Footer (32 bytes)                   â”‚  â† Integrity
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>Record Header (32 bytes)</strong>:</p>
<pre><code>Header Layout:
â”œâ”€â”€ Record ID (8 bytes)           # Unique Snowflake ID
â”œâ”€â”€ Schema Version (4 bytes)      # Handle schema evolution  
â”œâ”€â”€ Data Length (4 bytes)         # Actual payload size
â”œâ”€â”€ Status Flags (4 bytes)        # ACTIVE, DELETED, etc.
â”œâ”€â”€ Timestamp (8 bytes)           # Last modification time
â”œâ”€â”€ Header Checksum (4 bytes)     # Header integrity check
</code></pre>
<p><strong>Table Size Examples (Page-Aware Design)</strong>:</p>
<pre><code>Table Type    | Record Size | Records/Page | Max Records | Memory Usage | Page Efficiency
--------------|-------------|--------------|-------------|--------------|----------------
Users         | 256B        | 16 records   | 4M records  | 1GB          | 100% (4096/256)
Orders        | 512B        | 8 records    | 2M records  | 1GB          | 100% (4096/512)  
Logs          | 128B        | 32 records   | 8M records  | 1GB          | 100% (4096/128)
Config        | 1024B       | 4 records    | 1M records  | 1GB          | 100% (4096/1024)
</code></pre>
<h2 id="record-operations"><a class="header" href="#record-operations">Record Operations</a></h2>
<h3 id="storage-and-addressing"><a class="header" href="#storage-and-addressing">Storage and Addressing</a></h3>
<p>Each table manages its own record storage independently.</p>
<p><strong>Table Memory Organization</strong>:</p>
<ul>
<li><strong>Dedicated Memory Pool</strong>: Each table has its own memory-mapped region</li>
<li><strong>Slot-Based Allocation</strong>: Records occupy fixed-size slots within the table</li>
<li><strong>Bitmap Tracking</strong>: Fast free/used slot tracking using bitmaps</li>
<li><strong>Sequential Layout</strong>: Records stored contiguously for cache efficiency</li>
</ul>
<p><strong>Record Access Pattern</strong>:</p>
<pre><code>Operation Flow:
1. Application specifies table name + record ID
2. Table Manager looks up table instance
3. Use Primary Index: record_id â†’ slot_position
4. Direct memory access to slot
5. Return record data
</code></pre>
<p><strong>Index-Based Address Calculation</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn get_record_address(table: &amp;Table, record_id: RecordId) -&gt; Option&lt;*mut u8&gt; {
    // Use primary index to find slot position
    let slot_index = table.primary_index.get(record_id)?;
    let offset = slot_index * table.record_size;
    Some(table.memory_pool.base_addr + offset)
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Performance Characteristics</strong>:</p>
<ul>
<li><strong>O(1) Access</strong>: Direct memory addressing</li>
<li><strong>No Fragmentation</strong>: Fixed-size slots eliminate fragmentation</li>
<li><strong>Cache Friendly</strong>: Sequential record layout improves cache hits</li>
<li><strong>NUMA Aware</strong>: Tables can be allocated on specific NUMA nodes</li>
</ul>
<p><strong>Record Status Flags</strong>:
The 4-byte status flags field tracks various record states:</p>
<pre><code>Status Flags Breakdown:
â”œâ”€â”€ Bits 0-3: Lifecycle State (ACTIVE, DELETED, TOMBSTONE)
â”œâ”€â”€ Bits 4-7: Lock State (UNLOCKED, READ_LOCK, WRITE_LOCK)
â”œâ”€â”€ Bits 8-11: Encoding Format (BINARY, JSON, etc.)
â”œâ”€â”€ Bits 12-15: Validation State (VALID, CORRUPT, etc.)
â”œâ”€â”€ Bits 16-31: Reserved for extensions
</code></pre>
<h3 id="record-ids-snowflake-format"><a class="header" href="#record-ids-snowflake-format">Record IDs (Snowflake Format)</a></h3>
<p>Every record across all tables uses the same ID format for consistency and performance.</p>
<p><strong>Snowflake ID Structure (64 bits)</strong>:</p>
<pre><code>Record ID Components:
â”œâ”€â”€ Timestamp (41 bits)          # Creation time in milliseconds
â”œâ”€â”€ Datacenter ID (5 bits)       # Datacenter identifier (0-31)
â”œâ”€â”€ Machine ID (5 bits)          # Machine identifier (0-31)  
â”œâ”€â”€ Sequence Number (12 bits)    # Per-machine counter (0-4095)
â”œâ”€â”€ Sign Bit (1 bit)            # Always 0 (positive)
</code></pre>
<p><strong>ID Generation Properties</strong>:</p>
<ul>
<li><strong>Globally Unique</strong>: No coordination needed between machines</li>
<li><strong>Time-Ordered</strong>: IDs roughly ordered by creation time</li>
<li><strong>High Throughput</strong>: 4096 IDs per millisecond per machine</li>
<li><strong>Distributed</strong>: No single point of failure</li>
<li><strong>Debuggable</strong>: Can extract timestamp and source machine</li>
</ul>
<p><strong>Record Lookup Process</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Table Manager uses index-based lookup
fn find_record(table_name: &amp;str, record_id: RecordId) -&gt; Option&lt;&amp;Record&gt; {
    let table = self.get_table(table_name)?;
    // Primary index maps record_id to slot_position
    let slot_index = table.primary_index.get(record_id)?;
    table.get_record_at_slot(slot_index)
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Key Properties for Index System</strong>:</p>
<ul>
<li><strong>Globally Unique</strong>: Each record ID is unique across entire system</li>
<li><strong>Random Distribution</strong>: No correlation between ID and storage location</li>
<li><strong>Index-Friendly</strong>: IDs work efficiently in hash tables and B+ trees</li>
<li><strong>Cross-Table Queries</strong>: Consistent ID format enables joins and references</li>
<li><strong>Debugging</strong>: Can extract creation timestamp and source information</li>
</ul>
<h3 id="record-lifecycle"><a class="header" href="#record-lifecycle">Record Lifecycle</a></h3>
<p>Each table manages the lifecycle of its records independently.</p>
<p><strong>Record State Machine</strong>:</p>
<pre><code>Record States within Table:
    ACTIVE â”€â”€deleteâ”€â”€â†’ DELETED â”€â”€expireâ”€â”€â†’ TOMBSTONE
       â†‘                  â”‚                    â”‚
       â””â”€â”€â”€â”€â”€â”€resurrectâ”€â”€â”€â”˜                    â”‚
                                               â”‚
                           â†â”€â”€â”€â”€â”€â”€cleanupâ”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>State Definitions</strong>:</p>
<ul>
<li><strong>ACTIVE</strong>: Record is live and available for operations</li>
<li><strong>DELETED</strong>: Soft-deleted, still recoverable, counts toward table capacity</li>
<li><strong>TOMBSTONE</strong>: Marked for cleanup, space will be reclaimed</li>
</ul>
<p><strong>Table-Level Operations</strong>:</p>
<p><strong>Insert Record</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Table {
    fn insert(&amp;mut self, data: &amp;[u8]) -&gt; Result&lt;RecordId&gt; {
        let slot = self.find_free_slot()?;
        let record_id = self.generate_snowflake_id();
        
        // Write record to slot
        self.write_record(slot, record_id, data)?;
        self.mark_slot_used(slot);
        
        // Update primary index: record_id â†’ slot_position
        self.primary_index.insert(record_id, slot)?;
        
        // Update secondary indexes
        self.update_secondary_indexes(record_id, data)?;
        
        Ok(record_id)
    }
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Read Record</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn get(&amp;self, record_id: RecordId) -&gt; Option&lt;&amp;Record&gt; {
    // Use primary index to find slot
    let slot = self.primary_index.get(record_id)?;
    let record = self.get_slot(slot)?;
    if record.is_active() {
        Some(record)
    } else {
        None
    }
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Update Record (MVCC)</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn update(&amp;mut self, record_id: RecordId, data: &amp;[u8]) -&gt; Result&lt;()&gt; {
    // Find current record location
    let slot = self.primary_index.get(record_id)?;
    
    // Create new version while preserving old for concurrent readers
    self.create_new_version(record_id, data)?;
    self.update_version_chain(record_id)?;
    
    // Update secondary indexes with new data
    self.update_secondary_indexes(record_id, data)?;
    
    Ok(())
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Delete Record</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn delete(&amp;mut self, record_id: RecordId) -&gt; Result&lt;()&gt; {
    // Find record location via primary index
    let slot = self.primary_index.get(record_id)?;
    
    // Mark record as deleted (soft delete)
    self.mark_record_deleted(slot);
    
    // Remove from secondary indexes
    self.remove_from_secondary_indexes(record_id)?;
    
    // Keep primary index entry for recovery
    // Data still exists for recovery
    Ok(())
}
<span class="boring">}</span></code></pre></pre>
<h2 id="index-system"><a class="header" href="#index-system">Index System</a></h2>
<p>The index system is crucial for efficient record lookup and query processing. Instead of directly mapping record IDs to slot positions, we use a flexible index architecture.</p>
<h3 id="primary-index"><a class="header" href="#primary-index">Primary Index</a></h3>
<p><strong>Purpose</strong>: Maps Record ID (Snowflake) â†’ Slot Position in the table</p>
<p><strong>Design Rationale</strong>:</p>
<ul>
<li>Record IDs are globally unique random numbers (Snowflake format)</li>
<li>No correlation between Record ID and physical storage location</li>
<li>Primary index provides O(1) lookup from ID to slot position</li>
<li>Enables flexible slot allocation and compaction</li>
</ul>
<p><strong>Primary Index Structure</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct PrimaryIndex {
    // Hash table for O(1) lookup
    index: HashMap&lt;RecordId, SlotIndex&gt;,
    
    // Optional: B+ tree for range queries on IDs
    btree: Option&lt;BTreeMap&lt;RecordId, SlotIndex&gt;&gt;,
    
    // Metadata
    table_id: TableId,
    record_count: u64,
}

impl PrimaryIndex {
    fn get(&amp;self, record_id: RecordId) -&gt; Option&lt;SlotIndex&gt; {
        self.index.get(&amp;record_id).copied()
    }
    
    fn insert(&amp;mut self, record_id: RecordId, slot: SlotIndex) -&gt; Result&lt;()&gt; {
        if self.index.contains_key(&amp;record_id) {
            return Err(Error::DuplicateKey);
        }
        self.index.insert(record_id, slot);
        self.record_count += 1;
        Ok(())
    }
    
    fn remove(&amp;mut self, record_id: RecordId) -&gt; Option&lt;SlotIndex&gt; {
        let slot = self.index.remove(&amp;record_id)?;
        self.record_count -= 1;
        Some(slot)
    }
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Storage Characteristics</strong>:</p>
<ul>
<li><strong>In-Memory</strong>: Primary index kept entirely in RAM for speed</li>
<li><strong>Persistent</strong>: Periodically flushed to disk for crash recovery</li>
<li><strong>Memory Overhead</strong>: ~24 bytes per record (16-byte ID + 8-byte slot + overhead)</li>
<li><strong>Performance</strong>: O(1) lookup, O(1) insert/delete</li>
</ul>
<h3 id="secondary-indexes"><a class="header" href="#secondary-indexes">Secondary Indexes</a></h3>
<p><strong>Purpose</strong>: Enable efficient queries on non-primary key fields</p>
<p><strong>Index Types Supported</strong>:</p>
<p><strong>Hash Indexes</strong> (for equality queries):</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct HashSecondaryIndex {
    name: String,
    field: FieldName,
    index: HashMap&lt;FieldValue, Vec&lt;RecordId&gt;&gt;,  // Multiple records per value
}
<span class="boring">}</span></code></pre></pre>
<p><strong>B+ Tree Indexes</strong> (for range queries):</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct BTreeSecondaryIndex {
    name: String,
    field: FieldName,
    index: BTreeMap&lt;FieldValue, Vec&lt;RecordId&gt;&gt;,
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Composite Indexes</strong> (multi-field):</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct CompositeIndex {
    name: String,
    fields: Vec&lt;FieldName&gt;,
    index: BTreeMap&lt;CompositeKey, Vec&lt;RecordId&gt;&gt;,
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Secondary Index Operations</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl SecondaryIndex {
    // Find records by field value
    fn find(&amp;self, value: &amp;FieldValue) -&gt; Vec&lt;RecordId&gt; {
        self.index.get(value).cloned().unwrap_or_default()
    }
    
    // Range query (for B+ tree indexes)
    fn range(&amp;self, start: &amp;FieldValue, end: &amp;FieldValue) -&gt; Vec&lt;RecordId&gt; {
        self.index
            .range(start..=end)
            .flat_map(|(_, record_ids)| record_ids.iter().copied())
            .collect()
    }
    
    // Update index when record changes
    fn update(&amp;mut self, record_id: RecordId, old_value: Option&lt;&amp;FieldValue&gt;, new_value: Option&lt;&amp;FieldValue&gt;) -&gt; Result&lt;()&gt; {
        // Remove old entry
        if let Some(old_val) = old_value {
            self.remove_entry(old_val, record_id);
        }
        
        // Add new entry  
        if let Some(new_val) = new_value {
            self.add_entry(new_val.clone(), record_id);
        }
        
        Ok(())
    }
}
<span class="boring">}</span></code></pre></pre>
<h3 id="index-storage"><a class="header" href="#index-storage">Index Storage</a></h3>
<p><strong>Index File Organization</strong>:</p>
<pre><code>Table Directory Structure:
â”œâ”€â”€ data/
â”‚   â””â”€â”€ table_records.dat        # Record data (mmap file)
â”œâ”€â”€ indexes/
â”‚   â”œâ”€â”€ primary.idx             # Primary index (RecordID â†’ Slot)
â”‚   â”œâ”€â”€ user_id.idx             # Secondary index on user_id
â”‚   â”œâ”€â”€ timestamp.idx           # Secondary index on timestamp
â”‚   â””â”€â”€ symbol_price.idx        # Composite index
â””â”€â”€ metadata/
    â”œâ”€â”€ table.meta              # Table schema and metadata
    â””â”€â”€ indexes.meta            # Index definitions
</code></pre>
<p><strong>Index Persistence Strategy</strong>:</p>
<ul>
<li><strong>Write-Through</strong>: Index updates immediately written to disk</li>
<li><strong>Write-Behind</strong>: Batch index updates for performance</li>
<li><strong>Memory-Mapped</strong>: Large indexes can be memory-mapped</li>
<li><strong>Crash Recovery</strong>: Rebuild indexes from record data if corrupted</li>
</ul>
<p><strong>Index Memory Management</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct TableIndexes {
    primary: PrimaryIndex,                          // Always in memory
    secondary: HashMap&lt;String, Box&lt;dyn SecondaryIndex&gt;&gt;, // Configurable
    
    // Memory management
    memory_limit: usize,                           // Max memory for indexes
    cache_policy: IndexCachePolicy,               // LRU, LFU, etc.
}
<span class="boring">}</span></code></pre></pre>
<h3 id="query-processing"><a class="header" href="#query-processing">Query Processing</a></h3>
<p><strong>Query Execution Flow</strong>:</p>
<pre><code>Query Types and Execution:

1. Point Query (by Record ID):
   Record ID â†’ Primary Index â†’ Slot Position â†’ Record Data
   
2. Secondary Key Query:
   Field Value â†’ Secondary Index â†’ Record IDs â†’ Primary Index â†’ Slot Positions â†’ Record Data
   
3. Range Query:
   Range â†’ B+ Tree Index â†’ Record IDs â†’ Primary Index â†’ Slot Positions â†’ Record Data
   
4. Composite Query:
   Multi-Field Values â†’ Composite Index â†’ Record IDs â†’ Primary Index â†’ Record Data
</code></pre>
<p><strong>Query Optimization</strong>:</p>
<ul>
<li><strong>Index Selection</strong>: Choose most selective index for query</li>
<li><strong>Index Intersection</strong>: Combine multiple indexes for complex queries</li>
<li><strong>Parallel Lookup</strong>: Parallelize primary index lookups</li>
<li><strong>Caching</strong>: Cache frequently accessed record IDs and slot positions</li>
</ul>
<p><strong>Example Query Processing</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Table {
    // Query by secondary index
    fn find_by_user_id(&amp;self, user_id: u32) -&gt; Result&lt;Vec&lt;&amp;Record&gt;&gt; {
        // 1. Use secondary index to find record IDs
        let record_ids = self.secondary_indexes
            .get("user_id")?
            .find(&amp;FieldValue::U32(user_id));
        
        // 2. Use primary index to find slot positions
        let mut records = Vec::new();
        for record_id in record_ids {
            if let Some(slot) = self.primary_index.get(record_id) {
                if let Some(record) = self.get_slot(slot) {
                    if record.is_active() {
                        records.push(record);
                    }
                }
            }
        }
        
        Ok(records)
    }
    
    // Range query
    fn find_by_timestamp_range(&amp;self, start: u64, end: u64) -&gt; Result&lt;Vec&lt;&amp;Record&gt;&gt; {
        let record_ids = self.secondary_indexes
            .get("timestamp")?
            .range(&amp;FieldValue::U64(start), &amp;FieldValue::U64(end));
            
        // Convert to records using primary index
        self.lookup_records_by_ids(record_ids)
    }
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Performance Characteristics</strong>:</p>
<pre><code>Operation Type        | Primary Index | Secondary Index | Total Complexity
----------------------|---------------|-----------------|------------------
Point Query (by ID)   | O(1)         | N/A            | O(1)
Secondary Key Query   | O(1)         | O(1)           | O(1) + O(k) where k=results
Range Query           | O(1)         | O(log n + k)   | O(log n + k)
Composite Query       | O(1)         | O(log n + k)   | O(log n + k)
Insert                | O(1)         | O(log n)       | O(log n)
Update                | O(1)         | O(log n)       | O(log n)
Delete                | O(1)         | O(log n)       | O(log n)
</code></pre>
<h2 id="advanced-features"><a class="header" href="#advanced-features">Advanced Features</a></h2>
<h3 id="multi-version-concurrency-mvcc"><a class="header" href="#multi-version-concurrency-mvcc">Multi-Version Concurrency (MVCC)</a></h3>
<p>The Table Manager coordinates with the Transaction Manager to provide MVCC for concurrent access.</p>
<p><strong>Version Chain Management</strong>:</p>
<pre><code>Record Versions within Table:
Latest â”€â”€â†’ Version 2 â”€â”€â†’ Version 1 â”€â”€â†’ Version 0
  â”‚           â”‚            â”‚            â”‚
Active      TX-127       TX-123       TX-100
Reader      (visible)    (historical) (old)
</code></pre>
<p><strong>How MVCC Works with Tables</strong>:</p>
<ul>
<li><strong>Per-Record Versioning</strong>: Each record can have multiple versions</li>
<li><strong>Transaction Coordination</strong>: Table Manager works with Transaction Manager</li>
<li><strong>Version Visibility</strong>: Transactions see appropriate record versions</li>
<li><strong>Garbage Collection</strong>: Old versions cleaned up automatically</li>
</ul>
<p><strong>Table-Level MVCC Operations</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Table {
    fn read_at_timestamp(&amp;self, record_id: RecordId, timestamp: u64) -&gt; Option&lt;&amp;Record&gt; {
        let versions = self.get_version_chain(record_id)?;
        versions.find_version_at_timestamp(timestamp)
    }
    
    fn create_new_version(&amp;mut self, record_id: RecordId, data: &amp;[u8]) -&gt; Result&lt;()&gt; {
        // Create new version while keeping old ones for concurrent readers
        let new_version = self.allocate_version_slot()?;
        self.write_version(new_version, data)?;
        self.link_to_version_chain(record_id, new_version)?;
        Ok(())
    }
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Benefits</strong>:</p>
<ul>
<li><strong>No Read Blocks</strong>: Readers never block writers or other readers</li>
<li><strong>Consistent Snapshots</strong>: Each transaction sees consistent data</li>
<li><strong>High Concurrency</strong>: Multiple transactions can operate simultaneously</li>
<li><strong>Table Isolation</strong>: MVCC handled independently per table</li>
</ul>
<h3 id="schema-management"><a class="header" href="#schema-management">Schema Management</a></h3>
<p>Each table has its own schema that defines the structure of its records.</p>
<p><strong>Table Schema Components</strong>:</p>
<ul>
<li><strong>Field Definitions</strong>: Name, type, offset, size for each field</li>
<li><strong>Schema Version</strong>: Track evolution over time</li>
<li><strong>Validation Rules</strong>: Data type and business rule validation</li>
<li><strong>Default Values</strong>: Used when adding new fields</li>
</ul>
<p><strong>Schema Evolution Process</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Table {
    fn evolve_schema(&amp;mut self, changes: SchemaChanges) -&gt; Result&lt;()&gt; {
        // Validate changes are backward compatible
        self.validate_schema_changes(&amp;changes)?;
        
        // Update schema definition
        let new_version = self.schema.version + 1;
        let new_schema = self.schema.apply_changes(changes, new_version)?;
        
        // All new records use new schema
        self.schema = new_schema;
        
        // Old records still work (lazy migration)
        Ok(())
    }
    
    fn validate_record(&amp;self, data: &amp;[u8]) -&gt; Result&lt;()&gt; {
        self.schema.validate_fields(data)?;
        self.schema.check_business_rules(data)?;
        Ok(())
    }
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Schema Change Types</strong>:</p>
<ul>
<li><strong>Add Field</strong>: New fields get default values for existing records</li>
<li><strong>Deprecate Field</strong>: Mark as unused but don't delete (backward compatibility)</li>
<li><strong>Modify Constraints</strong>: Update validation rules</li>
<li><strong>Version Bump</strong>: Increment schema version</li>
</ul>
<p><strong>Migration Strategy</strong>:</p>
<ul>
<li><strong>Lazy Migration</strong>: Records migrated when accessed</li>
<li><strong>Batch Migration</strong>: Migrate all records during maintenance</li>
<li><strong>Version Coexistence</strong>: Multiple schema versions can coexist</li>
<li><strong>Rollback Support</strong>: Can revert to previous schema version</li>
</ul>
<h3 id="zero-copy-storage"><a class="header" href="#zero-copy-storage">Zero-Copy Storage</a></h3>
<p>Each table implements zero-copy storage for maximum performance.</p>
<p><strong>Table-Level Zero-Copy Implementation</strong>:</p>
<ul>
<li><strong>Direct Memory Layout</strong>: Records stored in CPU-native binary format</li>
<li><strong>No Serialization</strong>: Data ready for immediate use by applications</li>
<li><strong>Memory Alignment</strong>: Fields aligned for optimal CPU cache performance</li>
<li><strong>Type-Safe Access</strong>: Schema ensures correct data interpretation</li>
</ul>
<p><strong>How Tables Store Data</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Table {
    fn write_record_direct(&amp;mut self, slot: SlotIndex, data: &amp;RecordData) -&gt; Result&lt;()&gt; {
        let memory_addr = self.get_slot_address(slot);
        
        // Write header directly to memory
        self.write_header(memory_addr, &amp;data.header)?;
        
        // Write payload directly (no serialization)
        self.write_payload(memory_addr + HEADER_SIZE, &amp;data.payload)?;
        
        // Write footer with checksum
        self.write_footer(memory_addr + HEADER_SIZE + data.payload.len(), &amp;data.footer)?;
        
        Ok(())
    }
    
    fn read_record_direct(&amp;self, slot: SlotIndex) -&gt; Option&lt;&amp;Record&gt; {
        let memory_addr = self.get_slot_address(slot);
        // Direct pointer to memory - no copying or parsing needed
        unsafe { &amp;*(memory_addr as *const Record) }
    }
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Field Storage within Tables</strong>:</p>
<ul>
<li><strong>Integers &amp; Floats</strong>: Stored as native binary (u32, f64, etc.)</li>
<li><strong>Strings</strong>: Offset + length pointer to string data within record</li>
<li><strong>Arrays</strong>: Count + elements (if fixed-size) or offset pointer</li>
<li><strong>Enums</strong>: Smallest integer type that fits all variants</li>
</ul>
<p><strong>Memory Layout Optimization</strong>:</p>
<ul>
<li><strong>Field Grouping</strong>: 8-byte, 4-byte, 2-byte, 1-byte fields grouped together</li>
<li><strong>Cache Line Alignment</strong>: Records aligned to 64-byte boundaries</li>
<li><strong>Padding Elimination</strong>: Packed structures minimize wasted space</li>
</ul>
<h2 id="performance"><a class="header" href="#performance">Performance</a></h2>
<h3 id="data-types-and-storage"><a class="header" href="#data-types-and-storage">Data Types and Storage</a></h3>
<p>Tables optimize storage layout for different data types:</p>
<p><strong>Primitive Types (Direct Storage)</strong>:</p>
<ul>
<li><strong>Integers</strong>: u8, u16, u32, u64, i8, i16, i32, i64 stored as native binary</li>
<li><strong>Floating Point</strong>: f32, f64 stored as IEEE 754 binary</li>
<li><strong>Booleans</strong>: Single byte (0 or 1)</li>
<li><strong>Timestamps</strong>: i64 milliseconds since epoch</li>
<li><strong>Enums</strong>: Smallest integer type that accommodates all variants</li>
</ul>
<p><strong>Complex Types (Offset-Based)</strong>:</p>
<ul>
<li><strong>Strings</strong>: [offset: u16, length: u16] + UTF-8 bytes in payload area</li>
<li><strong>Binary Blobs</strong>: [offset: u16, length: u16] + raw bytes in payload area</li>
<li><strong>Arrays</strong>: Element count + elements (if fixed-size) or offset to data</li>
<li><strong>Optional Fields</strong>: Null bitmask + conditional storage</li>
</ul>
<p><strong>Table-Specific Optimizations</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Example: Orders table layout optimized for trading
struct OrderRecord {
    // Hot fields first (frequently accessed)
    order_id: u64,           // 8 bytes
    price: u64,              // 8 bytes (fixed-point)
    quantity: u64,           // 8 bytes
    timestamp: u64,          // 8 bytes
    
    // 4-byte fields grouped together
    user_id: u32,            // 4 bytes
    symbol_offset: u16,      // 2 bytes
    symbol_len: u16,         // 2 bytes
    
    // Smaller fields at end
    order_type: u8,          // 1 byte
    status: u8,              // 1 byte
    flags: u16,              // 2 bytes
    
    // Total: 48 bytes + variable string data
}
<span class="boring">}</span></code></pre></pre>
<h3 id="performance-comparison"><a class="header" href="#performance-comparison">Performance Comparison</a></h3>
<p><strong>Storage Engine Comparison (Page-Aware + Indexes)</strong>:</p>
<pre><code>Storage Method         | Write Time | Read Time | Memory Use        | Page Efficiency | Index Overhead
-----------------------|------------|-----------|-------------------|-----------------|----------------
Table Manager (Optimized)| ~200ns  | ~50ns     | Table + Indexes   | 100%            | ~24B per record
Traditional Database   | ~5-20ms   | ~2-10ms   | Variable + Indexes| Variable        | High
JSON + Parsing         | ~5Î¼s      | ~3Î¼s      | Text overhead     | N/A             | External indexes
Protocol Buffers       | ~2Î¼s      | ~1.5Î¼us   | Compact binary    | N/A             | External indexes
Redis (In-Memory)      | ~1Î¼s      | ~800ns    | Key-value + hash  | N/A             | Built-in hash
</code></pre>
<p><strong>Table Performance with Page-Aware Design</strong>:</p>
<pre><code>Table Type    | Record Size | Records/Page | Index Size | Read Amplification | Query Throughput
--------------|-------------|--------------|------------|--------------------|------------------
Users         | 256B        | 16 records   | ~24B       | 1x (batch) / 16x   | 1M+ point queries
Orders        | 512B        | 8 records    | ~24B       | 1x (batch) / 8x    | 500K+ range queries
Logs          | 128B        | 32 records   | ~24B       | 1x (batch) / 32x   | 2M+ indexed inserts
Config        | 1024B       | 4 records    | ~24B       | 1x (batch) / 4x    | 100K+ updates
</code></pre>
<p><strong>Index Performance Breakdown (Page-Aware)</strong>:</p>
<pre><code>Operation Type          | Primary Index | Secondary Index | Page Load | Total Time (Single/Batch)
------------------------|---------------|-----------------|-----------|-------------------------
Point Query (by ID)     | ~30ns        | N/A            | ~200ns    | ~250ns / ~50ns (amortized)
Secondary Field Query   | ~30ns        | ~100ns         | ~200ns    | ~330ns / ~130ns (amortized)
Range Query            | ~30ns        | ~200ns         | ~500ns    | ~730ns / ~200ns (batch)
Insert (with indexes)   | ~50ns        | ~150ns         | ~300ns    | ~500ns / ~200ns (batch)
Update (with indexes)   | ~50ns        | ~300ns         | ~300ns    | ~650ns / ~300ns (batch)
Delete (with indexes)   | ~50ns        | ~150ns         | ~200ns    | ~400ns / ~150ns (batch)
</code></pre>
<p><strong>Architectural Benefits (Page-Aware Design)</strong>:</p>
<pre><code>Aspect              | Traditional DB      | Table Manager (Page-Aware)
--------------------|--------------------|--------------------------
Data Access         | SQL parse + execute | Direct memory read
Memory Layout       | Row-based mixed     | Page-aligned, type-grouped
Fragmentation       | Variable row sizes  | Fixed slots per table
Type Safety         | Runtime validation  | Compile-time schema
Transaction Scope   | Database-wide       | Table-level isolation
Scaling             | Vertical mainly     | Horizontal per table
Page Efficiency     | Variable            | 100% (perfect divisors)
Read Amplification  | High                | 1-32x (batch optimized)
Write Amplification | High                | 1-32x (batch optimized)
Cache Utilization   | Poor                | Excellent (page locality)
</code></pre>
<h3 id="optimization-strategies"><a class="header" href="#optimization-strategies">Optimization Strategies</a></h3>
<p><strong>Table-Level Optimizations</strong>:</p>
<ul>
<li><strong>Page-Aligned Records</strong>: Choose record sizes as perfect divisors of 4KB</li>
<li><strong>Hot Field Grouping</strong>: Place frequently accessed fields at record start</li>
<li><strong>Cache Line Alignment</strong>: Align records to 64-byte CPU cache boundaries</li>
<li><strong>NUMA Locality</strong>: Allocate tables on local NUMA nodes</li>
<li><strong>Batch Operations</strong>: Process multiple records within same page</li>
<li><strong>Page Locality</strong>: Allocate related records in same pages when possible</li>
</ul>
<p><strong>Memory Management</strong>:</p>
<ul>
<li><strong>Page-Aware Pools</strong>: Each table manages page-aligned memory regions</li>
<li><strong>Page-Level Allocation</strong>: Allocate records in page-aware manner</li>
<li><strong>Prefault Pages</strong>: Pre-fault memory pages during table initialization</li>
<li><strong>Huge Pages</strong>: Use 2MB/1GB pages to reduce TLB pressure</li>
<li><strong>Memory Locking</strong>: Lock critical tables in physical memory</li>
<li><strong>Hot Page Caching</strong>: Keep frequently accessed pages in faster memory</li>
</ul>
<p><strong>Storage Tiering</strong>:</p>
<ul>
<li><strong>Hot Tables</strong>: Active tables on local NVMe storage</li>
<li><strong>Warm Tables</strong>: Infrequently accessed tables on network storage</li>
<li><strong>Cold Tables</strong>: Archived tables with compression on object storage</li>
</ul>
<h2 id="page-aware-storage-design"><a class="header" href="#page-aware-storage-design">Page-Aware Storage Design</a></h2>
<h3 id="readwrite-amplification-problem"><a class="header" href="#readwrite-amplification-problem">Read/Write Amplification Problem</a></h3>
<p><strong>The Core Issue</strong>:
Memory-mapped files operate at the OS page level (typically 4KB), but our records might be much smaller. This creates a significant read/write amplification problem.</p>
<p><strong>Amplification Analysis</strong>:</p>
<pre><code>OS Page Size: 4KB (4096 bytes)
Record Sizes and Amplification:

Record Size | Records/Page | Read Amplification | Write Amplification
------------|--------------|--------------------|--------------------- 
128B        | 32 records   | 32x (4096/128)     | Up to 32x
256B        | 16 records   | 16x (4096/256)     | Up to 16x  
512B        | 8 records    | 8x (4096/512)      | Up to 8x
1024B       | 4 records    | 4x (4096/1024)     | Up to 4x
2048B       | 2 records    | 2x (4096/2048)     | Up to 2x
4096B       | 1 record     | 1x (perfect)       | 1x (perfect)
</code></pre>
<p><strong>Real-World Impact</strong>:</p>
<ul>
<li><strong>Single Record Access</strong>: Reading 128B record loads entire 4KB page (32x amplification)</li>
<li><strong>Single Record Update</strong>: Modifying 128B record may cause 4KB page writeback</li>
<li><strong>Cache Pollution</strong>: Unwanted data loaded into CPU caches</li>
<li><strong>Memory Bandwidth</strong>: Wasted memory bandwidth on unused data</li>
<li><strong>I/O Overhead</strong>: Higher I/O load than necessary</li>
</ul>
<p><strong>Why This Matters for Performance</strong>:</p>
<pre><code>Example: Orders table with 128B records
- Application reads 1 order
- OS loads 4KB page (32 orders)  
- CPU cache filled with 31 unwanted orders
- Memory bandwidth: 32x higher than needed
- If page is dirty: 4KB write for 128B change
</code></pre>
<h3 id="page-aligned-record-layout"><a class="header" href="#page-aligned-record-layout">Page-Aligned Record Layout</a></h3>
<p><strong>Strategy 1: Optimal Record Sizing</strong>:
Design record sizes to be friendly divisors of 4KB page size.</p>
<p><strong>Page-Friendly Record Sizes</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Optimal record sizes for 4KB pages
const PAGE_SIZE: usize = 4096;

// Perfect divisors (no wasted space)
const RECORD_SIZE_512B: usize = 512;   // 8 records per page
const RECORD_SIZE_1024B: usize = 1024; // 4 records per page  
const RECORD_SIZE_2048B: usize = 2048; // 2 records per page
const RECORD_SIZE_4096B: usize = 4096; // 1 record per page

// Good divisors (minimal waste)
const RECORD_SIZE_256B: usize = 256;   // 16 records per page
const RECORD_SIZE_1365B: usize = 1365; // 3 records per page (3B waste)
<span class="boring">}</span></code></pre></pre>
<p><strong>Table Design with Page Awareness</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct PageAwareTable {
    record_size: usize,
    records_per_page: usize,
    page_count: usize,
    
    // Page-aligned memory mapping
    memory_map: MemoryMap,
    
    // Page-level metadata
    page_headers: Vec&lt;PageHeader&gt;,
    
    // Hot page tracking
    hot_pages: HashSet&lt;PageIndex&gt;,
}

struct PageHeader {
    page_index: u32,
    used_slots: u16,        // How many records in this page
    free_slots: u16,        // Available slots
    dirty: bool,            // Page has been modified
    access_count: u32,      // For hot page detection
    last_access: Timestamp,
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Strategy 2: Page-Level Record Organization</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl PageAwareTable {
    fn allocate_record(&amp;mut self) -&gt; Result&lt;(PageIndex, SlotIndex)&gt; {
        // Try to allocate in a page with existing records (better cache locality)
        if let Some(page_idx) = self.find_page_with_space() {
            let slot_idx = self.allocate_slot_in_page(page_idx)?;
            return Ok((page_idx, slot_idx));
        }
        
        // Allocate new page if needed
        let page_idx = self.allocate_new_page()?;
        let slot_idx = 0; // First slot in new page
        Ok((page_idx, slot_idx))
    }
    
    fn find_page_with_space(&amp;self) -&gt; Option&lt;PageIndex&gt; {
        // Prefer hot pages with available space
        for &amp;page_idx in &amp;self.hot_pages {
            if self.page_headers[page_idx].free_slots &gt; 0 {
                return Some(page_idx);
            }
        }
        
        // Fall back to any page with space
        self.page_headers
            .iter()
            .position(|header| header.free_slots &gt; 0)
    }
}
<span class="boring">}</span></code></pre></pre>
<h3 id="batch-operations"><a class="header" href="#batch-operations">Batch Operations</a></h3>
<p><strong>Page-Level Batch Processing</strong>:
Instead of processing records individually, process entire pages or multiple records within a page.</p>
<p><strong>Batch Read Operations</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Table {
    // Read all records in a page
    fn read_page(&amp;self, page_idx: PageIndex) -&gt; Result&lt;Vec&lt;&amp;Record&gt;&gt; {
        let page_header = &amp;self.page_headers[page_idx];
        let mut records = Vec::with_capacity(page_header.used_slots as usize);
        
        let page_base = self.get_page_address(page_idx);
        for slot_idx in 0..self.records_per_page {
            if self.is_slot_used(page_idx, slot_idx) {
                let record_addr = page_base + (slot_idx * self.record_size);
                let record = unsafe { &amp;*(record_addr as *const Record) };
                records.push(record);
            }
        }
        
        Ok(records)
    }
    
    // Batch query within page range
    fn query_page_range(&amp;self, start_page: PageIndex, end_page: PageIndex, filter: &amp;dyn Fn(&amp;Record) -&gt; bool) -&gt; Vec&lt;&amp;Record&gt; {
        let mut results = Vec::new();
        
        for page_idx in start_page..=end_page {
            // Load entire page at once (amortize page load cost)
            if let Ok(page_records) = self.read_page(page_idx) {
                for record in page_records {
                    if filter(record) {
                        results.push(record);
                    }
                }
            }
        }
        
        results
    }
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Batch Write Operations</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Table {
    // Insert multiple records in same page
    fn batch_insert_in_page(&amp;mut self, page_idx: PageIndex, records: Vec&lt;&amp;[u8]&gt;) -&gt; Result&lt;Vec&lt;RecordId&gt;&gt; {
        let available_slots = self.page_headers[page_idx].free_slots as usize;
        if records.len() &gt; available_slots {
            return Err(Error::PageFull);
        }
        
        let mut record_ids = Vec::with_capacity(records.len());
        
        // Mark page as dirty once
        self.page_headers[page_idx].dirty = true;
        
        for data in records {
            let slot_idx = self.find_free_slot_in_page(page_idx)?;
            let record_id = self.generate_snowflake_id();
            
            self.write_record_to_slot(page_idx, slot_idx, record_id, data)?;
            self.update_indexes(record_id, page_idx, slot_idx)?;
            
            record_ids.push(record_id);
        }
        
        // Update page header once
        self.page_headers[page_idx].used_slots += records.len() as u16;
        self.page_headers[page_idx].free_slots -= records.len() as u16;
        
        Ok(record_ids)
    }
}
<span class="boring">}</span></code></pre></pre>
<h3 id="hot-page-management"><a class="header" href="#hot-page-management">Hot Page Management</a></h3>
<p><strong>Hot Page Detection and Optimization</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct HotPageManager {
    // Track page access patterns
    page_access_stats: HashMap&lt;PageIndex, PageAccessStats&gt;,
    
    // Currently hot pages (kept in faster storage/memory)
    hot_pages: LruCache&lt;PageIndex, PageData&gt;,
    
    // Configuration
    hot_threshold: u32,        // Access count to be considered hot
    hot_page_limit: usize,     // Max number of hot pages to track
}

struct PageAccessStats {
    access_count: u32,
    last_access: Timestamp,
    access_pattern: AccessPattern, // Sequential, Random, etc.
}

impl HotPageManager {
    fn on_page_access(&amp;mut self, page_idx: PageIndex) {
        let stats = self.page_access_stats.entry(page_idx).or_default();
        stats.access_count += 1;
        stats.last_access = now();
        
        // Promote to hot if threshold reached
        if stats.access_count &gt;= self.hot_threshold {
            self.promote_to_hot_page(page_idx);
        }
    }
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Page-Aware Query Optimization</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Table {
    fn optimize_query_for_pages(&amp;self, record_ids: Vec&lt;RecordId&gt;) -&gt; Vec&lt;&amp;Record&gt; {
        // Group record IDs by their page location
        let mut records_by_page: HashMap&lt;PageIndex, Vec&lt;(SlotIndex, RecordId)&gt;&gt; = HashMap::new();
        
        for record_id in record_ids {
            if let Some(slot_idx) = self.primary_index.get(record_id) {
                let page_idx = slot_idx / self.records_per_page;
                let page_slot = slot_idx % self.records_per_page;
                records_by_page.entry(page_idx).or_default().push((page_slot, record_id));
            }
        }
        
        let mut results = Vec::new();
        
        // Process each page once, collecting all needed records
        for (page_idx, page_records) in records_by_page {
            // Load page once
            let page_base = self.get_page_address(page_idx);
            
            // Collect all records from this page
            for (slot_idx, _record_id) in page_records {
                let record_addr = page_base + (slot_idx * self.record_size);
                let record = unsafe { &amp;*(record_addr as *const Record) };
                results.push(record);
            }
        }
        
        results
    }
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Performance Impact of Page-Aware Design</strong>:</p>
<pre><code>Optimization Strategy          | Read Amplification | Write Amplification | Performance Gain
------------------------------|--------------------|--------------------|------------------
Original (128B records)       | 32x               | 32x                | Baseline
Page-Aligned (512B records)   | 8x                | 8x                 | 4x improvement
Batch Operations (8 at once)  | 4x                | 4x                 | 8x improvement
Hot Page Caching              | 1x (for hot data) | 1x (for hot data) | 10-32x improvement
Combined Optimizations         | 1-4x              | 1-4x               | 10-30x improvement
</code></pre>
<h2 id="data-integrity"><a class="header" href="#data-integrity">Data Integrity</a></h2>
<p><strong>Table-Level Validation</strong>:</p>
<ul>
<li><strong>Schema Validation</strong>: Each table validates records against its schema</li>
<li><strong>Business Rules</strong>: Table-specific validation logic</li>
<li><strong>Reference Integrity</strong>: Cross-table reference validation</li>
<li><strong>Data Quality</strong>: Range, format, and constraint checking</li>
</ul>
<p><strong>Integrity Protection Mechanisms</strong>:</p>
<ul>
<li><strong>Record Checksums</strong>: CRC32 checksums for fast corruption detection</li>
<li><strong>Table Checksums</strong>: Validate entire table integrity periodically</li>
<li><strong>Cryptographic Hashes</strong>: Strong protection for sensitive tables</li>
<li><strong>Error Correction</strong>: Reed-Solomon codes for critical data</li>
<li><strong>Audit Trails</strong>: Track all changes for compliance and debugging</li>
</ul>
<p><strong>Table-Level Integrity Operations</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Table {
    fn validate_integrity(&amp;self) -&gt; Result&lt;()&gt; {
        // Check all record checksums
        for slot in self.used_slots() {
            let record = self.get_slot(slot);
            record.verify_checksum()?;
        }
        
        // Validate table-level constraints
        self.schema.validate_table_constraints(self)?;
        
        // Check cross-references if any
        self.validate_foreign_keys()?;
        
        Ok(())
    }
}
<span class="boring">}</span></code></pre></pre>
<h2 id="catalog-system"><a class="header" href="#catalog-system">Catalog System</a></h2>
<p>The catalog manages metadata about all tables and schemas in the Table Manager.</p>
<h3 id="catalog-structure"><a class="header" href="#catalog-structure">Catalog Structure</a></h3>
<p><strong>Table Registry</strong>:</p>
<ul>
<li><strong>Table Metadata</strong>: Name, ID, record size, schema version</li>
<li><strong>Storage Location</strong>: File paths and memory pool information</li>
<li><strong>Schema Definitions</strong>: Current and historical schema versions</li>
<li><strong>Index Registry</strong>: Secondary indexes for each table</li>
<li><strong>Statistics</strong>: Record counts, access patterns, performance metrics</li>
</ul>
<p><strong>Catalog Data Structure</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct TableCatalog {
    // Table registry for fast lookup
    tables: HashMap&lt;String, TableInfo&gt;,
    
    // Schema cache for validation
    schemas: HashMap&lt;u32, Schema&gt;,
    
    // Index registry per table
    table_indexes: HashMap&lt;TableId, IndexRegistry&gt;,
    
    // System metadata
    system_info: SystemMetadata,
}

struct TableInfo {
    table_id: u32,
    name: String,
    record_size: u32,
    schema_version: u32,
    file_path: PathBuf,
    memory_pool: MemoryPoolInfo,
    index_files: IndexFileInfo,        // New: index file locations
    statistics: TableStats,
    created_at: Timestamp,
}

struct IndexRegistry {
    primary_index: PrimaryIndexInfo,
    secondary_indexes: HashMap&lt;String, SecondaryIndexInfo&gt;,
    index_memory_usage: usize,
}

struct IndexFileInfo {
    primary_index_file: PathBuf,       // primary.idx
    secondary_index_dir: PathBuf,      // indexes/
    index_metadata_file: PathBuf,      // indexes.meta
}
<span class="boring">}</span></code></pre></pre>
<h3 id="catalog-operations"><a class="header" href="#catalog-operations">Catalog Operations</a></h3>
<p><strong>Core Table Operations</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl TableManager {
    // Create new table with schema and indexes
    fn create_table(&amp;mut self, name: String, schema: Schema) -&gt; Result&lt;TableId&gt; {
        let table_info = TableInfo::new(name, schema)?;
        
        // Register table in catalog
        self.catalog.register_table(table_info)?;
        
        // Initialize table storage
        self.initialize_table_storage(&amp;table_info)?;
        
        // Create primary index
        self.create_primary_index(table_info.table_id)?;
        
        // Create default secondary indexes based on schema
        self.create_default_secondary_indexes(table_info.table_id, &amp;table_info.schema)?;
        
        Ok(table_info.table_id)
    }
    
    // Get table by name for operations  
    fn get_table(&amp;self, name: &amp;str) -&gt; Option&lt;&amp;Table&gt; {
        let table_info = self.catalog.get_table_info(name)?;
        self.tables.get(&amp;table_info.table_id)
    }
    
    // Create secondary index on table
    fn create_index(&amp;mut self, table_name: &amp;str, field_name: &amp;str, index_type: IndexType) -&gt; Result&lt;()&gt; {
        let table = self.get_table_mut(table_name)?;
        let index_info = SecondaryIndexInfo {
            name: format!("{}_{}", table_name, field_name),
            field: field_name.to_string(),
            index_type,
        };
        
        // Create and build the index
        let index = self.build_secondary_index(&amp;index_info, table)?;
        table.add_secondary_index(index_info.name.clone(), index);
        
        // Update catalog
        self.catalog.register_secondary_index(table.table_id, index_info)?;
        
        Ok(())
    }
    
    // Update table schema (handles index updates)
    fn evolve_table_schema(&amp;mut self, name: &amp;str, changes: SchemaChanges) -&gt; Result&lt;()&gt; {
        let table = self.get_table_mut(name)?;
        
        // Check if schema changes affect existing indexes
        let affected_indexes = self.find_affected_indexes(&amp;table.table_id, &amp;changes)?;
        
        // Update schema
        table.evolve_schema(changes)?;
        self.catalog.update_schema(name, &amp;table.schema)?;
        
        // Rebuild affected secondary indexes
        for index_name in affected_indexes {
            self.rebuild_secondary_index(&amp;table.table_id, &amp;index_name)?;
        }
        
        Ok(())
    }
}
<span class="boring">}</span></code></pre></pre>
<h3 id="catalog-persistence"><a class="header" href="#catalog-persistence">Catalog Persistence</a></h3>
<p><strong>Persistence Strategy</strong>:</p>
<ul>
<li><strong>Atomic Updates</strong>: All catalog changes written atomically</li>
<li><strong>Recovery Support</strong>: Catalog rebuilds table registry on startup</li>
<li><strong>Version Control</strong>: Track schema evolution over time</li>
<li><strong>Backup Integration</strong>: Catalog metadata included in snapshots</li>
</ul>
<p><strong>Bootstrap Sequence</strong>:</p>
<ol>
<li>Load catalog metadata from persistent storage</li>
<li>Validate all table files and index files exist and are accessible</li>
<li>Initialize table memory pools and allocation bitmaps</li>
<li>Load primary indexes into memory (critical for O(1) access)</li>
<li>Load or rebuild secondary indexes based on configuration</li>
<li>Verify index consistency with record data</li>
<li>Mark catalog and indexes as ready for operations</li>
</ol>
<p><strong>Index Recovery Strategy</strong>:</p>
<ul>
<li><strong>Primary Index</strong>: Always rebuilt if corrupted (scan all records)</li>
<li><strong>Secondary Indexes</strong>: Can be rebuilt from primary index + record data</li>
<li><strong>Crash Recovery</strong>: Detect incomplete index updates and replay/rollback</li>
<li><strong>Consistency Check</strong>: Verify index entries match actual record slots</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="core-storage-components"><a class="header" href="#core-storage-components">Core Storage Components</a></h1>
<p>This chapter covers the key storage components that work alongside the Record Manager to provide a complete storage solution.</p>
<h2 id="memory-pool-manager"><a class="header" href="#memory-pool-manager">Memory Pool Manager</a></h2>
<p><strong>Memory Layout Strategy</strong>:</p>
<pre><code>Virtual Address Space Allocation:
â”œâ”€â”€ Data Regions (Multiple files)
â”‚   â”œâ”€â”€ Primary Data File (records.dat)
â”‚   â”œâ”€â”€ Overflow Data File (overflow.dat)
â”‚   â””â”€â”€ Archive Data File (archive.dat)
â”œâ”€â”€ Index Regions (Multiple files)
â”‚   â”œâ”€â”€ Hash Indexes (hash_*.idx)
â”‚   â”œâ”€â”€ Range Indexes (range_*.idx)
â”‚   â””â”€â”€ Composite Indexes (comp_*.idx)
â””â”€â”€ Control Regions
    â”œâ”€â”€ Metadata (metadata.dat)
    â”œâ”€â”€ WAL (wal.dat)
    â””â”€â”€ Free Space Maps (freemap.dat)
</code></pre>
<p><strong>Memory Mapping Configuration</strong>:</p>
<ul>
<li><strong>File Pre-allocation</strong>: Create large files and map entire regions</li>
<li><strong>Huge Page Support</strong>: Use 2MB/1GB pages to reduce TLB pressure</li>
<li><strong>NUMA Optimization</strong>: Allocate on local NUMA nodes</li>
<li><strong>Page Fault Minimization</strong>: Pre-fault critical pages during startup</li>
</ul>
<h2 id="index-manager"><a class="header" href="#index-manager">Index Manager</a></h2>
<p><strong>Index Types Supported</strong>:</p>
<p><strong>Hash Indexes</strong>:</p>
<ul>
<li>Primary key lookups (O(1) average case)</li>
<li>Composite key lookups</li>
<li>Configurable hash functions and collision handling</li>
</ul>
<p><strong>Range Indexes</strong>:</p>
<ul>
<li>Sorted access patterns (B+ tree style in memory)</li>
<li>Range queries and scans</li>
<li>Multi-column sorting support</li>
</ul>
<p><strong>Bitmap Indexes</strong>:</p>
<ul>
<li>Categorical data with low cardinality</li>
<li>Fast set operations (AND, OR, NOT)</li>
<li>Compressed representation</li>
</ul>
<p><strong>Index File Structure</strong>:</p>
<pre><code>Index File Layout:
â”œâ”€â”€ Index Header (metadata, statistics)
â”œâ”€â”€ Index Structure (hash table/tree nodes)
â”œâ”€â”€ Key Storage (variable length keys)
â””â”€â”€ Overflow Areas (collision handling)
</code></pre>
<h2 id="write-ahead-log-wal-system"><a class="header" href="#write-ahead-log-wal-system">Write-Ahead Log (WAL) System</a></h2>
<p><strong>WAL Architecture</strong>:</p>
<pre><code>WAL Components:
â”œâ”€â”€ In-Memory Write Buffer (circular buffer)
â”œâ”€â”€ Background Flush Thread
â”œâ”€â”€ WAL File Management (rotation, cleanup)
â””â”€â”€ Recovery Coordinator
</code></pre>
<p><strong>WAL Entry Structure</strong>:</p>
<ul>
<li>Transaction ID and sequence number</li>
<li>Operation type (INSERT/UPDATE/DELETE)</li>
<li>Before/after images for updates</li>
<li>Checksum for integrity verification</li>
<li>Timestamp for recovery ordering</li>
</ul>
<p><strong>Flush Strategies</strong>:</p>
<ul>
<li><strong>Immediate</strong>: Sync after each transaction (highest durability)</li>
<li><strong>Batched</strong>: Group commits for higher throughput</li>
<li><strong>Async</strong>: Background flushing for maximum performance</li>
<li><strong>Configurable</strong>: Per-table or per-operation settings</li>
</ul>
<h2 id="transaction-management"><a class="header" href="#transaction-management">Transaction Management</a></h2>
<p><strong>Concurrency Control</strong>:</p>
<ul>
<li><strong>MVCC (Multi-Version Concurrency Control)</strong>: Support concurrent readers/writers</li>
<li><strong>Optimistic Locking</strong>: Detect conflicts at commit time</li>
<li><strong>Lock-Free Reads</strong>: Readers don't block writers</li>
<li><strong>Configurable Isolation</strong>: Support different isolation levels</li>
</ul>
<p><strong>Transaction Lifecycle</strong>:</p>
<pre><code>Transaction Flow:
1. Begin â†’ Acquire transaction ID
2. Operations â†’ Log to private buffer
3. Commit â†’ Validate + Write to WAL
4. Complete â†’ Update indexes + notify
5. Cleanup â†’ Release resources
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="file-system-integration"><a class="header" href="#file-system-integration">File System Integration</a></h1>
<h2 id="file-organization"><a class="header" href="#file-organization">File Organization</a></h2>
<p><strong>Directory Structure</strong>:</p>
<pre><code>storage_root/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ records.dat          # Primary record storage
â”‚   â””â”€â”€ overflow.dat         # Overflow record storage
â”œâ”€â”€ indexes/
â”‚   â”œâ”€â”€ primary.idx          # Primary key index
â”‚   â”œâ”€â”€ user.idx            # User-based index
â”‚   â”œâ”€â”€ timestamp.idx       # Time-based index
â”‚   â””â”€â”€ composite.idx       # Multi-field indexes
â”œâ”€â”€ wal/
â”‚   â”œâ”€â”€ current.wal
â”‚   â””â”€â”€ archived/
â”œâ”€â”€ snapshots/
â””â”€â”€ metadata/
    â”œâ”€â”€ schema.meta
    â””â”€â”€ config.meta
</code></pre>
<p><strong>File Sizing Strategy</strong>:</p>
<ul>
<li><strong>Initial Size</strong>: Pre-allocate files based on capacity planning</li>
<li><strong>Growth Strategy</strong>: Exponential growth with configurable limits</li>
<li><strong>Compaction</strong>: Background compaction to reclaim space</li>
<li><strong>Archival</strong>: Move old data to cost-optimized storage</li>
</ul>
<h2 id="storage-tiering"><a class="header" href="#storage-tiering">Storage Tiering</a></h2>
<p><strong>Multi-Tier Storage Architecture</strong>:</p>
<pre><code>Storage Tiers:
â”œâ”€â”€ Hot Tier (Local NVMe) - UNCOMPRESSED
â”‚   â”œâ”€â”€ Active records and indexes (raw binary)
â”‚   â”œâ”€â”€ Current WAL files (minimal encoding)
â”‚   â””â”€â”€ Frequently accessed data (cache-optimized)
â”œâ”€â”€ Warm Tier (Network Storage) - MINIMAL COMPRESSION
â”‚   â”œâ”€â”€ Recent snapshots (light compression)
â”‚   â”œâ”€â”€ Archived WAL files (batched encoding)
â”‚   â””â”€â”€ Infrequently accessed records (selective compression)
â””â”€â”€ Cold Tier (Object Storage) - HEAVY COMPRESSION
    â”œâ”€â”€ Long-term backups (ZSTD compression)
    â”œâ”€â”€ Historical snapshots (archive formats)
    â””â”€â”€ Compliance archives (maximum compression ratio)
</code></pre>
<p><strong>Compression Strategy by Tier</strong>:</p>
<ul>
<li><strong>Hot Tier</strong>: No compression - prioritize speed over space</li>
<li><strong>Warm Tier</strong>: Optional lightweight compression for cost savings</li>
<li><strong>Cold Tier</strong>: Aggressive compression using ZSTD/LZMA for maximum space efficiency</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="performance-optimization"><a class="header" href="#performance-optimization">Performance Optimization</a></h1>
<h2 id="memory-access-patterns"><a class="header" href="#memory-access-patterns">Memory Access Patterns</a></h2>
<p><strong>Cache-Friendly Design</strong>:</p>
<ul>
<li><strong>Data Locality</strong>: Co-locate related records</li>
<li><strong>Sequential Access</strong>: Optimize for CPU cache lines</li>
<li><strong>Prefetching</strong>: Intelligent data prefetching for range scans</li>
<li><strong>False Sharing Avoidance</strong>: Align data structures to cache lines</li>
</ul>
<p><strong>NUMA Considerations</strong>:</p>
<ul>
<li><strong>Local Memory Access</strong>: Keep data on local NUMA nodes</li>
<li><strong>Cross-Node Coordination</strong>: Minimize remote memory access</li>
<li><strong>Thread Affinity</strong>: Pin threads to specific CPU cores</li>
<li><strong>Memory Interleaving</strong>: Distribute large structures across nodes</li>
</ul>
<h2 id="io-optimization"><a class="header" href="#io-optimization">I/O Optimization</a></h2>
<p><strong>Asynchronous I/O Strategy</strong>:</p>
<ul>
<li><strong>Background Flushing</strong>: Decouple persistence from response time</li>
<li><strong>Batch Operations</strong>: Group I/O operations for efficiency</li>
<li><strong>Direct I/O</strong>: Bypass OS page cache when beneficial</li>
<li><strong>I/O Scheduling</strong>: Use appropriate I/O schedulers (noop, deadline)</li>
</ul>
<p><strong>File System Tuning</strong>:</p>
<ul>
<li><strong>Extent-Based Allocation</strong>: Minimize file fragmentation</li>
<li><strong>Barrier Control</strong>: Selective use of write barriers</li>
<li><strong>Mount Options</strong>: Optimize mount parameters (noatime, etc.)</li>
<li><strong>File System Choice</strong>: XFS or ext4 with appropriate settings</li>
</ul>
<h2 id="concurrency-design"><a class="header" href="#concurrency-design">Concurrency Design</a></h2>
<p><strong>Lock-Free Operations</strong>:</p>
<ul>
<li><strong>Read Operations</strong>: Completely lock-free using atomic operations</li>
<li><strong>Write Coordination</strong>: Minimal locking with fine-grained locks</li>
<li><strong>Index Updates</strong>: Lock-free data structures where possible</li>
<li><strong>Memory Barriers</strong>: Ensure proper ordering of operations</li>
</ul>
<p><strong>Multi-Process Support</strong>:</p>
<ul>
<li><strong>Shared Memory Coordination</strong>: Process-shared synchronization primitives</li>
<li><strong>Reader-Writer Separation</strong>: Dedicated reader and writer processes</li>
<li><strong>Background Maintenance</strong>: Separate processes for compaction and cleanup</li>
<li><strong>Inter-Process Communication</strong>: Efficient IPC for coordination</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="reliability-and-recovery"><a class="header" href="#reliability-and-recovery">Reliability and Recovery</a></h1>
<h2 id="data-integrity-1"><a class="header" href="#data-integrity-1">Data Integrity</a></h2>
<p><strong>Integrity Mechanisms</strong>:</p>
<ul>
<li><strong>Checksums</strong>: Per-record and per-page checksums</li>
<li><strong>Redundancy</strong>: Critical metadata stored redundantly</li>
<li><strong>Validation</strong>: Periodic background integrity checks</li>
<li><strong>Corruption Detection</strong>: Automatic detection and reporting</li>
</ul>
<h2 id="recovery-procedures"><a class="header" href="#recovery-procedures">Recovery Procedures</a></h2>
<p><strong>Recovery Types</strong>:</p>
<p><strong>Crash Recovery</strong>:</p>
<ol>
<li>Validate file system consistency</li>
<li>Load metadata and schema information</li>
<li>Replay WAL from last checkpoint</li>
<li>Rebuild in-memory indexes</li>
<li>Verify cross-reference consistency</li>
</ol>
<p><strong>Point-in-Time Recovery</strong>:</p>
<ol>
<li>Restore from snapshot</li>
<li>Apply WAL entries up to target timestamp</li>
<li>Rebuild affected indexes</li>
<li>Validate recovered state</li>
</ol>
<p><strong>Disaster Recovery</strong>:</p>
<ol>
<li>Failover to secondary datacenter</li>
<li>Sync any missing WAL entries</li>
<li>Promote secondary to primary</li>
<li>Update client routing</li>
</ol>
<h2 id="backup-strategy"><a class="header" href="#backup-strategy">Backup Strategy</a></h2>
<p><strong>Snapshot Management</strong>:</p>
<ul>
<li><strong>Incremental Snapshots</strong>: Track changes since last snapshot</li>
<li><strong>Consistent Snapshots</strong>: Coordinate across all files</li>
<li><strong>Compression</strong>: Reduce snapshot storage costs</li>
<li><strong>Verification</strong>: Validate snapshot integrity</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration-and-api-design"><a class="header" href="#configuration-and-api-design">Configuration and API Design</a></h1>
<h2 id="storage-configuration"><a class="header" href="#storage-configuration">Storage Configuration</a></h2>
<p><strong>Configurable Parameters</strong>:</p>
<ul>
<li><strong>Record Size</strong>: Fixed size per table/schema</li>
<li><strong>Page Size</strong>: Memory page size (4KB, 2MB, 1GB)</li>
<li><strong>Index Types</strong>: Which indexes to maintain</li>
<li><strong>WAL Settings</strong>: Flush frequency, batch size, retention</li>
<li><strong>Memory Limits</strong>: Maximum memory usage per component</li>
</ul>
<h2 id="performance-tuning"><a class="header" href="#performance-tuning">Performance Tuning</a></h2>
<p><strong>Optimization Knobs</strong>:</p>
<ul>
<li><strong>Memory Allocation</strong>: Pool sizes, allocation strategies</li>
<li><strong>Concurrency</strong>: Thread counts, lock granularity</li>
<li><strong>I/O Patterns</strong>: Sync vs async, batch sizes</li>
<li><strong>Cache Policies</strong>: What to keep in memory vs disk</li>
</ul>
<p><strong>Runtime Configuration</strong>:</p>
<ul>
<li><strong>Dynamic Parameters</strong>: Adjustable without restart</li>
<li><strong>Performance Profiles</strong>: Pre-configured setting combinations</li>
<li><strong>Auto-Tuning</strong>: Automatic parameter optimization based on workload</li>
<li><strong>Monitoring Integration</strong>: Performance-driven configuration updates</li>
</ul>
<h2 id="api-design"><a class="header" href="#api-design">API Design</a></h2>
<h3 id="core-operations"><a class="header" href="#core-operations">Core Operations</a></h3>
<p><strong>Record Operations</strong>:</p>
<ul>
<li><code>insert_record&lt;T&gt;(record: T)</code>: Insert record with automatic size class selection</li>
<li><code>insert_record_sized&lt;T&gt;(record: T, size_class: RecordSizeClass)</code>: Insert with explicit size</li>
<li><code>get_record&lt;T&gt;(record_id: u64)</code>: Retrieve record by encoded Snowflake ID (O(1))</li>
<li><code>update_record&lt;T&gt;(record_id: u64, updater: F)</code>: Modify with MVCC versioning</li>
<li><code>delete_record(record_id: u64)</code>: Mark as deleted (soft delete)</li>
<li><code>get_size_class(record_id: u64)</code>: Extract size class from encoded ID</li>
</ul>
<p><strong>Query Operations</strong>:</p>
<ul>
<li><code>scan_records(filter)</code>: Full scan with filtering</li>
<li><code>range_query(index_name, start_key, end_key)</code>: Range-based queries</li>
<li><code>hash_lookup(index_name, key)</code>: Hash index lookups</li>
<li><code>batch_operations(operations_list)</code>: Batch multiple operations</li>
</ul>
<p><strong>Transaction Operations</strong>:</p>
<ul>
<li><code>begin_transaction()</code>: Start new transaction</li>
<li><code>commit_transaction(tx_id)</code>: Commit transaction</li>
<li><code>rollback_transaction(tx_id)</code>: Abort transaction</li>
<li><code>set_isolation_level(level)</code>: Configure transaction isolation</li>
</ul>
<h3 id="management-operations"><a class="header" href="#management-operations">Management Operations</a></h3>
<p><strong>Schema Management</strong>:</p>
<ul>
<li><code>get_schema()</code>: Get current record schema</li>
<li><code>evolve_schema(schema_changes)</code>: Modify record schema</li>
<li><code>create_index(index_definition)</code>: Add new index</li>
<li><code>drop_index(index_name)</code>: Remove index</li>
</ul>
<p><strong>Maintenance Operations</strong>:</p>
<ul>
<li><code>compact_storage()</code>: Reclaim deleted space</li>
<li><code>rebuild_index(index_name)</code>: Rebuild corrupted or fragmented index</li>
<li><code>create_snapshot(snapshot_name)</code>: Create backup snapshot</li>
<li><code>vacuum_wal()</code>: Clean up old WAL entries</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="monitoring-and-observability"><a class="header" href="#monitoring-and-observability">Monitoring and Observability</a></h1>
<h2 id="performance-metrics"><a class="header" href="#performance-metrics">Performance Metrics</a></h2>
<p><strong>Latency Metrics</strong>:</p>
<ul>
<li>Operation latency percentiles (p50, p95, p99, p999)</li>
<li>Lock contention and wait times</li>
<li>Page fault rates and memory stalls</li>
<li>WAL flush latency and throughput</li>
</ul>
<p><strong>Throughput Metrics</strong>:</p>
<ul>
<li>Operations per second by type</li>
<li>Memory bandwidth utilization</li>
<li>Disk I/O patterns and efficiency</li>
<li>Index lookup performance</li>
</ul>
<h2 id="health-monitoring"><a class="header" href="#health-monitoring">Health Monitoring</a></h2>
<p><strong>System Health Indicators</strong>:</p>
<ul>
<li>Memory pressure and allocation failures</li>
<li>File system space and inode usage</li>
<li>Background process health</li>
<li>Consistency check results</li>
</ul>
<p><strong>Alerting Framework</strong>:</p>
<ul>
<li><strong>Critical</strong>: Data corruption, system unavailability</li>
<li><strong>Warning</strong>: Performance degradation, capacity limits</li>
<li><strong>Info</strong>: Background maintenance, configuration changes</li>
</ul>
<h2 id="debugging-and-diagnostics"><a class="header" href="#debugging-and-diagnostics">Debugging and Diagnostics</a></h2>
<p><strong>Diagnostic Tools</strong>:</p>
<ul>
<li><strong>Memory Map Visualization</strong>: Visual representation of memory layout</li>
<li><strong>Transaction Tracing</strong>: Track transaction lifecycle and performance</li>
<li><strong>Lock Analysis</strong>: Identify concurrency bottlenecks</li>
<li><strong>I/O Profiling</strong>: Analyze disk access patterns</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deployment-and-operations"><a class="header" href="#deployment-and-operations">Deployment and Operations</a></h1>
<h2 id="infrastructure-requirements"><a class="header" href="#infrastructure-requirements">Infrastructure Requirements</a></h2>
<p><strong>Hardware Specifications</strong>:</p>
<ul>
<li><strong>Memory</strong>: 64GB+ per instance with ECC</li>
<li><strong>Storage</strong>: Local NVMe SSDs for hot data</li>
<li><strong>CPU</strong>: High-frequency cores with large caches</li>
<li><strong>Network</strong>: Low-latency networking for replication</li>
</ul>
<p><strong>Operating System Tuning</strong>:</p>
<ul>
<li><strong>Kernel Parameters</strong>: Optimize for low latency</li>
<li><strong>Memory Management</strong>: Configure huge pages, swappiness</li>
<li><strong>I/O Scheduler</strong>: Use appropriate schedulers for workload</li>
<li><strong>Process Limits</strong>: Adjust limits for high-performance applications</li>
</ul>
<h2 id="operational-procedures"><a class="header" href="#operational-procedures">Operational Procedures</a></h2>
<p><strong>Deployment Strategy</strong>:</p>
<ul>
<li><strong>Blue-Green Deployment</strong>: Zero-downtime upgrades</li>
<li><strong>Rolling Updates</strong>: Gradual rollout of changes</li>
<li><strong>Canary Testing</strong>: Test changes on subset of traffic</li>
<li><strong>Rollback Procedures</strong>: Quick revert capabilities</li>
</ul>
<p><strong>Maintenance Operations</strong>:</p>
<ul>
<li><strong>Schema Migrations</strong>: Online schema evolution</li>
<li><strong>Index Rebuilding</strong>: Background index maintenance</li>
<li><strong>File Compaction</strong>: Reclaim deleted space</li>
<li><strong>Performance Tuning</strong>: Runtime parameter adjustment</li>
</ul>
<h2 id="high-availability"><a class="header" href="#high-availability">High Availability</a></h2>
<p><strong>Replication Strategy</strong>:</p>
<ul>
<li><strong>Synchronous Replication</strong>: For critical data consistency</li>
<li><strong>Asynchronous Replication</strong>: For read replicas and disaster recovery</li>
<li><strong>Multi-Region Setup</strong>: Geographic distribution for disaster tolerance</li>
<li><strong>Automatic Failover</strong>: Health-check based failover mechanisms</li>
</ul>
<p><strong>Load Distribution</strong>:</p>
<ul>
<li><strong>Read Replicas</strong>: Distribute read load across multiple instances</li>
<li><strong>Partitioning</strong>: Horizontal partitioning for write scalability</li>
<li><strong>Caching Layer</strong>: Additional caching for frequently accessed data</li>
<li><strong>Connection Pooling</strong>: Efficient connection management</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="security-considerations"><a class="header" href="#security-considerations">Security Considerations</a></h1>
<h2 id="data-protection"><a class="header" href="#data-protection">Data Protection</a></h2>
<p><strong>Encryption</strong>:</p>
<ul>
<li><strong>At-Rest Encryption</strong>: File-level encryption for sensitive data</li>
<li><strong>In-Transit Encryption</strong>: TLS for network communication</li>
<li><strong>Key Management</strong>: Integration with key management systems</li>
<li><strong>Field-Level Encryption</strong>: Selective encryption of sensitive fields</li>
</ul>
<p><strong>Access Control</strong>:</p>
<ul>
<li><strong>Authentication</strong>: Strong authentication mechanisms</li>
<li><strong>Authorization</strong>: Role-based access control (RBAC)</li>
<li><strong>Audit Logging</strong>: Comprehensive audit trail</li>
<li><strong>Network Security</strong>: VPC isolation and firewall rules</li>
</ul>
<h2 id="compliance"><a class="header" href="#compliance">Compliance</a></h2>
<p><strong>Regulatory Requirements</strong>:</p>
<ul>
<li><strong>Data Retention</strong>: Configurable retention policies</li>
<li><strong>Data Deletion</strong>: Secure deletion mechanisms</li>
<li><strong>Audit Trails</strong>: Immutable audit logs</li>
<li><strong>Compliance Reporting</strong>: Automated compliance reporting</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="testing-strategy"><a class="header" href="#testing-strategy">Testing Strategy</a></h1>
<h2 id="performance-testing"><a class="header" href="#performance-testing">Performance Testing</a></h2>
<p><strong>Load Testing</strong>:</p>
<ul>
<li><strong>Stress Testing</strong>: Test beyond normal capacity limits</li>
<li><strong>Endurance Testing</strong>: Long-running stability tests</li>
<li><strong>Spike Testing</strong>: Handle sudden load increases</li>
<li><strong>Volume Testing</strong>: Test with large datasets</li>
</ul>
<p><strong>Benchmarking</strong>:</p>
<ul>
<li><strong>Latency Benchmarks</strong>: Measure operation latencies under various loads</li>
<li><strong>Throughput Benchmarks</strong>: Maximum sustainable throughput</li>
<li><strong>Memory Benchmarks</strong>: Memory usage patterns and efficiency</li>
<li><strong>I/O Benchmarks</strong>: Disk I/O performance characteristics</li>
</ul>
<h2 id="reliability-testing"><a class="header" href="#reliability-testing">Reliability Testing</a></h2>
<p><strong>Fault Injection</strong>:</p>
<ul>
<li><strong>Hardware Failures</strong>: Simulate disk and memory failures</li>
<li><strong>Network Partitions</strong>: Test behavior during network issues</li>
<li><strong>Process Crashes</strong>: Validate recovery procedures</li>
<li><strong>Data Corruption</strong>: Test corruption detection and recovery</li>
</ul>
<p><strong>Recovery Testing</strong>:</p>
<ul>
<li><strong>Crash Recovery</strong>: Validate WAL replay mechanisms</li>
<li><strong>Backup Recovery</strong>: Test snapshot restoration procedures</li>
<li><strong>Disaster Recovery</strong>: Full disaster recovery scenarios</li>
<li><strong>Performance After Recovery</strong>: Ensure performance post-recovery</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="future-enhancements"><a class="header" href="#future-enhancements">Future Enhancements</a></h1>
<h2 id="advanced-features-1"><a class="header" href="#advanced-features-1">Advanced Features</a></h2>
<p><strong>Query Optimization</strong>:</p>
<ul>
<li><strong>Query Planner</strong>: Cost-based query optimization</li>
<li><strong>Adaptive Indexes</strong>: Automatically create beneficial indexes</li>
<li><strong>Caching Layer</strong>: Intelligent caching of frequently accessed data</li>
<li><strong>Parallel Processing</strong>: Multi-threaded query execution</li>
</ul>
<p><strong>Storage Optimization</strong>:</p>
<ul>
<li><strong>Compression</strong>: Adaptive compression based on data patterns</li>
<li><strong>Tiered Storage</strong>: Automatic data migration between tiers</li>
<li><strong>Defragmentation</strong>: Online defragmentation capabilities</li>
<li><strong>Storage Analytics</strong>: Detailed storage usage analytics</li>
</ul>
<h2 id="integration-capabilities"><a class="header" href="#integration-capabilities">Integration Capabilities</a></h2>
<p><strong>External Integration</strong>:</p>
<ul>
<li><strong>Stream Processing</strong>: Integration with stream processing frameworks</li>
<li><strong>Analytics Engines</strong>: Direct integration with analytics platforms</li>
<li><strong>Message Queues</strong>: Event-driven architecture support</li>
<li><strong>Monitoring Systems</strong>: Rich metrics and monitoring integration</li>
</ul>
<p><strong>Cloud Native Features</strong>:</p>
<ul>
<li><strong>Kubernetes Integration</strong>: Native Kubernetes operator</li>
<li><strong>Auto-Scaling</strong>: Automatic scaling based on load</li>
<li><strong>Service Mesh</strong>: Integration with service mesh architectures</li>
<li><strong>Observability</strong>: Cloud-native monitoring and tracing</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="filestoreå®æ–½è·¯çº¿å›¾"><a class="header" href="#filestoreå®æ–½è·¯çº¿å›¾">FileStoreå®æ–½è·¯çº¿å›¾</a></h1>
<h2 id="æ€»ä½“å®æ–½ç­–ç•¥"><a class="header" href="#æ€»ä½“å®æ–½ç­–ç•¥">æ€»ä½“å®æ–½ç­–ç•¥</a></h2>
<h3 id="æ¸è¿›å¼å¼€å‘æ–¹æ³•"><a class="header" href="#æ¸è¿›å¼å¼€å‘æ–¹æ³•">æ¸è¿›å¼å¼€å‘æ–¹æ³•</a></h3>
<p>åŸºäº"æœ€å°å¯è¡Œäº§å“(MVP) â†’ æ ¸å¿ƒåŠŸèƒ½ â†’ é«˜çº§ç‰¹æ€§ â†’ ç”Ÿäº§ä¼˜åŒ–"çš„ç­–ç•¥ï¼Œç¡®ä¿æ¯ä¸ªé˜¶æ®µéƒ½èƒ½äº¤ä»˜å¯ç”¨çš„ç³»ç»Ÿç‰ˆæœ¬ã€‚</p>
<h3 id="æ€§èƒ½é©±åŠ¨çš„é‡Œç¨‹ç¢‘"><a class="header" href="#æ€§èƒ½é©±åŠ¨çš„é‡Œç¨‹ç¢‘">æ€§èƒ½é©±åŠ¨çš„é‡Œç¨‹ç¢‘</a></h3>
<p>æ¯ä¸ªé˜¶æ®µéƒ½æœ‰æ˜ç¡®çš„æ€§èƒ½ç›®æ ‡å’ŒéªŒè¯æ ‡å‡†ï¼š</p>
<ul>
<li><strong>é˜¶æ®µ1</strong>: å®ç°åŸºç¡€åŠŸèƒ½ï¼Œå»¶è¿Ÿ &lt; 10ms</li>
<li><strong>é˜¶æ®µ2</strong>: æ ¸å¿ƒä¼˜åŒ–ï¼Œå»¶è¿Ÿ &lt; 5ms</li>
<li><strong>é˜¶æ®µ3</strong>: æ·±åº¦ä¼˜åŒ–ï¼Œå»¶è¿Ÿ &lt; 2ms</li>
<li><strong>é˜¶æ®µ4</strong>: æè‡´ä¼˜åŒ–ï¼Œå»¶è¿Ÿ &lt; 1ms</li>
</ul>
<h2 id="ç¬¬ä¸€é˜¶æ®µåŸºç¡€æ¶æ„å»ºè®¾-1-3ä¸ªæœˆ"><a class="header" href="#ç¬¬ä¸€é˜¶æ®µåŸºç¡€æ¶æ„å»ºè®¾-1-3ä¸ªæœˆ">ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¶æ„å»ºè®¾ (1-3ä¸ªæœˆ)</a></h2>
<h3 id="-æ ¸å¿ƒç›®æ ‡"><a class="header" href="#-æ ¸å¿ƒç›®æ ‡">ğŸ¯ æ ¸å¿ƒç›®æ ‡</a></h3>
<p>å»ºç«‹å¯å·¥ä½œçš„å­˜å‚¨å¼•æ“åŸå‹ï¼Œå®ç°åŸºæœ¬çš„è¯»å†™åŠŸèƒ½ï¼Œä¸ºåç»­ä¼˜åŒ–å¥ å®šåŸºç¡€ã€‚</p>
<h3 id="-å…³é”®äº¤ä»˜ç‰©"><a class="header" href="#-å…³é”®äº¤ä»˜ç‰©">ğŸ“‹ å…³é”®äº¤ä»˜ç‰©</a></h3>
<h4 id="11-ç¡¬ä»¶æŠ½è±¡å±‚å®ç°-3-4å‘¨"><a class="header" href="#11-ç¡¬ä»¶æŠ½è±¡å±‚å®ç°-3-4å‘¨">1.1 ç¡¬ä»¶æŠ½è±¡å±‚å®ç° (3-4å‘¨)</a></h4>
<p><strong>ä»»åŠ¡åˆ—è¡¨</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"/>
NVMeè®¾å¤‡ç›´æ¥è®¿é—®æ¥å£</li>
<li><input disabled="" type="checkbox"/>
NUMAå†…å­˜ç®¡ç†å™¨</li>
<li><input disabled="" type="checkbox"/>
é¡µé¢å¯¹é½çš„å†…å­˜åˆ†é…å™¨</li>
<li><input disabled="" type="checkbox"/>
åŸºç¡€æ€§èƒ½ç›‘æ§æ¡†æ¶</li>
</ul>
<p><strong>æŠ€æœ¯å®ç°</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// å…³é”®ç»„ä»¶æ¶æ„
struct HardwareLayer {
    nvme_manager: NVMeManager,
    numa_allocator: NumaAllocator,
    page_allocator: PageAllocator,
    metrics_collector: MetricsCollector,
}
<span class="boring">}</span></code></pre></pre>
<p><strong>éªŒæ”¶æ ‡å‡†</strong>:</p>
<ul>
<li>NVMeè¯»å†™å»¶è¿Ÿ &lt; 100Î¼s</li>
<li>å†…å­˜åˆ†é…å»¶è¿Ÿ &lt; 1Î¼s</li>
<li>NUMAæœ¬åœ°æ€§ &gt; 90%</li>
</ul>
<h4 id="12-å­˜å‚¨å¼•æ“æ ¸å¿ƒ-4-5å‘¨"><a class="header" href="#12-å­˜å‚¨å¼•æ“æ ¸å¿ƒ-4-5å‘¨">1.2 å­˜å‚¨å¼•æ“æ ¸å¿ƒ (4-5å‘¨)</a></h4>
<p><strong>ä»»åŠ¡åˆ—è¡¨</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"/>
å†…å­˜æ˜ å°„æ–‡ä»¶ç®¡ç†å™¨</li>
<li><input disabled="" type="checkbox"/>
å›ºå®šå¤§å°è®°å½•ç®¡ç†å™¨</li>
<li><input disabled="" type="checkbox"/>
åŸºç¡€è¡¨ç»“æ„å®ç°</li>
<li><input disabled="" type="checkbox"/>
ç®€å•çš„ä¸»ç´¢å¼•ç³»ç»Ÿ</li>
</ul>
<p><strong>æŠ€æœ¯å®ç°</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// æ ¸å¿ƒå­˜å‚¨ç»“æ„
struct StorageEngine {
    memory_manager: MemoryManager,
    table_registry: TableRegistry,
    primary_indexes: HashMap&lt;TableId, PrimaryIndex&gt;,
}
<span class="boring">}</span></code></pre></pre>
<p><strong>éªŒæ”¶æ ‡å‡†</strong>:</p>
<ul>
<li>æ”¯æŒç™¾ä¸‡çº§è®°å½•å­˜å‚¨</li>
<li>ç‚¹æŸ¥è¯¢å»¶è¿Ÿ &lt; 5ms</li>
<li>æ’å…¥æ“ä½œå»¶è¿Ÿ &lt; 10ms</li>
</ul>
<h4 id="13-æŒä¹…åŒ–åŸºç¡€è®¾æ–½-3-4å‘¨"><a class="header" href="#13-æŒä¹…åŒ–åŸºç¡€è®¾æ–½-3-4å‘¨">1.3 æŒä¹…åŒ–åŸºç¡€è®¾æ–½ (3-4å‘¨)</a></h4>
<p><strong>ä»»åŠ¡åˆ—è¡¨</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"/>
WALæ—¥å¿—ç³»ç»Ÿ</li>
<li><input disabled="" type="checkbox"/>
åŸºç¡€å¿«ç…§æœºåˆ¶</li>
<li><input disabled="" type="checkbox"/>
å´©æºƒæ¢å¤æµç¨‹</li>
<li><input disabled="" type="checkbox"/>
æ•°æ®å®Œæ•´æ€§æ ¡éªŒ</li>
</ul>
<p><strong>æŠ€æœ¯å®ç°</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// æŒä¹…åŒ–ç»„ä»¶
struct PersistenceLayer {
    wal_manager: WalManager,
    snapshot_manager: SnapshotManager,
    recovery_manager: RecoveryManager,
}
<span class="boring">}</span></code></pre></pre>
<p><strong>éªŒæ”¶æ ‡å‡†</strong>:</p>
<ul>
<li>WALå†™å…¥å»¶è¿Ÿ &lt; 50Î¼s</li>
<li>æ¢å¤æ—¶é—´ &lt; 30ç§’ (1GBæ•°æ®)</li>
<li>æ•°æ®å®Œæ•´æ€§ 99.999%</li>
</ul>
<h4 id="14-åŸºç¡€apiå±‚-2-3å‘¨"><a class="header" href="#14-åŸºç¡€apiå±‚-2-3å‘¨">1.4 åŸºç¡€APIå±‚ (2-3å‘¨)</a></h4>
<p><strong>ä»»åŠ¡åˆ—è¡¨</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"/>
gRPCæœåŠ¡æ¥å£</li>
<li><input disabled="" type="checkbox"/>
åŸºç¡€CRUDæ“ä½œ</li>
<li><input disabled="" type="checkbox"/>
é”™è¯¯å¤„ç†å’Œæ—¥å¿—</li>
<li><input disabled="" type="checkbox"/>
ç®€å•çš„æ€§èƒ½ç›‘æ§</li>
</ul>
<p><strong>éªŒæ”¶æ ‡å‡†</strong>:</p>
<ul>
<li>æ”¯æŒåŸºç¡€å¢åˆ æ”¹æŸ¥æ“ä½œ</li>
<li>APIå“åº”æ—¶é—´ &lt; 20ms</li>
<li>é”™è¯¯å¤„ç†è¦†ç›–ç‡ 100%</li>
</ul>
<h3 id="-é˜¶æ®µ1æµ‹è¯•éªŒè¯"><a class="header" href="#-é˜¶æ®µ1æµ‹è¯•éªŒè¯">ğŸ§ª é˜¶æ®µ1æµ‹è¯•éªŒè¯</a></h3>
<ul>
<li><strong>å•å…ƒæµ‹è¯•</strong>: è¦†ç›–ç‡ &gt; 80%</li>
<li><strong>é›†æˆæµ‹è¯•</strong>: æ ¸å¿ƒæµç¨‹ç«¯åˆ°ç«¯æµ‹è¯•</li>
<li><strong>æ€§èƒ½æµ‹è¯•</strong>: 1ä¸‡QPSåŸºå‡†æµ‹è¯•</li>
<li><strong>ç¨³å®šæ€§æµ‹è¯•</strong>: è¿ç»­è¿è¡Œ24å°æ—¶</li>
</ul>
<h2 id="ç¬¬äºŒé˜¶æ®µæ ¸å¿ƒåŠŸèƒ½å®Œå–„-4-6ä¸ªæœˆ"><a class="header" href="#ç¬¬äºŒé˜¶æ®µæ ¸å¿ƒåŠŸèƒ½å®Œå–„-4-6ä¸ªæœˆ">ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½å®Œå–„ (4-6ä¸ªæœˆ)</a></h2>
<h3 id="-æ ¸å¿ƒç›®æ ‡-1"><a class="header" href="#-æ ¸å¿ƒç›®æ ‡-1">ğŸ¯ æ ¸å¿ƒç›®æ ‡</a></h3>
<p>å®ç°å®Œæ•´çš„è¡¨ç®¡ç†ç³»ç»Ÿï¼Œæ·»åŠ é«˜çº§ç´¢å¼•å’ŒæŸ¥è¯¢åŠŸèƒ½ï¼Œé›†æˆMVCCå’Œäº‹åŠ¡æ”¯æŒã€‚</p>
<h3 id="-å…³é”®äº¤ä»˜ç‰©-1"><a class="header" href="#-å…³é”®äº¤ä»˜ç‰©-1">ğŸ“‹ å…³é”®äº¤ä»˜ç‰©</a></h3>
<h4 id="21-å®Œæ•´è¡¨ç®¡ç†ç³»ç»Ÿ-4-5å‘¨"><a class="header" href="#21-å®Œæ•´è¡¨ç®¡ç†ç³»ç»Ÿ-4-5å‘¨">2.1 å®Œæ•´è¡¨ç®¡ç†ç³»ç»Ÿ (4-5å‘¨)</a></h4>
<p><strong>ä»»åŠ¡åˆ—è¡¨</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"/>
å®Œæ•´çš„è¡¨æ³¨å†Œä¸­å¿ƒ</li>
<li><input disabled="" type="checkbox"/>
åŠ¨æ€è¡¨åˆ›å»ºå’Œåˆ é™¤</li>
<li><input disabled="" type="checkbox"/>
è¡¨ç»“æ„å˜æ›´æ”¯æŒ</li>
<li><input disabled="" type="checkbox"/>
è¡¨çº§åˆ«çš„æƒé™æ§åˆ¶</li>
</ul>
<p><strong>æŠ€æœ¯å®ç°</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// è¡¨ç®¡ç†ç³»ç»Ÿ
struct TableManager {
    table_registry: TableRegistry,
    schema_manager: SchemaManager,
    table_cache: TableCache,
    access_control: AccessControl,
}
<span class="boring">}</span></code></pre></pre>
<p><strong>éªŒæ”¶æ ‡å‡†</strong>:</p>
<ul>
<li>æ”¯æŒåŠ¨æ€åˆ›å»º/åˆ é™¤è¡¨</li>
<li>è¡¨ç»“æ„å˜æ›´å»¶è¿Ÿ &lt; 1ç§’</li>
<li>æ”¯æŒ100+å¹¶å‘è¡¨æ“ä½œ</li>
</ul>
<h4 id="22-é«˜æ€§èƒ½ç´¢å¼•ç³»ç»Ÿ-5-6å‘¨"><a class="header" href="#22-é«˜æ€§èƒ½ç´¢å¼•ç³»ç»Ÿ-5-6å‘¨">2.2 é«˜æ€§èƒ½ç´¢å¼•ç³»ç»Ÿ (5-6å‘¨)</a></h4>
<p><strong>ä»»åŠ¡åˆ—è¡¨</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"/>
äºŒçº§ç´¢å¼•å®ç° (B+æ ‘/å“ˆå¸Œ)</li>
<li><input disabled="" type="checkbox"/>
ç»„åˆç´¢å¼•æ”¯æŒ</li>
<li><input disabled="" type="checkbox"/>
ç´¢å¼•ç»´æŠ¤å’Œé‡å»º</li>
<li><input disabled="" type="checkbox"/>
æŸ¥è¯¢ä¼˜åŒ–å™¨</li>
</ul>
<p><strong>æŠ€æœ¯å®ç°</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// ç´¢å¼•ç³»ç»Ÿæ¶æ„
struct IndexSystem {
    primary_indexes: HashMap&lt;TableId, PrimaryIndex&gt;,
    secondary_indexes: HashMap&lt;IndexId, SecondaryIndex&gt;,
    query_optimizer: QueryOptimizer,
    index_cache: IndexCache,
}
<span class="boring">}</span></code></pre></pre>
<p><strong>éªŒæ”¶æ ‡å‡†</strong>:</p>
<ul>
<li>æ”¯æŒ5ç§ç´¢å¼•ç±»å‹</li>
<li>ç´¢å¼•æŸ¥è¯¢å»¶è¿Ÿ &lt; 1ms</li>
<li>å¹¶å‘æŸ¥è¯¢åå &gt; 50K QPS</li>
</ul>
<h4 id="23-mvccå’Œäº‹åŠ¡ç®¡ç†-6-7å‘¨"><a class="header" href="#23-mvccå’Œäº‹åŠ¡ç®¡ç†-6-7å‘¨">2.3 MVCCå’Œäº‹åŠ¡ç®¡ç† (6-7å‘¨)</a></h4>
<p><strong>ä»»åŠ¡åˆ—è¡¨</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"/>
MVCCç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ</li>
<li><input disabled="" type="checkbox"/>
äº‹åŠ¡éš”ç¦»çº§åˆ«æ”¯æŒ</li>
<li><input disabled="" type="checkbox"/>
æ­»é”æ£€æµ‹å’Œè§£å†³</li>
<li><input disabled="" type="checkbox"/>
äº‹åŠ¡æ—¥å¿—å’Œå›æ»š</li>
</ul>
<p><strong>æŠ€æœ¯å®ç°</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// äº‹åŠ¡ç®¡ç†ç³»ç»Ÿ
struct TransactionManager {
    mvcc_manager: MvccManager,
    lock_manager: LockManager,
    deadlock_detector: DeadlockDetector,
    transaction_log: TransactionLog,
}
<span class="boring">}</span></code></pre></pre>
<p><strong>éªŒæ”¶æ ‡å‡†</strong>:</p>
<ul>
<li>æ”¯æŒè¯»å·²æäº¤å’Œå¯é‡å¤è¯»éš”ç¦»çº§åˆ«</li>
<li>äº‹åŠ¡å»¶è¿Ÿ &lt; 2ms</li>
<li>å¹¶å‘äº‹åŠ¡æ•° &gt; 1000</li>
</ul>
<h4 id="24-æŸ¥è¯¢æ‰§è¡Œå¼•æ“-4-5å‘¨"><a class="header" href="#24-æŸ¥è¯¢æ‰§è¡Œå¼•æ“-4-5å‘¨">2.4 æŸ¥è¯¢æ‰§è¡Œå¼•æ“ (4-5å‘¨)</a></h4>
<p><strong>ä»»åŠ¡åˆ—è¡¨</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"/>
æŸ¥è¯¢è§£æå’Œä¼˜åŒ–</li>
<li><input disabled="" type="checkbox"/>
å¤šè¡¨è”æ¥æ”¯æŒ</li>
<li><input disabled="" type="checkbox"/>
èšåˆæŸ¥è¯¢å®ç°</li>
<li><input disabled="" type="checkbox"/>
æŸ¥è¯¢ç»“æœç¼“å­˜</li>
</ul>
<p><strong>éªŒæ”¶æ ‡å‡†</strong>:</p>
<ul>
<li>æ”¯æŒå¤æ‚æŸ¥è¯¢è¯­å¥</li>
<li>æŸ¥è¯¢å»¶è¿Ÿ &lt; 5ms</li>
<li>æŸ¥è¯¢ç¼“å­˜å‘½ä¸­ç‡ &gt; 80%</li>
</ul>
<h3 id="-é˜¶æ®µ2æµ‹è¯•éªŒè¯"><a class="header" href="#-é˜¶æ®µ2æµ‹è¯•éªŒè¯">ğŸ§ª é˜¶æ®µ2æµ‹è¯•éªŒè¯</a></h3>
<ul>
<li><strong>åŠŸèƒ½æµ‹è¯•</strong>: å®Œæ•´åŠŸèƒ½è¦†ç›–</li>
<li><strong>æ€§èƒ½æµ‹è¯•</strong>: 10ä¸‡QPSå‹åŠ›æµ‹è¯•</li>
<li><strong>å¹¶å‘æµ‹è¯•</strong>: 1000å¹¶å‘ç”¨æˆ·æµ‹è¯•</li>
<li><strong>å¯é æ€§æµ‹è¯•</strong>: è¿ç»­è¿è¡Œä¸€å‘¨</li>
</ul>
<h2 id="ç¬¬ä¸‰é˜¶æ®µæ€§èƒ½æ·±åº¦ä¼˜åŒ–-7-9ä¸ªæœˆ"><a class="header" href="#ç¬¬ä¸‰é˜¶æ®µæ€§èƒ½æ·±åº¦ä¼˜åŒ–-7-9ä¸ªæœˆ">ç¬¬ä¸‰é˜¶æ®µï¼šæ€§èƒ½æ·±åº¦ä¼˜åŒ– (7-9ä¸ªæœˆ)</a></h2>
<h3 id="-æ ¸å¿ƒç›®æ ‡-2"><a class="header" href="#-æ ¸å¿ƒç›®æ ‡-2">ğŸ¯ æ ¸å¿ƒç›®æ ‡</a></h3>
<p>é€šè¿‡ç¡¬ä»¶æ„ŸçŸ¥ä¼˜åŒ–ã€ç®—æ³•ä¼˜åŒ–å’Œç³»ç»Ÿè°ƒä¼˜ï¼Œå°†æ€§èƒ½æå‡åˆ°äºšæ¯«ç§’çº§åˆ«ã€‚</p>
<h3 id="-å…³é”®äº¤ä»˜ç‰©-2"><a class="header" href="#-å…³é”®äº¤ä»˜ç‰©-2">ğŸ“‹ å…³é”®äº¤ä»˜ç‰©</a></h3>
<h4 id="31-å†…å­˜è®¿é—®ä¼˜åŒ–-3-4å‘¨"><a class="header" href="#31-å†…å­˜è®¿é—®ä¼˜åŒ–-3-4å‘¨">3.1 å†…å­˜è®¿é—®ä¼˜åŒ– (3-4å‘¨)</a></h4>
<p><strong>ä»»åŠ¡åˆ—è¡¨</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"/>
CPUç¼“å­˜è¡Œå¯¹é½ä¼˜åŒ–</li>
<li><input disabled="" type="checkbox"/>
NUMAæ„ŸçŸ¥æ•°æ®åˆ†å¸ƒ</li>
<li><input disabled="" type="checkbox"/>
å†…å­˜é¢„å–ç­–ç•¥</li>
<li><input disabled="" type="checkbox"/>
é›¶æ‹·è´æ•°æ®è®¿é—®</li>
</ul>
<p><strong>æ€§èƒ½ç›®æ ‡</strong>:</p>
<ul>
<li>å†…å­˜è®¿é—®å»¶è¿Ÿ &lt; 100ns</li>
<li>CPUç¼“å­˜å‘½ä¸­ç‡ &gt; 95%</li>
<li>NUMAæœ¬åœ°è®¿é—®ç‡ &gt; 98%</li>
</ul>
<h4 id="32-ioè·¯å¾„ä¼˜åŒ–-4-5å‘¨"><a class="header" href="#32-ioè·¯å¾„ä¼˜åŒ–-4-5å‘¨">3.2 I/Oè·¯å¾„ä¼˜åŒ– (4-5å‘¨)</a></h4>
<p><strong>ä»»åŠ¡åˆ—è¡¨</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"/>
å¼‚æ­¥I/Oå’Œå›è°ƒæœºåˆ¶</li>
<li><input disabled="" type="checkbox"/>
æ‰¹é‡I/Oæ“ä½œ</li>
<li><input disabled="" type="checkbox"/>
ç”¨æˆ·æ€I/O (SPDKé›†æˆ)</li>
<li><input disabled="" type="checkbox"/>
I/Oé˜Ÿåˆ—ä¼˜åŒ–</li>
</ul>
<p><strong>æ€§èƒ½ç›®æ ‡</strong>:</p>
<ul>
<li>I/Oå»¶è¿Ÿ &lt; 25Î¼s</li>
<li>I/Oååé‡ &gt; 100K IOPS</li>
<li>CPUä½¿ç”¨ç‡ &lt; 70%</li>
</ul>
<h4 id="33-å¹¶å‘æ§åˆ¶ä¼˜åŒ–-3-4å‘¨"><a class="header" href="#33-å¹¶å‘æ§åˆ¶ä¼˜åŒ–-3-4å‘¨">3.3 å¹¶å‘æ§åˆ¶ä¼˜åŒ– (3-4å‘¨)</a></h4>
<p><strong>ä»»åŠ¡åˆ—è¡¨</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"/>
æ— é”æ•°æ®ç»“æ„</li>
<li><input disabled="" type="checkbox"/>
ç»†ç²’åº¦é”ç­–ç•¥</li>
<li><input disabled="" type="checkbox"/>
ä¹è§‚å¹¶å‘æ§åˆ¶</li>
<li><input disabled="" type="checkbox"/>
è¯»å†™åˆ†ç¦»ä¼˜åŒ–</li>
</ul>
<p><strong>æ€§èƒ½ç›®æ ‡</strong>:</p>
<ul>
<li>å¹¶å‘æ“ä½œå»¶è¿Ÿ &lt; 500Î¼s</li>
<li>é”ç«äº‰ç‡ &lt; 1%</li>
<li>å¹¶å‘ååé‡ &gt; 80K QPS</li>
</ul>
<h4 id="34-æŸ¥è¯¢å¼•æ“ä¼˜åŒ–-4-5å‘¨"><a class="header" href="#34-æŸ¥è¯¢å¼•æ“ä¼˜åŒ–-4-5å‘¨">3.4 æŸ¥è¯¢å¼•æ“ä¼˜åŒ– (4-5å‘¨)</a></h4>
<p><strong>ä»»åŠ¡åˆ—è¡¨</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"/>
æŸ¥è¯¢è®¡åˆ’ç¼“å­˜</li>
<li><input disabled="" type="checkbox"/>
å¹¶è¡ŒæŸ¥è¯¢æ‰§è¡Œ</li>
<li><input disabled="" type="checkbox"/>
å‘é‡åŒ–æŸ¥è¯¢å¤„ç†</li>
<li><input disabled="" type="checkbox"/>
ç»Ÿè®¡ä¿¡æ¯æ”¶é›†</li>
</ul>
<p><strong>æ€§èƒ½ç›®æ ‡</strong>:</p>
<ul>
<li>ç®€å•æŸ¥è¯¢å»¶è¿Ÿ &lt; 200Î¼s</li>
<li>å¤æ‚æŸ¥è¯¢å»¶è¿Ÿ &lt; 2ms</li>
<li>æŸ¥è¯¢ååé‡ &gt; 100K QPS</li>
</ul>
<h3 id="-é˜¶æ®µ3æµ‹è¯•éªŒè¯"><a class="header" href="#-é˜¶æ®µ3æµ‹è¯•éªŒè¯">ğŸ§ª é˜¶æ®µ3æµ‹è¯•éªŒè¯</a></h3>
<ul>
<li><strong>æ€§èƒ½åŸºå‡†</strong>: è¾¾åˆ°è®¾è®¡ç›®æ ‡çš„90%</li>
<li><strong>å‹åŠ›æµ‹è¯•</strong>: æŒç»­é«˜è´Ÿè½½æµ‹è¯•</li>
<li><strong>å»¶è¿Ÿæµ‹è¯•</strong>: P99å»¶è¿Ÿ &lt; 2ms</li>
<li><strong>ååæµ‹è¯•</strong>: å³°å€¼ååé‡æµ‹è¯•</li>
</ul>
<h2 id="ç¬¬å››é˜¶æ®µç”Ÿäº§çº§ä¼˜åŒ–-10-12ä¸ªæœˆ"><a class="header" href="#ç¬¬å››é˜¶æ®µç”Ÿäº§çº§ä¼˜åŒ–-10-12ä¸ªæœˆ">ç¬¬å››é˜¶æ®µï¼šç”Ÿäº§çº§ä¼˜åŒ– (10-12ä¸ªæœˆ)</a></h2>
<h3 id="-æ ¸å¿ƒç›®æ ‡-3"><a class="header" href="#-æ ¸å¿ƒç›®æ ‡-3">ğŸ¯ æ ¸å¿ƒç›®æ ‡</a></h3>
<p>è¾¾åˆ°ç”Ÿäº§çº§è´¨é‡æ ‡å‡†ï¼Œå®ç°æœ€ç»ˆçš„æ€§èƒ½ç›®æ ‡ï¼Œå®Œå–„è¿ç»´å’Œç›‘æ§ä½“ç³»ã€‚</p>
<h3 id="-å…³é”®äº¤ä»˜ç‰©-3"><a class="header" href="#-å…³é”®äº¤ä»˜ç‰©-3">ğŸ“‹ å…³é”®äº¤ä»˜ç‰©</a></h3>
<h4 id="41-æè‡´æ€§èƒ½ä¼˜åŒ–-4-5å‘¨"><a class="header" href="#41-æè‡´æ€§èƒ½ä¼˜åŒ–-4-5å‘¨">4.1 æè‡´æ€§èƒ½ä¼˜åŒ– (4-5å‘¨)</a></h4>
<p><strong>ä»»åŠ¡åˆ—è¡¨</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"/>
SIMDæŒ‡ä»¤ä¼˜åŒ–</li>
<li><input disabled="" type="checkbox"/>
åˆ†æ”¯é¢„æµ‹ä¼˜åŒ–</li>
<li><input disabled="" type="checkbox"/>
çƒ­ç‚¹ä»£ç ä¼˜åŒ–</li>
<li><input disabled="" type="checkbox"/>
ç¼–è¯‘å™¨ä¼˜åŒ–æ ‡å¿—</li>
</ul>
<p><strong>æ€§èƒ½ç›®æ ‡</strong>:</p>
<ul>
<li>P99å»¶è¿Ÿ &lt; 1ms</li>
<li>å¹³å‡å»¶è¿Ÿ &lt; 200Î¼s</li>
<li>å³°å€¼ååé‡ &gt; 200K QPS</li>
</ul>
<h4 id="42-é«˜å¯ç”¨æ€§è®¾è®¡-5-6å‘¨"><a class="header" href="#42-é«˜å¯ç”¨æ€§è®¾è®¡-5-6å‘¨">4.2 é«˜å¯ç”¨æ€§è®¾è®¡ (5-6å‘¨)</a></h4>
<p><strong>ä»»åŠ¡åˆ—è¡¨</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"/>
ä¸»å¤‡å¤åˆ¶æœºåˆ¶</li>
<li><input disabled="" type="checkbox"/>
è‡ªåŠ¨æ•…éšœè½¬ç§»</li>
<li><input disabled="" type="checkbox"/>
æ•°æ®åˆ†ç‰‡ç­–ç•¥</li>
<li><input disabled="" type="checkbox"/>
è·¨æ•°æ®ä¸­å¿ƒå¤åˆ¶</li>
</ul>
<p><strong>å¯ç”¨æ€§ç›®æ ‡</strong>:</p>
<ul>
<li>ç³»ç»Ÿå¯ç”¨æ€§ &gt; 99.99%</li>
<li>æ•…éšœæ¢å¤æ—¶é—´ &lt; 30ç§’</li>
<li>æ•°æ®ä¸¢å¤±ç‡ &lt; 0.001%</li>
</ul>
<h4 id="43-è¿ç»´ç›‘æ§ä½“ç³»-3-4å‘¨"><a class="header" href="#43-è¿ç»´ç›‘æ§ä½“ç³»-3-4å‘¨">4.3 è¿ç»´ç›‘æ§ä½“ç³» (3-4å‘¨)</a></h4>
<p><strong>ä»»åŠ¡åˆ—è¡¨</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"/>
å®Œæ•´çš„æŒ‡æ ‡ä½“ç³»</li>
<li><input disabled="" type="checkbox"/>
åˆ†å¸ƒå¼è¿½è¸ª</li>
<li><input disabled="" type="checkbox"/>
æ™ºèƒ½å‘Šè­¦ç³»ç»Ÿ</li>
<li><input disabled="" type="checkbox"/>
æ€§èƒ½åˆ†æå·¥å…·</li>
</ul>
<p><strong>ç›‘æ§ç›®æ ‡</strong>:</p>
<ul>
<li>æŒ‡æ ‡è¦†ç›–ç‡ 100%</li>
<li>å‘Šè­¦å“åº”æ—¶é—´ &lt; 1åˆ†é’Ÿ</li>
<li>é—®é¢˜å®šä½æ—¶é—´ &lt; 5åˆ†é’Ÿ</li>
</ul>
<h4 id="44-å®‰å…¨å’Œåˆè§„-3-4å‘¨"><a class="header" href="#44-å®‰å…¨å’Œåˆè§„-3-4å‘¨">4.4 å®‰å…¨å’Œåˆè§„ (3-4å‘¨)</a></h4>
<p><strong>ä»»åŠ¡åˆ—è¡¨</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"/>
æ•°æ®åŠ å¯† (é™æ€å’Œä¼ è¾“)</li>
<li><input disabled="" type="checkbox"/>
è®¿é—®æ§åˆ¶å’Œå®¡è®¡</li>
<li><input disabled="" type="checkbox"/>
åˆè§„æ€§æ£€æŸ¥</li>
<li><input disabled="" type="checkbox"/>
å®‰å…¨æ¼æ´æ‰«æ</li>
</ul>
<p><strong>å®‰å…¨ç›®æ ‡</strong>:</p>
<ul>
<li>å®‰å…¨æ¼æ´ = 0</li>
<li>å®¡è®¡æ—¥å¿—å®Œæ•´ç‡ 100%</li>
<li>æ•°æ®åŠ å¯†è¦†ç›–ç‡ 100%</li>
</ul>
<h3 id="-é˜¶æ®µ4æµ‹è¯•éªŒè¯"><a class="header" href="#-é˜¶æ®µ4æµ‹è¯•éªŒè¯">ğŸ§ª é˜¶æ®µ4æµ‹è¯•éªŒè¯</a></h3>
<ul>
<li><strong>ç”Ÿäº§æ¨¡æ‹Ÿæµ‹è¯•</strong>: çœŸå®è´Ÿè½½æ¨¡æ‹Ÿ</li>
<li><strong>æ··æ²Œå·¥ç¨‹</strong>: æ•…éšœæ³¨å…¥æµ‹è¯•</li>
<li><strong>å®‰å…¨æµ‹è¯•</strong>: æ¸—é€æµ‹è¯•</li>
<li><strong>åˆè§„æµ‹è¯•</strong>: æ³•è§„åˆè§„æ€§éªŒè¯</li>
</ul>
<h2 id="å…³é”®é‡Œç¨‹ç¢‘å’Œæ£€æŸ¥ç‚¹"><a class="header" href="#å…³é”®é‡Œç¨‹ç¢‘å’Œæ£€æŸ¥ç‚¹">å…³é”®é‡Œç¨‹ç¢‘å’Œæ£€æŸ¥ç‚¹</a></h2>
<h3 id="-é‡è¦é‡Œç¨‹ç¢‘"><a class="header" href="#-é‡è¦é‡Œç¨‹ç¢‘">ğŸ é‡è¦é‡Œç¨‹ç¢‘</a></h3>
<div class="table-wrapper"><table><thead><tr><th>é‡Œç¨‹ç¢‘</th><th>æ—¶é—´èŠ‚ç‚¹</th><th>å…³é”®æŒ‡æ ‡</th><th>éªŒæ”¶æ ‡å‡†</th></tr></thead><tbody>
<tr><td>Alphaç‰ˆæœ¬</td><td>3ä¸ªæœˆ</td><td>åŸºç¡€åŠŸèƒ½</td><td>æ”¯æŒCRUDæ“ä½œï¼Œå»¶è¿Ÿ&lt;20ms</td></tr>
<tr><td>Betaç‰ˆæœ¬</td><td>6ä¸ªæœˆ</td><td>å®Œæ•´åŠŸèƒ½</td><td>æ”¯æŒäº‹åŠ¡ï¼Œå»¶è¿Ÿ&lt;5ms</td></tr>
<tr><td>RCç‰ˆæœ¬</td><td>9ä¸ªæœˆ</td><td>æ€§èƒ½ä¼˜åŒ–</td><td>å»¶è¿Ÿ&lt;2msï¼Œå¯ç”¨æ€§99.9%</td></tr>
<tr><td>GAç‰ˆæœ¬</td><td>12ä¸ªæœˆ</td><td>ç”Ÿäº§å°±ç»ª</td><td>å»¶è¿Ÿ&lt;1msï¼Œå¯ç”¨æ€§99.99%</td></tr>
</tbody></table>
</div>
<h3 id="-é£é™©ç¼“è§£ç­–ç•¥"><a class="header" href="#-é£é™©ç¼“è§£ç­–ç•¥">ğŸ”„ é£é™©ç¼“è§£ç­–ç•¥</a></h3>
<h4 id="æŠ€æœ¯é£é™©"><a class="header" href="#æŠ€æœ¯é£é™©">æŠ€æœ¯é£é™©</a></h4>
<ul>
<li><strong>æ€§èƒ½ç›®æ ‡</strong>: å»ºç«‹æ€§èƒ½åŸºå‡†æµ‹è¯•ï¼ŒæŒç»­ç›‘æ§</li>
<li><strong>å¤æ‚æ€§</strong>: æ¨¡å—åŒ–è®¾è®¡ï¼Œé€æ­¥é›†æˆ</li>
<li><strong>å…¼å®¹æ€§</strong>: å……åˆ†çš„å…¼å®¹æ€§æµ‹è¯•</li>
</ul>
<h4 id="é¡¹ç›®é£é™©"><a class="header" href="#é¡¹ç›®é£é™©">é¡¹ç›®é£é™©</a></h4>
<ul>
<li><strong>æ—¶é—´å»¶æœŸ</strong>: 20%ç¼“å†²æ—¶é—´ï¼Œå…³é”®è·¯å¾„ç®¡ç†</li>
<li><strong>èµ„æºä¸è¶³</strong>: æå‰èµ„æºè§„åˆ’ï¼Œå¤‡ç”¨æ–¹æ¡ˆ</li>
<li><strong>éœ€æ±‚å˜æ›´</strong>: ç‰ˆæœ¬æ§åˆ¶ï¼Œå˜æ›´å½±å“è¯„ä¼°</li>
</ul>
<h4 id="äººå‘˜é£é™©"><a class="header" href="#äººå‘˜é£é™©">äººå‘˜é£é™©</a></h4>
<ul>
<li><strong>çŸ¥è¯†ä¼ æ‰¿</strong>: å®Œæ•´æ–‡æ¡£ï¼ŒçŸ¥è¯†åˆ†äº«ä¼šè®®</li>
<li><strong>æŠ€èƒ½å·®è·</strong>: åŸ¹è®­è®¡åˆ’ï¼Œå¤–éƒ¨ä¸“å®¶æ”¯æŒ</li>
<li><strong>äººå‘˜æµå¤±</strong>: æ ¸å¿ƒçŸ¥è¯†å¤‡ä»½ï¼Œå›¢é˜Ÿå»ºè®¾</li>
</ul>
<h2 id="æˆåŠŸæ ‡å‡†å®šä¹‰"><a class="header" href="#æˆåŠŸæ ‡å‡†å®šä¹‰">æˆåŠŸæ ‡å‡†å®šä¹‰</a></h2>
<h3 id="-é‡åŒ–æŒ‡æ ‡"><a class="header" href="#-é‡åŒ–æŒ‡æ ‡">ğŸ“Š é‡åŒ–æŒ‡æ ‡</a></h3>
<h4 id="æ€§èƒ½æŒ‡æ ‡"><a class="header" href="#æ€§èƒ½æŒ‡æ ‡">æ€§èƒ½æŒ‡æ ‡</a></h4>
<ul>
<li><strong>å»¶è¿Ÿ</strong>: P99 &lt; 1ms, P50 &lt; 200Î¼s</li>
<li><strong>ååé‡</strong>: è¯» &gt; 1M QPS, å†™ &gt; 100K QPS</li>
<li><strong>å¯ç”¨æ€§</strong>: &gt; 99.99% uptime</li>
<li><strong>èµ„æºåˆ©ç”¨</strong>: CPU &lt; 80%, å†…å­˜ &lt; 90%</li>
</ul>
<h4 id="è´¨é‡æŒ‡æ ‡"><a class="header" href="#è´¨é‡æŒ‡æ ‡">è´¨é‡æŒ‡æ ‡</a></h4>
<ul>
<li><strong>ä»£ç è¦†ç›–ç‡</strong>: &gt; 85%</li>
<li><strong>å®‰å…¨æ¼æ´</strong>: 0ä¸ªé«˜å±ï¼Œ&lt; 5ä¸ªä¸­å±</li>
<li><strong>æ€§èƒ½å›å½’</strong>: &lt; 5%</li>
<li><strong>æ–‡æ¡£å®Œæ•´æ€§</strong>: 100%</li>
</ul>
<h4 id="è¿ç»´æŒ‡æ ‡"><a class="header" href="#è¿ç»´æŒ‡æ ‡">è¿ç»´æŒ‡æ ‡</a></h4>
<ul>
<li><strong>éƒ¨ç½²æ—¶é—´</strong>: &lt; 10åˆ†é’Ÿ</li>
<li><strong>å›æ»šæ—¶é—´</strong>: &lt; 5åˆ†é’Ÿ</li>
<li><strong>æ•…éšœæ¢å¤</strong>: &lt; 1åˆ†é’Ÿæ£€æµ‹ï¼Œ&lt; 5åˆ†é’Ÿä¿®å¤</li>
<li><strong>ç›‘æ§è¦†ç›–</strong>: 100%å…³é”®æŒ‡æ ‡</li>
</ul>
<h2 id="èµ„æºéœ€æ±‚è¯„ä¼°"><a class="header" href="#èµ„æºéœ€æ±‚è¯„ä¼°">èµ„æºéœ€æ±‚è¯„ä¼°</a></h2>
<h3 id="-äººåŠ›èµ„æº"><a class="header" href="#-äººåŠ›èµ„æº">ğŸ‘¥ äººåŠ›èµ„æº</a></h3>
<ul>
<li><strong>æ¶æ„å¸ˆ</strong>: 1äººï¼Œå…¨ç¨‹å‚ä¸</li>
<li><strong>é«˜çº§å·¥ç¨‹å¸ˆ</strong>: 3-4äººï¼Œæ ¸å¿ƒå¼€å‘</li>
<li><strong>ä¸­çº§å·¥ç¨‹å¸ˆ</strong>: 2-3äººï¼ŒåŠŸèƒ½å¼€å‘</li>
<li><strong>æµ‹è¯•å·¥ç¨‹å¸ˆ</strong>: 2äººï¼Œè´¨é‡ä¿éšœ</li>
<li><strong>è¿ç»´å·¥ç¨‹å¸ˆ</strong>: 1äººï¼Œéƒ¨ç½²è¿ç»´</li>
</ul>
<h3 id="ç¡¬ä»¶èµ„æº"><a class="header" href="#ç¡¬ä»¶èµ„æº">ğŸ–¥ï¸ç¡¬ä»¶èµ„æº</a></h3>
<ul>
<li><strong>å¼€å‘ç¯å¢ƒ</strong>: é«˜æ€§èƒ½å·¥ä½œç«™ Ã— 6å°</li>
<li><strong>æµ‹è¯•ç¯å¢ƒ</strong>: å¤šèŠ‚ç‚¹é›†ç¾¤ Ã— 1å¥—</li>
<li><strong>ç”Ÿäº§ç¯å¢ƒ</strong>: é«˜é…æœåŠ¡å™¨ Ã— 3-5å°</li>
<li><strong>å­˜å‚¨</strong>: ä¼ä¸šçº§NVMe SSD</li>
</ul>
<h3 id="-é¢„ç®—ä¼°ç®—"><a class="header" href="#-é¢„ç®—ä¼°ç®—">ğŸ’° é¢„ç®—ä¼°ç®—</a></h3>
<ul>
<li><strong>äººåŠ›æˆæœ¬</strong>: çº¦500-800ä¸‡/å¹´</li>
<li><strong>ç¡¬ä»¶æˆæœ¬</strong>: çº¦100-200ä¸‡</li>
<li><strong>è½¯ä»¶è®¸å¯</strong>: çº¦50-100ä¸‡</li>
<li><strong>å…¶ä»–è´¹ç”¨</strong>: çº¦50ä¸‡</li>
<li><strong>æ€»é¢„ç®—</strong>: çº¦700-1200ä¸‡</li>
</ul>
<p>è¿™ä¸ªå®æ–½è·¯çº¿å›¾æä¾›äº†æ¸…æ™°çš„åˆ†é˜¶æ®µå¼€å‘è®¡åˆ’ï¼Œç¡®ä¿FileStoreèƒ½å¤ŸæŒ‰æ—¶äº¤ä»˜å¹¶è¾¾åˆ°è®¾è®¡ç›®æ ‡ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="åˆ†å¸ƒå¼filestoreé›†ç¾¤æ¶æ„"><a class="header" href="#åˆ†å¸ƒå¼filestoreé›†ç¾¤æ¶æ„">åˆ†å¸ƒå¼FileStoreé›†ç¾¤æ¶æ„</a></h1>
<h2 id="æ¦‚è¿°"><a class="header" href="#æ¦‚è¿°">æ¦‚è¿°</a></h2>
<p>å½“å•æœºæ€§èƒ½è¾¾åˆ°æé™æˆ–éœ€è¦é«˜å¯ç”¨æ€§æ—¶ï¼ŒFileStoreéœ€è¦æ¼”è¿›ä¸ºåˆ†å¸ƒå¼é›†ç¾¤æ¶æ„ã€‚æœ¬æ–‡æ¡£è¯¦ç»†æè¿°åˆ†å¸ƒå¼FileStoreçš„è®¾è®¡è€ƒè™‘ã€æ¶æ„æ–¹æ¡ˆå’Œå®æ–½ç­–ç•¥ã€‚</p>
<h2 id="åˆ†å¸ƒå¼æ¼”è¿›ç­–ç•¥"><a class="header" href="#åˆ†å¸ƒå¼æ¼”è¿›ç­–ç•¥">åˆ†å¸ƒå¼æ¼”è¿›ç­–ç•¥</a></h2>
<h3 id="æ¸è¿›å¼åˆ†å¸ƒå¼è·¯å¾„"><a class="header" href="#æ¸è¿›å¼åˆ†å¸ƒå¼è·¯å¾„">æ¸è¿›å¼åˆ†å¸ƒå¼è·¯å¾„</a></h3>
<pre><code>é˜¶æ®µ1: å•æœºä¼˜åŒ–
  å•èŠ‚ç‚¹FileStore â†’ æè‡´æ€§èƒ½ä¼˜åŒ– â†’ å‚ç›´æ‰©å±•æé™

é˜¶æ®µ2: ä¸»å¤‡å¤åˆ¶  
  ä¸»èŠ‚ç‚¹ + å¤‡èŠ‚ç‚¹ â†’ é«˜å¯ç”¨æ€§ â†’ è¯»å†™åˆ†ç¦»

é˜¶æ®µ3: å¤šèŠ‚ç‚¹åˆ†ç‰‡
  æ•°æ®åˆ†ç‰‡ â†’ æ°´å¹³æ‰©å±• â†’ åˆ†å¸ƒå¼ä¸€è‡´æ€§

é˜¶æ®µ4: å¤šåœ°å¤šä¸­å¿ƒ
  è·¨åœ°åŸŸéƒ¨ç½² â†’ ç¾éš¾æ¢å¤ â†’ å…¨çƒåŒ–æœåŠ¡
</code></pre>
<h2 id="åˆ†å¸ƒå¼æ¶æ„è®¾è®¡"><a class="header" href="#åˆ†å¸ƒå¼æ¶æ„è®¾è®¡">åˆ†å¸ƒå¼æ¶æ„è®¾è®¡</a></h2>
<h3 id="é›†ç¾¤æ‹“æ‰‘ç»“æ„"><a class="header" href="#é›†ç¾¤æ‹“æ‰‘ç»“æ„">é›†ç¾¤æ‹“æ‰‘ç»“æ„</a></h3>
<h4 id="ä¸‰å±‚åˆ†å¸ƒå¼æ¶æ„"><a class="header" href="#ä¸‰å±‚åˆ†å¸ƒå¼æ¶æ„">ä¸‰å±‚åˆ†å¸ƒå¼æ¶æ„</a></h4>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å®¢æˆ·ç«¯å±‚ Client Layer                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ äº¤æ˜“å®¢æˆ·ç«¯1  â”‚  â”‚ äº¤æ˜“å®¢æˆ·ç«¯2  â”‚  â”‚ äº¤æ˜“å®¢æˆ·ç«¯N  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åè°ƒå±‚ Coordination Layer                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ è´Ÿè½½å‡è¡¡å™¨       â”‚  â”‚ æœåŠ¡å‘ç°        â”‚                   â”‚
â”‚  â”‚ Latency-Aware   â”‚  â”‚ Consul/etcd     â”‚                   â”‚
â”‚  â”‚ Load Balancer   â”‚  â”‚ Service Registry â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                FileStoreé›†ç¾¤å±‚ Cluster Layer                â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   åˆ†ç‰‡1 Shard 1    â”‚  â”‚   åˆ†ç‰‡2 Shard 2    â”‚               â”‚
â”‚  â”‚   (æ´»è·ƒè®¢å•)       â”‚  â”‚   (ç”¨æˆ·æ•°æ®)       â”‚               â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚               â”‚
â”‚  â”‚ â”‚ ä¸»èŠ‚ç‚¹ Primaryâ”‚ â”‚  â”‚ â”‚ ä¸»èŠ‚ç‚¹ Primaryâ”‚ â”‚               â”‚
â”‚  â”‚ â”‚   (è¯»å†™)      â”‚ â”‚  â”‚ â”‚   (è¯»å†™)      â”‚ â”‚               â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚               â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚               â”‚
â”‚  â”‚ â”‚ å‰¯æœ¬1 Replica â”‚ â”‚  â”‚ â”‚ å‰¯æœ¬1 Replica â”‚ â”‚               â”‚
â”‚  â”‚ â”‚   (åªè¯»)      â”‚ â”‚  â”‚ â”‚   (åªè¯»)      â”‚ â”‚               â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚               â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚               â”‚
â”‚  â”‚ â”‚ å‰¯æœ¬2 Replica â”‚ â”‚  â”‚ â”‚ å‰¯æœ¬2 Replica â”‚ â”‚               â”‚
â”‚  â”‚ â”‚   (åªè¯»)      â”‚ â”‚  â”‚ â”‚   (åªè¯»)      â”‚ â”‚               â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   åˆ†ç‰‡3 Shard 3    â”‚  â”‚   åˆ†ç‰‡N Shard N    â”‚               â”‚
â”‚  â”‚   (å†å²æ•°æ®)       â”‚  â”‚   (æ‰©å±•æ•°æ®)       â”‚               â”‚
â”‚  â”‚     ......        â”‚  â”‚     ......        â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 id="æ ¸å¿ƒåˆ†å¸ƒå¼ç»„ä»¶"><a class="header" href="#æ ¸å¿ƒåˆ†å¸ƒå¼ç»„ä»¶">æ ¸å¿ƒåˆ†å¸ƒå¼ç»„ä»¶</a></h3>
<h4 id="1-åˆ†å¸ƒå¼åè°ƒå™¨-distributed-coordinator"><a class="header" href="#1-åˆ†å¸ƒå¼åè°ƒå™¨-distributed-coordinator">1. åˆ†å¸ƒå¼åè°ƒå™¨ (Distributed Coordinator)</a></h4>
<p><strong>èŒè´£</strong>:</p>
<ul>
<li>é›†ç¾¤æˆå‘˜ç®¡ç†å’Œå¥åº·ç›‘æ§</li>
<li>Leaderé€‰ä¸¾å’Œæ•…éšœè½¬ç§»</li>
<li>å…¨å±€é…ç½®ç®¡ç†å’Œåˆ†å‘</li>
<li>åˆ†ç‰‡åˆ†é…å’Œé‡å¹³è¡¡</li>
</ul>
<p><strong>æŠ€æœ¯å®ç°</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct DistributedCoordinator {
    // å…±è¯†ç®—æ³•å®ç°
    raft_consensus: RaftConsensus,
    
    // é›†ç¾¤çŠ¶æ€ç®¡ç†
    cluster_state: Arc&lt;RwLock&lt;ClusterState&gt;&gt;,
    
    // èŠ‚ç‚¹å¥åº·ç›‘æ§
    health_monitor: HealthMonitor,
    
    // åˆ†ç‰‡ç®¡ç†å™¨
    shard_manager: ShardManager,
}

struct ClusterState {
    // æ´»è·ƒèŠ‚ç‚¹åˆ—è¡¨
    active_nodes: HashMap&lt;NodeId, NodeInfo&gt;,
    
    // åˆ†ç‰‡åˆ†é…è¡¨
    shard_allocation: HashMap&lt;ShardId, ShardInfo&gt;,
    
    // å…¨å±€é…ç½®
    global_config: GlobalConfig,
}
<span class="boring">}</span></code></pre></pre>
<h4 id="2-æ™ºèƒ½è´Ÿè½½å‡è¡¡å™¨-smart-load-balancer"><a class="header" href="#2-æ™ºèƒ½è´Ÿè½½å‡è¡¡å™¨-smart-load-balancer">2. æ™ºèƒ½è´Ÿè½½å‡è¡¡å™¨ (Smart Load Balancer)</a></h4>
<p><strong>è®¾è®¡åŸåˆ™</strong>:</p>
<ul>
<li><strong>å»¶è¿Ÿæ„ŸçŸ¥</strong>: æ ¹æ®èŠ‚ç‚¹å“åº”æ—¶é—´æ™ºèƒ½è·¯ç”±</li>
<li><strong>è´Ÿè½½æ„ŸçŸ¥</strong>: é¿å…çƒ­ç‚¹èŠ‚ç‚¹è¿‡è½½</li>
<li><strong>ä¸€è‡´æ€§å“ˆå¸Œ</strong>: å‡å°‘åˆ†ç‰‡è¿ç§»å½±å“</li>
<li><strong>ä¼šè¯äº²å’Œ</strong>: ç›¸å…³è¯·æ±‚è·¯ç”±åˆ°åŒä¸€èŠ‚ç‚¹</li>
</ul>
<p><strong>è·¯ç”±ç­–ç•¥</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum RoutingStrategy {
    // å»¶è¿Ÿæœ€ä¼˜è·¯ç”±
    LatencyOptimal {
        latency_threshold: Duration,
        fallback_nodes: Vec&lt;NodeId&gt;,
    },
    
    // è´Ÿè½½å‡è¡¡è·¯ç”±
    LoadBalanced {
        weight_function: Box&lt;dyn Fn(&amp;NodeLoad) -&gt; f64&gt;,
        max_load_threshold: f64,
    },
    
    // ä¸€è‡´æ€§å“ˆå¸Œè·¯ç”±
    ConsistentHash {
        hash_ring: ConsistentHashRing,
        replication_factor: u8,
    },
    
    // æ··åˆç­–ç•¥
    Hybrid {
        primary: Box&lt;RoutingStrategy&gt;,
        fallback: Box&lt;RoutingStrategy&gt;,
        switch_condition: Box&lt;dyn Fn(&amp;ClusterState) -&gt; bool&gt;,
    },
}
<span class="boring">}</span></code></pre></pre>
<h4 id="3-åˆ†ç‰‡ç®¡ç†å™¨-shard-manager"><a class="header" href="#3-åˆ†ç‰‡ç®¡ç†å™¨-shard-manager">3. åˆ†ç‰‡ç®¡ç†å™¨ (Shard Manager)</a></h4>
<p><strong>åˆ†ç‰‡ç­–ç•¥è®¾è®¡</strong>:</p>
<p><strong>æŒ‰æ•°æ®çƒ­åº¦åˆ†ç‰‡</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum ShardStrategy {
    DataTemperature {
        // çƒ­æ•°æ®åˆ†ç‰‡ - é«˜æ€§èƒ½èŠ‚ç‚¹
        hot_shard: ShardConfig {
            node_type: NodeType::HighPerformance,
            replication_factor: 3,
            consistency: ConsistencyLevel::Strong,
        },
        
        // æ¸©æ•°æ®åˆ†ç‰‡ - æ ‡å‡†èŠ‚ç‚¹  
        warm_shard: ShardConfig {
            node_type: NodeType::Standard,
            replication_factor: 2,
            consistency: ConsistencyLevel::Eventual,
        },
        
        // å†·æ•°æ®åˆ†ç‰‡ - å¤§å®¹é‡èŠ‚ç‚¹
        cold_shard: ShardConfig {
            node_type: NodeType::HighCapacity,
            replication_factor: 1,
            consistency: ConsistencyLevel::Eventual,
        },
    },
}
<span class="boring">}</span></code></pre></pre>
<p><strong>æŒ‰ä¸šåŠ¡ç»´åº¦åˆ†ç‰‡</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum BusinessSharding {
    // æŒ‰ç”¨æˆ·ç»„åˆ†ç‰‡
    UserGroup {
        vip_users: ShardId,      // VIPç”¨æˆ·ä¸“ç”¨åˆ†ç‰‡
        regular_users: ShardId,  // æ™®é€šç”¨æˆ·å…±äº«åˆ†ç‰‡
        inactive_users: ShardId, // éæ´»è·ƒç”¨æˆ·å½’æ¡£åˆ†ç‰‡
    },
    
    // æŒ‰æ•°æ®ç±»å‹åˆ†ç‰‡
    DataType {
        orders_shard: ShardId,   // è®¢å•æ•°æ®åˆ†ç‰‡
        users_shard: ShardId,    // ç”¨æˆ·æ•°æ®åˆ†ç‰‡
        history_shard: ShardId,  // å†å²æ•°æ®åˆ†ç‰‡
    },
    
    // æŒ‰åœ°ç†ä½ç½®åˆ†ç‰‡
    Geographic {
        region_shards: HashMap&lt;Region, ShardId&gt;,
        cross_region_replication: bool,
    },
}
<span class="boring">}</span></code></pre></pre>
<h2 id="ä¸€è‡´æ€§å’Œå¯ç”¨æ€§è®¾è®¡"><a class="header" href="#ä¸€è‡´æ€§å’Œå¯ç”¨æ€§è®¾è®¡">ä¸€è‡´æ€§å’Œå¯ç”¨æ€§è®¾è®¡</a></h2>
<h3 id="capå®šç†æƒè¡¡"><a class="header" href="#capå®šç†æƒè¡¡">CAPå®šç†æƒè¡¡</a></h3>
<p><strong>åˆ†å±‚ä¸€è‡´æ€§æ¨¡å‹</strong>:</p>
<pre><code>å¼ºä¸€è‡´æ€§å±‚ (CPç³»ç»Ÿ):
â”œâ”€â”€ è®¢å•æ ¸å¿ƒæ•°æ® (è®¢å•çŠ¶æ€ã€è´¦æˆ·ä½™é¢)
â”œâ”€â”€ ä½¿ç”¨Raftå…±è¯†ç®—æ³•
â”œâ”€â”€ åŒæ­¥å¤åˆ¶åˆ°å¤šæ•°èŠ‚ç‚¹
â””â”€â”€ çº¿æ€§åŒ–è¯»å†™ä¿è¯

æœ€ç»ˆä¸€è‡´æ€§å±‚ (APç³»ç»Ÿ):
â”œâ”€â”€ ç”¨æˆ·é…ç½®æ•°æ® (ä¸ªäººè®¾ç½®ã€åå¥½)
â”œâ”€â”€ å¼‚æ­¥å¤åˆ¶ä¼˜åŒ–æ€§èƒ½  
â”œâ”€â”€ å†²çªæ£€æµ‹å’Œè§£å†³
â””â”€â”€ è¯»å†™åˆ†ç¦»æ¶æ„

æ··åˆä¸€è‡´æ€§å±‚:
â”œâ”€â”€ å†™å…¥æ—¶å¼ºä¸€è‡´æ€§
â”œâ”€â”€ è¯»å–æ—¶æœ€ç»ˆä¸€è‡´æ€§
â”œâ”€â”€ å¯é…ç½®çš„ä¸€è‡´æ€§çº§åˆ«
â””â”€â”€ ä¸šåŠ¡è¯­ä¹‰é©±åŠ¨çš„é€‰æ‹©
</code></pre>
<h3 id="åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†"><a class="header" href="#åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†">åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†</a></h3>
<h4 id="ä¸¤é˜¶æ®µæäº¤ä¼˜åŒ–-enhanced-2pc"><a class="header" href="#ä¸¤é˜¶æ®µæäº¤ä¼˜åŒ–-enhanced-2pc">ä¸¤é˜¶æ®µæäº¤ä¼˜åŒ– (Enhanced 2PC)</a></h4>
<p><strong>ä¼ ç»Ÿ2PCé—®é¢˜</strong>:</p>
<ul>
<li>é˜»å¡é—®é¢˜ï¼šåè°ƒè€…æ•…éšœå¯¼è‡´å‚ä¸è€…é˜»å¡</li>
<li>æ€§èƒ½é—®é¢˜ï¼šå¤šè½®ç½‘ç»œé€šä¿¡å¼€é”€å¤§</li>
<li>å¯ç”¨æ€§é—®é¢˜ï¼šä»»ä¸€èŠ‚ç‚¹æ•…éšœå½±å“å…¨å±€äº‹åŠ¡</li>
</ul>
<p><strong>ä¼˜åŒ–ç­–ç•¥</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Enhanced2PC {
    // åè°ƒè€…æ± ï¼Œé¿å…å•ç‚¹æ•…éšœ
    coordinator_pool: Vec&lt;CoordinatorNode&gt;,
    
    // å¼‚æ­¥å¹¶è¡Œæäº¤
    parallel_commit: bool,
    
    // äº‹åŠ¡è¶…æ—¶å’Œå¿«é€Ÿå¤±è´¥
    transaction_timeout: Duration,
    
    // é¢„å†™æ—¥å¿—ä¼˜åŒ–
    optimistic_logging: bool,
}

impl Enhanced2PC {
    async fn commit_transaction(&amp;self, txn: Transaction) -&gt; Result&lt;CommitResult&gt; {
        // ç¬¬0é˜¶æ®µï¼šäº‹åŠ¡é¢„æ£€æŸ¥å’Œä¼˜åŒ–
        self.precheck_transaction(&amp;txn).await?;
        
        // ç¬¬1é˜¶æ®µï¼šå¹¶è¡Œå‡†å¤‡é˜¶æ®µ
        let prepare_futures: Vec&lt;_&gt; = txn.participants
            .iter()
            .map(|participant| self.prepare_participant(participant))
            .collect();
        
        let prepare_results = join_all(prepare_futures).await;
        
        // å¿«é€Ÿå†³ç­–ï¼šä»»ä¸€å¤±è´¥åˆ™ç«‹å³ä¸­æ­¢
        if prepare_results.iter().any(|r| r.is_err()) {
            self.parallel_abort(&amp;txn).await;
            return Err(TransactionAborted);
        }
        
        // ç¬¬2é˜¶æ®µï¼šå¹¶è¡Œæäº¤é˜¶æ®µ
        let commit_futures: Vec&lt;_&gt; = txn.participants
            .iter()
            .map(|participant| self.commit_participant(participant))
            .collect();
            
        let commit_results = join_all(commit_futures).await;
        Ok(CommitResult::from(commit_results))
    }
}
<span class="boring">}</span></code></pre></pre>
<h4 id="sagaæ¨¡å¼æ”¯æŒ"><a class="header" href="#sagaæ¨¡å¼æ”¯æŒ">Sagaæ¨¡å¼æ”¯æŒ</a></h4>
<p><strong>é•¿äº‹åŠ¡å¤„ç†</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct SagaTransaction {
    // äº‹åŠ¡æ­¥éª¤é“¾
    steps: Vec&lt;SagaStep&gt;,
    
    // è¡¥å¿æ“ä½œ
    compensations: Vec&lt;CompensationStep&gt;,
    
    // æ‰§è¡Œç­–ç•¥
    execution_strategy: SagaStrategy,
}

enum SagaStrategy {
    // å‰å‘æ¢å¤ï¼šé‡è¯•å¤±è´¥æ­¥éª¤
    ForwardRecovery {
        max_retries: u32,
        retry_backoff: Duration,
    },
    
    // åå‘æ¢å¤ï¼šæ‰§è¡Œè¡¥å¿æ“ä½œ  
    BackwardRecovery {
        compensation_timeout: Duration,
    },
    
    // æ··åˆç­–ç•¥
    Hybrid {
        retry_count_threshold: u32,
        switch_to_compensation: bool,
    },
}
<span class="boring">}</span></code></pre></pre>
<h3 id="åˆ†å¸ƒå¼é”æœºåˆ¶"><a class="header" href="#åˆ†å¸ƒå¼é”æœºåˆ¶">åˆ†å¸ƒå¼é”æœºåˆ¶</a></h3>
<h4 id="åŸºäºraftçš„åˆ†å¸ƒå¼é”"><a class="header" href="#åŸºäºraftçš„åˆ†å¸ƒå¼é”">åŸºäºRaftçš„åˆ†å¸ƒå¼é”</a></h4>
<p><strong>è®¾è®¡ç‰¹ç‚¹</strong>:</p>
<ul>
<li><strong>å¼ºä¸€è‡´æ€§</strong>: åŸºäºRaftå…±è¯†ç®—æ³•</li>
<li><strong>é«˜å¯ç”¨æ€§</strong>: å®¹å¿å°‘æ•°èŠ‚ç‚¹æ•…éšœ</li>
<li><strong>æ­»é”æ£€æµ‹</strong>: å…¨å±€æ­»é”æ£€æµ‹å’Œè§£å†³</li>
<li><strong>é”ç§Ÿçº¦</strong>: é˜²æ­¢æ­»é”å’Œåƒµå°¸é”</li>
</ul>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct DistributedLockManager {
    // Raftå…±è¯†é›†ç¾¤
    raft_cluster: RaftCluster,
    
    // é”çŠ¶æ€å­˜å‚¨
    lock_store: Arc&lt;RwLock&lt;HashMap&lt;LockId, LockInfo&gt;&gt;&gt;,
    
    // æ­»é”æ£€æµ‹å™¨
    deadlock_detector: DeadlockDetector,
    
    // é”ç§Ÿçº¦ç®¡ç†
    lease_manager: LeaseManager,
}

struct LockInfo {
    lock_id: LockId,
    owner: NodeId,
    acquired_at: Timestamp,
    expires_at: Timestamp,
    lock_type: LockType, // è¯»é”/å†™é”
    waiters: Vec&lt;WaiterInfo&gt;,
}

impl DistributedLockManager {
    async fn acquire_lock(&amp;self, request: LockRequest) -&gt; Result&lt;LockHandle&gt; {
        // 1. æäº¤é”è¯·æ±‚åˆ°Rafté›†ç¾¤
        let proposal = LockProposal {
            lock_id: request.lock_id,
            requester: request.node_id,
            lock_type: request.lock_type,
            timeout: request.timeout,
        };
        
        // 2. ç­‰å¾…Raftå…±è¯†
        let consensus_result = self.raft_cluster
            .propose(proposal)
            .await?;
            
        // 3. æ£€æŸ¥æ­»é”
        if self.deadlock_detector.would_cause_deadlock(&amp;request) {
            return Err(DeadlockDetected);
        }
        
        // 4. æˆåŠŸè·å–é”
        Ok(LockHandle::new(request.lock_id, consensus_result.term))
    }
}
<span class="boring">}</span></code></pre></pre>
<h2 id="åˆ†å¸ƒå¼å­˜å‚¨æ¶æ„"><a class="header" href="#åˆ†å¸ƒå¼å­˜å‚¨æ¶æ„">åˆ†å¸ƒå¼å­˜å‚¨æ¶æ„</a></h2>
<h3 id="æ•°æ®åˆ†ç‰‡å’Œå¤åˆ¶"><a class="header" href="#æ•°æ®åˆ†ç‰‡å’Œå¤åˆ¶">æ•°æ®åˆ†ç‰‡å’Œå¤åˆ¶</a></h3>
<h4 id="ä¸€è‡´æ€§å“ˆå¸Œåˆ†ç‰‡"><a class="header" href="#ä¸€è‡´æ€§å“ˆå¸Œåˆ†ç‰‡">ä¸€è‡´æ€§å“ˆå¸Œåˆ†ç‰‡</a></h4>
<p><strong>è®¾è®¡ä¼˜åŠ¿</strong>:</p>
<ul>
<li><strong>è´Ÿè½½å‡è¡¡</strong>: æ•°æ®å‡åŒ€åˆ†å¸ƒåˆ°å„èŠ‚ç‚¹</li>
<li><strong>å¼¹æ€§æ‰©å®¹</strong>: æ·»åŠ /åˆ é™¤èŠ‚ç‚¹æ—¶æœ€å°åŒ–æ•°æ®è¿ç§»</li>
<li><strong>å®¹é”™æ€§</strong>: å•èŠ‚ç‚¹æ•…éšœä¸å½±å“å…¨å±€æœåŠ¡</li>
<li><strong>å±€éƒ¨æ€§</strong>: ç›¸å…³æ•°æ®å€¾å‘äºåˆ†å¸ƒåˆ°ç›¸è¿‘èŠ‚ç‚¹</li>
</ul>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct ConsistentHashRing {
    // è™šæ‹ŸèŠ‚ç‚¹ç¯
    virtual_nodes: BTreeMap&lt;u64, VirtualNode&gt;,
    
    // ç‰©ç†èŠ‚ç‚¹æ˜ å°„
    physical_nodes: HashMap&lt;NodeId, PhysicalNode&gt;,
    
    // å¤åˆ¶å› å­
    replication_factor: u8,
    
    // å“ˆå¸Œå‡½æ•°
    hash_function: Box&lt;dyn HashFunction&gt;,
}

struct VirtualNode {
    hash: u64,
    physical_node: NodeId,
    node_weight: f64,
}

impl ConsistentHashRing {
    fn get_nodes_for_key(&amp;self, key: &amp;[u8]) -&gt; Vec&lt;NodeId&gt; {
        let key_hash = self.hash_function.hash(key);
        let mut result = Vec::new();
        
        // åœ¨ç¯ä¸Šé¡ºæ—¶é’ˆæŸ¥æ‰¾èŠ‚ç‚¹
        let mut current_hash = key_hash;
        let mut seen_physical_nodes = HashSet::new();
        
        while result.len() &lt; self.replication_factor as usize {
            if let Some((_, virtual_node)) = self.virtual_nodes
                .range(current_hash..)
                .next()
                .or_else(|| self.virtual_nodes.iter().next()) {
                
                if !seen_physical_nodes.contains(&amp;virtual_node.physical_node) {
                    result.push(virtual_node.physical_node);
                    seen_physical_nodes.insert(virtual_node.physical_node);
                }
                
                current_hash = virtual_node.hash + 1;
            } else {
                break;
            }
        }
        
        result
    }
    
    // èŠ‚ç‚¹æ·»åŠ æ—¶çš„æ•°æ®è¿ç§»è®¡åˆ’
    fn plan_migration_for_new_node(&amp;self, new_node: NodeId) -&gt; MigrationPlan {
        let mut migration_plan = MigrationPlan::new();
        
        // è®¡ç®—æ–°èŠ‚ç‚¹çš„è™šæ‹ŸèŠ‚ç‚¹ä½ç½®
        let virtual_nodes = self.generate_virtual_nodes(new_node);
        
        for virtual_node in virtual_nodes {
            // æ‰¾åˆ°éœ€è¦è¿ç§»çš„æ•°æ®èŒƒå›´
            let predecessor = self.find_predecessor(virtual_node.hash);
            let migration_range = HashRange {
                start: predecessor.hash,
                end: virtual_node.hash,
            };
            
            migration_plan.add_migration(
                predecessor.physical_node,
                new_node,
                migration_range,
            );
        }
        
        migration_plan
    }
}
<span class="boring">}</span></code></pre></pre>
<h4 id="å¤šçº§å¤åˆ¶ç­–ç•¥"><a class="header" href="#å¤šçº§å¤åˆ¶ç­–ç•¥">å¤šçº§å¤åˆ¶ç­–ç•¥</a></h4>
<p><strong>å¤åˆ¶å±‚æ¬¡</strong>:</p>
<pre><code>åŒæ­¥å¤åˆ¶å±‚ (å¼ºä¸€è‡´æ€§):
â”œâ”€â”€ åŒæœºæˆ¿å†…2-3ä¸ªå‰¯æœ¬
â”œâ”€â”€ åŒæ­¥å†™å…¥æ‰€æœ‰å‰¯æœ¬
â”œâ”€â”€ å¤šæ•°æ´¾ç¡®è®¤åè¿”å›
â””â”€â”€ é€‚ç”¨äºå…³é”®ä¸šåŠ¡æ•°æ®

å¼‚æ­¥å¤åˆ¶å±‚ (æœ€ç»ˆä¸€è‡´æ€§):
â”œâ”€â”€ è·¨æœºæˆ¿/åœ°åŸŸå‰¯æœ¬
â”œâ”€â”€ å¼‚æ­¥æ‰¹é‡å¤åˆ¶
â”œâ”€â”€ å†²çªæ£€æµ‹å’Œè§£å†³
â””â”€â”€ é€‚ç”¨äºå¤‡ä»½å’Œç¾éš¾æ¢å¤

åˆ†å±‚å¤åˆ¶ç­–ç•¥:
â”œâ”€â”€ çƒ­æ•°æ®ï¼š3å‰¯æœ¬åŒæ­¥ + 1å‰¯æœ¬å¼‚æ­¥
â”œâ”€â”€ æ¸©æ•°æ®ï¼š2å‰¯æœ¬åŒæ­¥ + 1å‰¯æœ¬å¼‚æ­¥  
â”œâ”€â”€ å†·æ•°æ®ï¼š1å‰¯æœ¬æœ¬åœ° + 1å‰¯æœ¬è¿œç¨‹
â””â”€â”€ åŠ¨æ€è°ƒæ•´å¤åˆ¶ç­–ç•¥
</code></pre>
<h3 id="åˆ†å¸ƒå¼æŸ¥è¯¢å¤„ç†"><a class="header" href="#åˆ†å¸ƒå¼æŸ¥è¯¢å¤„ç†">åˆ†å¸ƒå¼æŸ¥è¯¢å¤„ç†</a></h3>
<h4 id="æŸ¥è¯¢è·¯ç”±å’Œä¼˜åŒ–"><a class="header" href="#æŸ¥è¯¢è·¯ç”±å’Œä¼˜åŒ–">æŸ¥è¯¢è·¯ç”±å’Œä¼˜åŒ–</a></h4>
<p><strong>æ™ºèƒ½æŸ¥è¯¢è·¯ç”±</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct DistributedQueryExecutor {
    // æŸ¥è¯¢ä¼˜åŒ–å™¨
    query_optimizer: QueryOptimizer,
    
    // åˆ†ç‰‡è·¯ç”±å™¨
    shard_router: ShardRouter,
    
    // ç»“æœèšåˆå™¨
    result_aggregator: ResultAggregator,
    
    // æŸ¥è¯¢ç¼“å­˜
    query_cache: Arc&lt;QueryCache&gt;,
}

impl DistributedQueryExecutor {
    async fn execute_query(&amp;self, query: Query) -&gt; Result&lt;QueryResult&gt; {
        // 1. æŸ¥è¯¢ä¼˜åŒ–å’Œè®¡åˆ’ç”Ÿæˆ
        let execution_plan = self.query_optimizer.optimize(query)?;
        
        // 2. ç¡®å®šæ¶‰åŠçš„åˆ†ç‰‡
        let target_shards = self.shard_router
            .resolve_shards(&amp;execution_plan)?;
        
        // 3. æ£€æŸ¥æŸ¥è¯¢ç¼“å­˜
        if let Some(cached_result) = self.query_cache.get(&amp;execution_plan.cache_key()) {
            return Ok(cached_result);
        }
        
        // 4. å¹¶è¡Œæ‰§è¡Œå­æŸ¥è¯¢
        let shard_queries: Vec&lt;_&gt; = target_shards
            .into_iter()
            .map(|shard| self.execute_shard_query(shard, &amp;execution_plan))
            .collect();
            
        let shard_results = join_all(shard_queries).await;
        
        // 5. ç»“æœèšåˆå’Œåå¤„ç†
        let final_result = self.result_aggregator
            .aggregate(shard_results, &amp;execution_plan)?;
            
        // 6. ç¼“å­˜æŸ¥è¯¢ç»“æœ
        self.query_cache.put(execution_plan.cache_key(), &amp;final_result);
        
        Ok(final_result)
    }
    
    async fn execute_shard_query(&amp;self, shard: ShardInfo, plan: &amp;ExecutionPlan) -&gt; Result&lt;ShardResult&gt; {
        // é€‰æ‹©æœ€ä¼˜èŠ‚ç‚¹æ‰§è¡ŒæŸ¥è¯¢
        let optimal_node = self.select_optimal_node(&amp;shard).await?;
        
        // æ‰§è¡Œåˆ†ç‰‡æŸ¥è¯¢
        let shard_query = plan.extract_shard_query(&amp;shard);
        optimal_node.execute_query(shard_query).await
    }
    
    async fn select_optimal_node(&amp;self, shard: &amp;ShardInfo) -&gt; Result&lt;NodeId&gt; {
        let candidates = shard.replica_nodes();
        
        // ç»¼åˆè€ƒè™‘å»¶è¿Ÿã€è´Ÿè½½ã€å¥åº·çŠ¶æ€
        let mut best_node = None;
        let mut best_score = f64::MIN;
        
        for node in candidates {
            let node_metrics = self.get_node_metrics(node).await?;
            let score = self.calculate_node_score(&amp;node_metrics);
            
            if score &gt; best_score {
                best_score = score;
                best_node = Some(node);
            }
        }
        
        best_node.ok_or(NoAvailableNode)
    }
    
    fn calculate_node_score(&amp;self, metrics: &amp;NodeMetrics) -&gt; f64 {
        // ç»¼åˆè¯„åˆ†ç®—æ³•
        let latency_score = 1.0 / (metrics.avg_latency.as_millis() as f64 + 1.0);
        let load_score = 1.0 - metrics.cpu_usage;
        let health_score = if metrics.is_healthy { 1.0 } else { 0.0 };
        
        // åŠ æƒå¹³å‡
        latency_score * 0.4 + load_score * 0.4 + health_score * 0.2
    }
}
<span class="boring">}</span></code></pre></pre>
<h2 id="å®¹é”™å’Œæ¢å¤æœºåˆ¶"><a class="header" href="#å®¹é”™å’Œæ¢å¤æœºåˆ¶">å®¹é”™å’Œæ¢å¤æœºåˆ¶</a></h2>
<h3 id="æ•…éšœæ£€æµ‹ä½“ç³»"><a class="header" href="#æ•…éšœæ£€æµ‹ä½“ç³»">æ•…éšœæ£€æµ‹ä½“ç³»</a></h3>
<p><strong>å¤šå±‚æ¬¡å¥åº·ç›‘æ§</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct ClusterHealthMonitor {
    // èŠ‚ç‚¹çº§å¥åº·æ£€æŸ¥
    node_monitors: HashMap&lt;NodeId, NodeHealthMonitor&gt;,
    
    // æœåŠ¡çº§å¥åº·æ£€æŸ¥  
    service_monitors: HashMap&lt;ServiceId, ServiceHealthMonitor&gt;,
    
    // ç½‘ç»œåˆ†åŒºæ£€æµ‹
    partition_detector: PartitionDetector,
    
    // å¼‚å¸¸æ£€æµ‹å™¨
    anomaly_detector: AnomalyDetector,
}

struct NodeHealthMonitor {
    // å¿ƒè·³æ£€æµ‹
    heartbeat_checker: HeartbeatChecker,
    
    // æ€§èƒ½æŒ‡æ ‡ç›‘æ§
    metrics_monitor: MetricsMonitor,
    
    // ä¸šåŠ¡åŠŸèƒ½æ¢æµ‹
    business_probe: BusinessProbe,
}

impl ClusterHealthMonitor {
    async fn monitor_cluster_health(&amp;self) -&gt; ClusterHealthReport {
        let mut health_report = ClusterHealthReport::new();
        
        // å¹¶è¡Œæ£€æŸ¥æ‰€æœ‰èŠ‚ç‚¹å¥åº·çŠ¶æ€
        let node_health_futures: Vec&lt;_&gt; = self.node_monitors
            .iter()
            .map(|(node_id, monitor)| async move {
                let health = monitor.check_health().await;
                (*node_id, health)
            })
            .collect();
            
        let node_health_results = join_all(node_health_futures).await;
        
        for (node_id, health) in node_health_results {
            health_report.add_node_health(node_id, health);
            
            // æ£€æµ‹èŠ‚ç‚¹å¼‚å¸¸æ¨¡å¼
            if let Some(anomaly) = self.anomaly_detector.detect(node_id, &amp;health) {
                health_report.add_anomaly(anomaly);
            }
        }
        
        // æ£€æµ‹ç½‘ç»œåˆ†åŒº
        if let Some(partition) = self.partition_detector.detect_partition().await {
            health_report.add_partition(partition);
        }
        
        health_report
    }
}
<span class="boring">}</span></code></pre></pre>
<h3 id="è‡ªåŠ¨æ•…éšœæ¢å¤"><a class="header" href="#è‡ªåŠ¨æ•…éšœæ¢å¤">è‡ªåŠ¨æ•…éšœæ¢å¤</a></h3>
<p><strong>æ•…éšœæ¢å¤ç­–ç•¥</strong>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum RecoveryStrategy {
    // èŠ‚ç‚¹é‡å¯æ¢å¤
    NodeRestart {
        max_restart_attempts: u32,
        restart_backoff: Duration,
    },
    
    // æœåŠ¡è¿ç§»æ¢å¤  
    ServiceMigration {
        target_node_selection: NodeSelectionStrategy,
        migration_timeout: Duration,
    },
    
    // åˆ†ç‰‡é‡æ–°åˆ†é…
    ShardReallocation {
        reallocation_policy: ReallocationPolicy,
        data_migration_strategy: MigrationStrategy,
    },
    
    // é™çº§æœåŠ¡
    ServiceDegradation {
        degraded_service_level: ServiceLevel,
        auto_recovery_condition: RecoveryCondition,
    },
}

struct AutoRecoveryManager {
    recovery_strategies: HashMap&lt;FailureType, RecoveryStrategy&gt;,
    recovery_executor: RecoveryExecutor,
    recovery_history: RecoveryHistory,
}

impl AutoRecoveryManager {
    async fn handle_failure(&amp;self, failure: ClusterFailure) -&gt; RecoveryResult {
        // 1. ç¡®å®šæ•…éšœç±»å‹å’Œå½±å“èŒƒå›´
        let failure_analysis = self.analyze_failure(&amp;failure);
        
        // 2. é€‰æ‹©æ¢å¤ç­–ç•¥
        let strategy = self.select_recovery_strategy(&amp;failure_analysis);
        
        // 3. æ‰§è¡Œæ¢å¤æ“ä½œ
        let recovery_result = self.recovery_executor
            .execute_recovery(&amp;strategy, &amp;failure)
            .await?;
            
        // 4. è®°å½•æ¢å¤å†å²
        self.recovery_history.record(RecoveryRecord {
            failure,
            strategy: strategy.clone(),
            result: recovery_result.clone(),
            timestamp: SystemTime::now(),
        });
        
        // 5. å­¦ä¹ å’Œä¼˜åŒ–
        self.learn_from_recovery(&amp;recovery_result);
        
        Ok(recovery_result)
    }
    
    fn learn_from_recovery(&amp;mut self, result: &amp;RecoveryResult) {
        // åŸºäºæ¢å¤æ•ˆæœè°ƒæ•´ç­–ç•¥
        if result.is_successful() &amp;&amp; result.recovery_time &lt; Duration::from_secs(30) {
            // æˆåŠŸçš„å¿«é€Ÿæ¢å¤ï¼Œå¢åŠ è¯¥ç­–ç•¥çš„ä¼˜å…ˆçº§
            self.increase_strategy_priority(&amp;result.strategy);
        } else if result.recovery_time &gt; Duration::from_minutes(5) {
            // æ¢å¤æ—¶é—´è¿‡é•¿ï¼Œé™ä½ç­–ç•¥ä¼˜å…ˆçº§
            self.decrease_strategy_priority(&amp;result.strategy);
        }
    }
}
<span class="boring">}</span></code></pre></pre>
<h3 id="ç¾éš¾æ¢å¤è®¾è®¡"><a class="header" href="#ç¾éš¾æ¢å¤è®¾è®¡">ç¾éš¾æ¢å¤è®¾è®¡</a></h3>
<p><strong>å¤šå±‚ç¾å¤‡æ¶æ„</strong>:</p>
<pre><code>æœ¬åœ°å®¹ç¾ (RTO &lt; 30ç§’, RPO &lt; 1ç§’):
â”œâ”€â”€ åŒæœºæˆ¿å¤šèŠ‚ç‚¹éƒ¨ç½²
â”œâ”€â”€ å®æ—¶æ•°æ®åŒæ­¥
â”œâ”€â”€ è‡ªåŠ¨æ•…éšœè½¬ç§»
â””â”€â”€ çƒ­å¤‡ä»½èŠ‚ç‚¹

å¼‚åœ°å®¹ç¾ (RTO &lt; 5åˆ†é’Ÿ, RPO &lt; 10ç§’):
â”œâ”€â”€ è·¨æ•°æ®ä¸­å¿ƒéƒ¨ç½²
â”œâ”€â”€ å¼‚æ­¥æ•°æ®å¤åˆ¶
â”œâ”€â”€ æ‰‹åŠ¨/è‡ªåŠ¨åˆ‡æ¢
â””â”€â”€ æ¸©å¤‡ä»½é›†ç¾¤

æç«¯ç¾éš¾ (RTO &lt; 30åˆ†é’Ÿ, RPO &lt; 1åˆ†é’Ÿ):
â”œâ”€â”€ å¤šåœ°åŸŸéƒ¨ç½²
â”œâ”€â”€ å®šæœŸå…¨é‡å¤‡ä»½
â”œâ”€â”€ ç¾éš¾æ¢å¤æ¼”ç»ƒ
â””â”€â”€ å†·å¤‡ä»½å­˜å‚¨
</code></pre>
<h2 id="æ€§èƒ½ä¼˜åŒ–ç­–ç•¥"><a class="header" href="#æ€§èƒ½ä¼˜åŒ–ç­–ç•¥">æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</a></h2>
<h3 id="åˆ†å¸ƒå¼æ€§èƒ½è°ƒä¼˜"><a class="header" href="#åˆ†å¸ƒå¼æ€§èƒ½è°ƒä¼˜">åˆ†å¸ƒå¼æ€§èƒ½è°ƒä¼˜</a></h3>
<h4 id="ç½‘ç»œä¼˜åŒ–"><a class="header" href="#ç½‘ç»œä¼˜åŒ–">ç½‘ç»œä¼˜åŒ–</a></h4>
<ul>
<li><strong>æ‰¹é‡æ“ä½œ</strong>: å‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•°</li>
<li><strong>æ•°æ®å‹ç¼©</strong>: å‡å°‘ç½‘ç»œä¼ è¾“é‡</li>
<li><strong>è¿æ¥æ± </strong>: å¤ç”¨ç½‘ç»œè¿æ¥</li>
<li><strong>å¼‚æ­¥I/O</strong>: æé«˜ç½‘ç»œå¹¶å‘æ€§</li>
</ul>
<h4 id="ç¼“å­˜ç­–ç•¥"><a class="header" href="#ç¼“å­˜ç­–ç•¥">ç¼“å­˜ç­–ç•¥</a></h4>
<ul>
<li><strong>å¤šçº§ç¼“å­˜</strong>: L1(èŠ‚ç‚¹æœ¬åœ°) â†’ L2(é›†ç¾¤å…±äº«) â†’ L3(æŒä¹…åŒ–)</li>
<li><strong>æ™ºèƒ½é¢„å–</strong>: é¢„æµ‹çƒ­æ•°æ®å¹¶é¢„åŠ è½½</li>
<li><strong>ç¼“å­˜ä¸€è‡´æ€§</strong>: åˆ†å¸ƒå¼ç¼“å­˜çš„æ•°æ®ä¸€è‡´æ€§ä¿è¯</li>
<li><strong>ç¼“å­˜åˆ†åŒº</strong>: é¿å…ç¼“å­˜çƒ­ç‚¹å’Œäº‰ç”¨</li>
</ul>
<h4 id="è´Ÿè½½å‡è¡¡ä¼˜åŒ–"><a class="header" href="#è´Ÿè½½å‡è¡¡ä¼˜åŒ–">è´Ÿè½½å‡è¡¡ä¼˜åŒ–</a></h4>
<ul>
<li><strong>å»¶è¿Ÿæ„ŸçŸ¥</strong>: è·¯ç”±åˆ°æœ€ä½å»¶è¿ŸèŠ‚ç‚¹</li>
<li><strong>è´Ÿè½½æ„ŸçŸ¥</strong>: é¿å…çƒ­ç‚¹èŠ‚ç‚¹è¿‡è½½</li>
<li><strong>ä¼šè¯ç²˜æ€§</strong>: ç›¸å…³è¯·æ±‚è·¯ç”±åˆ°åŒä¸€èŠ‚ç‚¹</li>
<li><strong>å¥åº·æ„ŸçŸ¥</strong>: é¿å…æ•…éšœæˆ–ä¸å¥åº·èŠ‚ç‚¹</li>
</ul>
<h3 id="å¯è§‚æµ‹æ€§å’Œç›‘æ§"><a class="header" href="#å¯è§‚æµ‹æ€§å’Œç›‘æ§">å¯è§‚æµ‹æ€§å’Œç›‘æ§</a></h3>
<h4 id="åˆ†å¸ƒå¼è¿½è¸ª"><a class="header" href="#åˆ†å¸ƒå¼è¿½è¸ª">åˆ†å¸ƒå¼è¿½è¸ª</a></h4>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct DistributedTracing {
    // è¿½è¸ªä¸Šä¸‹æ–‡ä¼ æ’­
    trace_propagator: TracePropagator,
    
    // è·¨åº¦æ”¶é›†å™¨
    span_collector: SpanCollector,
    
    // è¿½è¸ªåˆ†æå™¨
    trace_analyzer: TraceAnalyzer,
}

// è¯·æ±‚è¿½è¸ªç¤ºä¾‹
impl DistributedQueryExecutor {
    async fn execute_query_with_tracing(&amp;self, query: Query) -&gt; Result&lt;QueryResult&gt; {
        // åˆ›å»ºæ ¹è¿½è¸ªè·¨åº¦
        let root_span = self.tracer.start_span("distributed_query");
        let trace_context = root_span.context();
        
        // æŸ¥è¯¢ä¼˜åŒ–è·¨åº¦
        let optimization_span = self.tracer.start_span_with_context(
            "query_optimization", 
            &amp;trace_context
        );
        let execution_plan = self.query_optimizer.optimize(query)?;
        optimization_span.end();
        
        // åˆ†ç‰‡æŸ¥è¯¢è·¨åº¦
        let shard_queries: Vec&lt;_&gt; = target_shards
            .into_iter()
            .map(|shard| {
                let shard_span = self.tracer.start_span_with_context(
                    &amp;format!("shard_query_{}", shard.id),
                    &amp;trace_context
                );
                self.execute_shard_query_traced(shard, &amp;execution_plan, shard_span)
            })
            .collect();
            
        let results = join_all(shard_queries).await;
        
        // ç»“æœèšåˆè·¨åº¦
        let aggregation_span = self.tracer.start_span_with_context(
            "result_aggregation", 
            &amp;trace_context
        );
        let final_result = self.result_aggregator.aggregate(results, &amp;execution_plan)?;
        aggregation_span.end();
        
        root_span.end();
        Ok(final_result)
    }
}
<span class="boring">}</span></code></pre></pre>
<h4 id="æ€§èƒ½æŒ‡æ ‡ä½“ç³»"><a class="header" href="#æ€§èƒ½æŒ‡æ ‡ä½“ç³»">æ€§èƒ½æŒ‡æ ‡ä½“ç³»</a></h4>
<pre><code>ç³»ç»Ÿçº§æŒ‡æ ‡:
â”œâ”€â”€ CPUä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨ç‡
â”œâ”€â”€ ç½‘ç»œå¸¦å®½ã€ç£ç›˜I/O
â”œâ”€â”€ ç³»ç»Ÿè´Ÿè½½ã€è¿›ç¨‹çŠ¶æ€
â””â”€â”€ ç¡¬ä»¶å¥åº·çŠ¶æ€

åº”ç”¨çº§æŒ‡æ ‡:
â”œâ”€â”€ è¯·æ±‚å»¶è¿Ÿåˆ†å¸ƒ (P50/P95/P99)
â”œâ”€â”€ è¯·æ±‚ååé‡ (QPS/TPS)
â”œâ”€â”€ é”™è¯¯ç‡å’ŒæˆåŠŸç‡
â””â”€â”€ ä¸šåŠ¡åŠŸèƒ½å¯ç”¨æ€§

é›†ç¾¤çº§æŒ‡æ ‡:
â”œâ”€â”€ èŠ‚ç‚¹å¥åº·çŠ¶æ€
â”œâ”€â”€ åˆ†ç‰‡è´Ÿè½½å‡è¡¡åº¦
â”œâ”€â”€ æ•°æ®ä¸€è‡´æ€§çŠ¶æ€
â””â”€â”€ æ•…éšœæ¢å¤æ—¶é—´
</code></pre>
<h2 id="æ€»ç»“"><a class="header" href="#æ€»ç»“">æ€»ç»“</a></h2>
<p>åˆ†å¸ƒå¼FileStoreçš„è®¾è®¡éœ€è¦åœ¨æ€§èƒ½ã€ä¸€è‡´æ€§ã€å¯ç”¨æ€§ä¹‹é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹ã€‚é€šè¿‡æ¸è¿›å¼æ¼”è¿›ç­–ç•¥ï¼Œå¯ä»¥ä»å•æœºé«˜æ€§èƒ½ç‰ˆæœ¬é€æ­¥å‘å±•ä¸ºæ”¯æŒå¤§è§„æ¨¡éƒ¨ç½²çš„åˆ†å¸ƒå¼é›†ç¾¤ç³»ç»Ÿã€‚</p>
<p>å…³é”®è®¾è®¡åŸåˆ™ï¼š</p>
<ul>
<li><strong>æ¸è¿›å¼æ¼”è¿›</strong>: é¿å…è¿‡æ—©çš„åˆ†å¸ƒå¼å¤æ‚æ€§</li>
<li><strong>åˆ†å±‚ä¸€è‡´æ€§</strong>: ä¸åŒä¸šåŠ¡æ•°æ®é‡‡ç”¨ä¸åŒçš„ä¸€è‡´æ€§ä¿è¯</li>
<li><strong>æ™ºèƒ½è·¯ç”±</strong>: å»¶è¿Ÿæ„ŸçŸ¥å’Œè´Ÿè½½æ„ŸçŸ¥çš„è¯·æ±‚è·¯ç”±</li>
<li><strong>è‡ªåŠ¨åŒ–è¿ç»´</strong>: æ•…éšœè‡ªåŠ¨æ£€æµ‹ã€æ¢å¤å’Œè‡ªæ„ˆèƒ½åŠ›</li>
<li><strong>å¯è§‚æµ‹æ€§</strong>: å®Œæ•´çš„ç›‘æ§ã€è¿½è¸ªå’Œå‘Šè­¦ä½“ç³»</li>
</ul>
<p>è¿™ä¸ªåˆ†å¸ƒå¼æ¶æ„ä¸ºFileStoreæä¾›äº†å¯æ‰©å±•çš„é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆï¼Œèƒ½å¤Ÿæ»¡è¶³å¤§è§„æ¨¡äº¤æ˜“ç³»ç»Ÿçš„ä¸¥æ ¼è¦æ±‚ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="æ ¸å¿ƒç»„ä»¶è¯¦ç»†è®¾è®¡"><a class="header" href="#æ ¸å¿ƒç»„ä»¶è¯¦ç»†è®¾è®¡">æ ¸å¿ƒç»„ä»¶è¯¦ç»†è®¾è®¡</a></h1>
<h2 id="è®¾è®¡æ€»è§ˆ"><a class="header" href="#è®¾è®¡æ€»è§ˆ">è®¾è®¡æ€»è§ˆ</a></h2>
<p>æœ¬æ–‡æ¡£è¯¦ç»†è®¾è®¡FileStoreå­˜å‚¨å¼•æ“çš„æ ¸å¿ƒç»„ä»¶æ¶æ„ï¼ŒåŸºäºå››å±‚ç²¾ç®€æ¶æ„å’Œ10mså»¶è¿Ÿç›®æ ‡ï¼Œä¸“é—¨é’ˆå¯¹å†…ç½‘ç¯å¢ƒä¼˜åŒ–ã€‚</p>
<h2 id="æ ¸å¿ƒè®¾è®¡ç†å¿µ"><a class="header" href="#æ ¸å¿ƒè®¾è®¡ç†å¿µ">æ ¸å¿ƒè®¾è®¡ç†å¿µ</a></h2>
<h3 id="ç³»ç»Ÿè®¾è®¡åŸåˆ™"><a class="header" href="#ç³»ç»Ÿè®¾è®¡åŸåˆ™">ç³»ç»Ÿè®¾è®¡åŸåˆ™</a></h3>
<ul>
<li><strong>ç®€åŒ–è‡³ä¸Š</strong>: å»é™¤ä¸å¿…è¦çš„æŠ½è±¡å±‚ï¼Œç›´è¾¾æ ¸å¿ƒåŠŸèƒ½</li>
<li><strong>æ€§èƒ½å¯¼å‘</strong>: æ¯ä¸ªç»„ä»¶éƒ½ä»¥å»¶è¿Ÿå’Œååé‡ä¸ºé¦–è¦è€ƒè™‘</li>
<li><strong>å†…ç½‘ä¼˜åŒ–</strong>: å……åˆ†åˆ©ç”¨å†…ç½‘é«˜é€Ÿã€å¯ä¿¡ã€ä½å»¶è¿Ÿç‰¹æ€§</li>
<li><strong>ç¡¬ä»¶æ„ŸçŸ¥</strong>: é’ˆå¯¹ç°ä»£å¤šæ ¸ã€NUMAã€NVMeæ¶æ„ä¼˜åŒ–</li>
</ul>
<h3 id="æ¶æ„è®¾è®¡ç›®æ ‡"><a class="header" href="#æ¶æ„è®¾è®¡ç›®æ ‡">æ¶æ„è®¾è®¡ç›®æ ‡</a></h3>
<ul>
<li><strong>å»¶è¿Ÿæ§åˆ¶</strong>: P99 &lt; 10msï¼Œå¹³å‡å»¶è¿Ÿ &lt; 3ms</li>
<li><strong>ååé‡</strong>: è¯» &gt; 1M QPSï¼Œå†™ &gt; 100K QPS</li>
<li><strong>å¯ç”¨æ€§</strong>: 99.9%+ ç³»ç»Ÿå¯ç”¨æ€§</li>
<li><strong>æ‰©å±•æ€§</strong>: æ”¯æŒå•æœºåˆ°å°å‹é›†ç¾¤çš„å¹³æ»‘æ‰©å±•</li>
</ul>
<h2 id="ç»„ä»¶è®¾è®¡æ€»ä½“æ–¹æ¡ˆ"><a class="header" href="#ç»„ä»¶è®¾è®¡æ€»ä½“æ–¹æ¡ˆ">ç»„ä»¶è®¾è®¡æ€»ä½“æ–¹æ¡ˆ</a></h2>
<h3 id="è®¾è®¡å±‚æ¬¡ç»“æ„"><a class="header" href="#è®¾è®¡å±‚æ¬¡ç»“æ„">è®¾è®¡å±‚æ¬¡ç»“æ„</a></h3>
<pre><code>ç¬¬ä¸€å±‚ï¼šé«˜æ€§èƒ½æ¥å£å±‚ (å»¶è¿Ÿé¢„ç®—: 0.5ms)
â”œâ”€â”€ åè®®å¤„ç†å™¨ï¼šè´Ÿè´£è¯·æ±‚è§£æå’Œå“åº”ç”Ÿæˆ
â”œâ”€â”€ è¿æ¥ç®¡ç†å™¨ï¼šç®¡ç†å®¢æˆ·ç«¯è¿æ¥å’Œä¼šè¯
â””â”€â”€ ç›‘æ§æ”¶é›†å™¨ï¼šè½»é‡çº§æ€§èƒ½æŒ‡æ ‡æ”¶é›†

ç¬¬äºŒå±‚ï¼šå­˜å‚¨å¼•æ“æ ¸å¿ƒ (å»¶è¿Ÿé¢„ç®—: 6ms)
â”œâ”€â”€ è¡¨ç®¡ç†å¼•æ“ï¼šè¡¨çš„ç”Ÿå‘½å‘¨æœŸå’Œè®°å½•ç®¡ç†
â”œâ”€â”€ ç´¢å¼•ç®¡ç†ç³»ç»Ÿï¼šä¸»ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•ç®¡ç†
â”œâ”€â”€ æŸ¥è¯¢æ‰§è¡Œå¼•æ“ï¼šæŸ¥è¯¢ä¼˜åŒ–å’Œæ‰§è¡Œ
â””â”€â”€ å†…å­˜ç®¡ç†å™¨ï¼šNUMAæ„ŸçŸ¥çš„å†…å­˜åˆ†é…

ç¬¬ä¸‰å±‚ï¼šæŒä¹…åŒ–å¼•æ“ (å»¶è¿Ÿé¢„ç®—: 0.5ms)
â”œâ”€â”€ WALå†™å…¥å¼•æ“ï¼šé«˜é€Ÿäº‹åŠ¡æ—¥å¿—å¤„ç†
â”œâ”€â”€ å¼‚æ­¥åˆ·ç›˜ç®¡ç†ï¼šåå°æ•°æ®æŒä¹…åŒ–
â””â”€â”€ æ¢å¤åè°ƒå™¨ï¼šæ•…éšœæ¢å¤å’Œä¸€è‡´æ€§ä¿è¯

ç¬¬å››å±‚ï¼šç¡¬ä»¶æŠ½è±¡å±‚ (å»¶è¿Ÿé¢„ç®—: 0.4ms)
â”œâ”€â”€ å­˜å‚¨æ¥å£ï¼šNVMeç”¨æˆ·æ€è®¿é—®
â”œâ”€â”€ å†…å­˜æ¥å£ï¼šNUMAå’Œå¤§é¡µé¢ç®¡ç†
â””â”€â”€ ç½‘ç»œæ¥å£ï¼šRDMAå’Œé›¶æ‹·è´ä¼˜åŒ–
</code></pre>
<h2 id="ç¬¬ä¸€å±‚é«˜æ€§èƒ½æ¥å£å±‚ç»„ä»¶è®¾è®¡"><a class="header" href="#ç¬¬ä¸€å±‚é«˜æ€§èƒ½æ¥å£å±‚ç»„ä»¶è®¾è®¡">ç¬¬ä¸€å±‚ï¼šé«˜æ€§èƒ½æ¥å£å±‚ç»„ä»¶è®¾è®¡</a></h2>
<h3 id="11-åè®®å¤„ç†å™¨è®¾è®¡-protocol-handler"><a class="header" href="#11-åè®®å¤„ç†å™¨è®¾è®¡-protocol-handler">1.1 åè®®å¤„ç†å™¨è®¾è®¡ (Protocol Handler)</a></h3>
<p><strong>è®¾è®¡ç›®æ ‡</strong>: å»¶è¿Ÿé¢„ç®— 0.5msï¼Œæ”¯æŒ 100K+ QPS</p>
<h4 id="åè®®é€‰æ‹©ç­–ç•¥"><a class="header" href="#åè®®é€‰æ‹©ç­–ç•¥">åè®®é€‰æ‹©ç­–ç•¥</a></h4>
<p><strong>å¤šåè®®æ”¯æŒæ¶æ„</strong>:</p>
<ul>
<li>
<p><strong>gRPCä¼˜åŒ–åè®®</strong>: ä¸»è¦åè®®ï¼Œé’ˆå¯¹æ€§èƒ½ä¼˜åŒ–</p>
<ul>
<li>é¢„ç¼–è¯‘åè®®å®šä¹‰ï¼Œå‡å°‘è¿è¡Œæ—¶å¼€é”€</li>
<li>é›¶æ‹·è´ç¼“å†²åŒºç®¡ç†</li>
<li>æ‰¹é‡è¯·æ±‚æ”¯æŒ</li>
</ul>
</li>
<li>
<p><strong>ç›´æ¥TCPåè®®</strong>: æç®€äºŒè¿›åˆ¶åè®®</p>
<ul>
<li>è‡ªå®šä¹‰äºŒè¿›åˆ¶æ ¼å¼ï¼Œæœ€å°åºåˆ—åŒ–å¼€é”€</li>
<li>å›ºå®šé•¿åº¦å¤´éƒ¨è®¾è®¡</li>
<li>æµæ°´çº¿è¯·æ±‚å¤„ç†</li>
</ul>
</li>
<li>
<p><strong>å…±äº«å†…å­˜IPC</strong>: åŒæœºéƒ¨ç½²ä¼˜åŒ–</p>
<ul>
<li>è¿›ç¨‹é—´é›¶æ‹·è´é€šä¿¡</li>
<li>ç¯å½¢ç¼“å†²åŒºè®¾è®¡</li>
<li>ä¿¡å·é‡åŒæ­¥æœºåˆ¶</li>
</ul>
</li>
</ul>
<h4 id="è¯·æ±‚å¤„ç†æµæ°´çº¿è®¾è®¡"><a class="header" href="#è¯·æ±‚å¤„ç†æµæ°´çº¿è®¾è®¡">è¯·æ±‚å¤„ç†æµæ°´çº¿è®¾è®¡</a></h4>
<p><strong>å››é˜¶æ®µå¤„ç†æ¶æ„</strong>:</p>
<pre><code>è¯·æ±‚å¤„ç†æµæ°´çº¿:
è¾“å…¥è¯·æ±‚ â†’ è§£æé˜¶æ®µ â†’ éªŒè¯é˜¶æ®µ â†’ è·¯ç”±é˜¶æ®µ â†’ å“åº”é˜¶æ®µ
   (åŸå§‹æ•°æ®) â†’ (100Î¼s) â†’ (50Î¼s) â†’ (50Î¼s) â†’ (100Î¼s)
   
é˜¶æ®µ1 - é›¶æ‹·è´è§£æ:
â”œâ”€â”€ ç›´æ¥å†…å­˜è§†å›¾æ„å»º
â”œâ”€â”€ é¿å…æ•°æ®å¤åˆ¶
â””â”€â”€ æŒ‡é’ˆæ“ä½œä¼˜åŒ–

é˜¶æ®µ2 - æœ€å°éªŒè¯:
â”œâ”€â”€ åŸºç¡€æ ¼å¼æ£€æŸ¥
â”œâ”€â”€ æƒé™éªŒè¯ï¼ˆå†…ç½‘ç®€åŒ–ï¼‰
â””â”€â”€ è¯·æ±‚å®Œæ•´æ€§ç¡®è®¤

é˜¶æ®µ3 - æ™ºèƒ½è·¯ç”±:
â”œâ”€â”€ è¡¨åå¿«é€ŸæŸ¥æ‰¾
â”œâ”€â”€ è´Ÿè½½æ„ŸçŸ¥è·¯ç”±
â””â”€â”€ è¿æ¥å¤ç”¨

é˜¶æ®µ4 - é›¶æ‹·è´å“åº”:
â”œâ”€â”€ ç›´æ¥ç»“æœåºåˆ—åŒ–
â”œâ”€â”€ å†…å­˜è§†å›¾è¿”å›
â””â”€â”€ æ‰¹é‡å“åº”ä¼˜åŒ–
</code></pre>
<h4 id="æ€§èƒ½ä¼˜åŒ–ç­–ç•¥-1"><a class="header" href="#æ€§èƒ½ä¼˜åŒ–ç­–ç•¥-1">æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</a></h4>
<p><strong>å†…å­˜ç®¡ç†ä¼˜åŒ–</strong>:</p>
<ul>
<li>é¢„åˆ†é…ç¼“å†²åŒºæ± ï¼Œé¿å…åŠ¨æ€åˆ†é…</li>
<li>é¡µé¢å¯¹é½çš„å†…å­˜å¸ƒå±€</li>
<li>NUMAæ„ŸçŸ¥çš„å†…å­˜åˆ†é…</li>
</ul>
<p><strong>æ‰¹å¤„ç†ä¼˜åŒ–</strong>:</p>
<ul>
<li>è¯·æ±‚æ‰¹é‡è§£æå’Œå¤„ç†</li>
<li>å“åº”æ‰¹é‡åºåˆ—åŒ–</li>
<li>ç½‘ç»œI/Oæ‰¹é‡æäº¤</li>
</ul>
<p><strong>ç¼“å­˜ç­–ç•¥</strong>:</p>
<ul>
<li>åè®®è§£æç»“æœç¼“å­˜</li>
<li>è·¯ç”±ä¿¡æ¯ç¼“å­˜</li>
<li>è¿æ¥çŠ¶æ€ç¼“å­˜</li>
</ul>
<h3 id="12-è¿æ¥ç®¡ç†å™¨è®¾è®¡-connection-manager"><a class="header" href="#12-è¿æ¥ç®¡ç†å™¨è®¾è®¡-connection-manager">1.2 è¿æ¥ç®¡ç†å™¨è®¾è®¡ (Connection Manager)</a></h3>
<h4 id="è¿æ¥æ± æ¶æ„è®¾è®¡"><a class="header" href="#è¿æ¥æ± æ¶æ„è®¾è®¡">è¿æ¥æ± æ¶æ„è®¾è®¡</a></h4>
<p><strong>åˆ†å±‚è¿æ¥ç®¡ç†</strong>:</p>
<pre><code>è¿æ¥ç®¡ç†å±‚æ¬¡:
å®¢æˆ·ç«¯è¿æ¥ â†’ è¿æ¥æ±  â†’ ä¼šè¯ç®¡ç† â†’ ç¼“å†²åŒºç®¡ç†
     â†“           â†“         â†“          â†“
   TCPè¿æ¥    é¢„å»ºç«‹è¿æ¥   æ‰¹é‡ä¼šè¯   é›¶æ‹·è´ç¼“å†²
</code></pre>
<p><strong>æ ¸å¿ƒè®¾è®¡ç‰¹æ€§</strong>:</p>
<ul>
<li><strong>é¢„å»ºç«‹è¿æ¥æ± </strong>: é¿å…è¿æ¥å»ºç«‹å»¶è¿Ÿ</li>
<li><strong>è¿æ¥å¤ç”¨</strong>: æœ€å¤§åŒ–è¿æ¥åˆ©ç”¨ç‡</li>
<li><strong>ä¼šè¯ç®¡ç†</strong>: æ”¯æŒæ‰¹é‡è¯·æ±‚å¤„ç†</li>
<li><strong>è‡ªé€‚åº”è°ƒæ•´</strong>: æ ¹æ®è´Ÿè½½åŠ¨æ€è°ƒæ•´æ± å¤§å°</li>
</ul>
<h4 id="é›¶æ‹·è´ç¼“å†²åŒºç®¡ç†"><a class="header" href="#é›¶æ‹·è´ç¼“å†²åŒºç®¡ç†">é›¶æ‹·è´ç¼“å†²åŒºç®¡ç†</a></h4>
<p><strong>å†…å­˜æ± æ¶æ„</strong>:</p>
<pre><code>ç¼“å†²åŒºç®¡ç†å±‚æ¬¡:
åº”ç”¨ç¼“å†²åŒº â†’ å†…å­˜æ±  â†’ é¡µé¢åˆ†é…å™¨ â†’ ç‰©ç†å†…å­˜
     â†“          â†“         â†“           â†“
   é€»è¾‘è§†å›¾   é¢„åˆ†é…æ±    é¡µé¢å¯¹é½    NUMAæœ¬åœ°
</code></pre>
<p><strong>ä¼˜åŒ–ç­–ç•¥</strong>:</p>
<ul>
<li><strong>é¢„åˆ†é…å†…å­˜æ± </strong>: é¿å…è¿è¡Œæ—¶åˆ†é…å¼€é”€</li>
<li><strong>é¡µé¢å¯¹é½</strong>: ä¼˜åŒ–CPUç¼“å­˜æ€§èƒ½</li>
<li><strong>å¤§é¡µé¢æ”¯æŒ</strong>: å‡å°‘TLBç¼ºå¤±</li>
<li><strong>NUMAæ„ŸçŸ¥</strong>: æœ¬åœ°å†…å­˜è®¿é—®ä¼˜åŒ–</li>
</ul>
<h4 id="æ‰¹é‡å¤„ç†æœºåˆ¶"><a class="header" href="#æ‰¹é‡å¤„ç†æœºåˆ¶">æ‰¹é‡å¤„ç†æœºåˆ¶</a></h4>
<p><strong>æ‰¹é‡æ“ä½œè®¾è®¡</strong>:</p>
<ul>
<li><strong>è¯·æ±‚èšåˆ</strong>: å°†å¤šä¸ªå°è¯·æ±‚åˆå¹¶å¤„ç†</li>
<li><strong>å“åº”æ‰¹é‡</strong>: æ‰¹é‡è¿”å›ç»“æœå‡å°‘ç½‘ç»œå¼€é”€</li>
<li><strong>æµæ°´çº¿å¤„ç†</strong>: é‡å I/Oå’Œè®¡ç®—æ“ä½œ</li>
</ul>
<h3 id="13-ç›‘æ§æ”¶é›†å™¨è®¾è®¡-minimal-metrics"><a class="header" href="#13-ç›‘æ§æ”¶é›†å™¨è®¾è®¡-minimal-metrics">1.3 ç›‘æ§æ”¶é›†å™¨è®¾è®¡ (Minimal Metrics)</a></h3>
<h4 id="è½»é‡çº§ç›‘æ§æ¶æ„"><a class="header" href="#è½»é‡çº§ç›‘æ§æ¶æ„">è½»é‡çº§ç›‘æ§æ¶æ„</a></h4>
<p><strong>æœ€å°å¼€é”€ç›‘æ§åŸåˆ™</strong>:</p>
<ul>
<li>åªç›‘æ§å…³é”®æ€§èƒ½æŒ‡æ ‡</li>
<li>ä½¿ç”¨æ— é”æ•°æ®ç»“æ„</li>
<li>å¼‚æ­¥æ•°æ®æ”¶é›†</li>
<li>é‡‡æ ·ç»Ÿè®¡å‡å°‘å¼€é”€</li>
</ul>
<p><strong>æ ¸å¿ƒç›‘æ§æŒ‡æ ‡</strong>:</p>
<pre><code>æ€§èƒ½æŒ‡æ ‡ä½“ç³»:
â”œâ”€â”€ å»¶è¿Ÿç»Ÿè®¡
â”‚   â”œâ”€â”€ P50å»¶è¿Ÿ (ä¸­ä½æ•°)
â”‚   â”œâ”€â”€ P99å»¶è¿Ÿ (å°¾éƒ¨å»¶è¿Ÿ)
â”‚   â””â”€â”€ å¹³å‡å»¶è¿Ÿ
â”œâ”€â”€ ååé‡ç»Ÿè®¡
â”‚   â”œâ”€â”€ QPS (æ¯ç§’æŸ¥è¯¢æ•°)
â”‚   â”œâ”€â”€ TPS (æ¯ç§’äº‹åŠ¡æ•°)
â”‚   â””â”€â”€ å¸¦å®½åˆ©ç”¨ç‡
â””â”€â”€ é”™è¯¯ç»Ÿè®¡
    â”œâ”€â”€ é”™è¯¯ç‡
    â”œâ”€â”€ è¶…æ—¶ç‡
    â””â”€â”€ è¿æ¥å¤±è´¥ç‡
</code></pre>
<h2 id="ç¬¬äºŒå±‚å­˜å‚¨å¼•æ“æ ¸å¿ƒç»„ä»¶è®¾è®¡"><a class="header" href="#ç¬¬äºŒå±‚å­˜å‚¨å¼•æ“æ ¸å¿ƒç»„ä»¶è®¾è®¡">ç¬¬äºŒå±‚ï¼šå­˜å‚¨å¼•æ“æ ¸å¿ƒç»„ä»¶è®¾è®¡</a></h2>
<h3 id="21-è¡¨ç®¡ç†å¼•æ“è®¾è®¡-table-management-engine"><a class="header" href="#21-è¡¨ç®¡ç†å¼•æ“è®¾è®¡-table-management-engine">2.1 è¡¨ç®¡ç†å¼•æ“è®¾è®¡ (Table Management Engine)</a></h3>
<p><strong>è®¾è®¡ç›®æ ‡</strong>: å»¶è¿Ÿé¢„ç®— 6msï¼Œæ‰¿æ‹…60%è®¡ç®—è´Ÿè½½</p>
<h4 id="è¡¨æ³¨å†Œä¸­å¿ƒæ¶æ„"><a class="header" href="#è¡¨æ³¨å†Œä¸­å¿ƒæ¶æ„">è¡¨æ³¨å†Œä¸­å¿ƒæ¶æ„</a></h4>
<p><strong>å¿«é€Ÿè¡¨æŸ¥æ‰¾è®¾è®¡</strong>:</p>
<pre><code>è¡¨æ³¨å†Œæ¶æ„:
è¡¨åå­—ç¬¦ä¸² â†’ å“ˆå¸Œæ˜ å°„ â†’ è¡¨ID â†’ è¡¨å®ä¾‹æŒ‡é’ˆ
     â†“          â†“        â†“        â†“
   å­—ç¬¦ä¸²é”®   O(1)æŸ¥æ‰¾   æ•°å­—ID   ç›´æ¥è®¿é—®
</code></pre>
<p><strong>è®¾è®¡ç‰¹æ€§</strong>:</p>
<ul>
<li><strong>åŒé‡ç´¢å¼•</strong>: æ”¯æŒæŒ‰åç§°å’ŒIDå¿«é€ŸæŸ¥æ‰¾</li>
<li><strong>ç±»å‹å®‰å…¨</strong>: ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥</li>
<li><strong>çƒ­åŠ è½½</strong>: æ”¯æŒè¿è¡Œæ—¶è¡¨ç»“æ„å˜æ›´</li>
<li><strong>ç»Ÿè®¡é›†æˆ</strong>: å®æ—¶è¡¨çº§æ€§èƒ½ç»Ÿè®¡</li>
</ul>
<h4 id="è®°å½•ç®¡ç†æ¶æ„"><a class="header" href="#è®°å½•ç®¡ç†æ¶æ„">è®°å½•ç®¡ç†æ¶æ„</a></h4>
<p><strong>å›ºå®šå¤§å°æ§½ä½è®¾è®¡</strong>:</p>
<pre><code>è®°å½•å­˜å‚¨å¸ƒå±€:
è¡¨å¤´ä¿¡æ¯ â†’ åˆ†é…ä½å›¾ â†’ è®°å½•æ§½ä½åŒºåŸŸ â†’ ç´¢å¼•åŒºåŸŸ
   â†“         â†“          â†“           â†“
 å…ƒæ•°æ®    æ§½ä½çŠ¶æ€   å›ºå®šå¤§å°æ§½   å¿«é€Ÿç´¢å¼•
</code></pre>
<p><strong>æ ¸å¿ƒç‰¹æ€§</strong>:</p>
<ul>
<li><strong>å›ºå®šæ§½ä½</strong>: æ¶ˆé™¤å†…å­˜ç¢ç‰‡ï¼ŒO(1)åœ°å€è®¡ç®—</li>
<li><strong>ä½å›¾åˆ†é…</strong>: å¿«é€Ÿæ§½ä½åˆ†é…å’Œå›æ”¶</li>
<li><strong>é¡µé¢å¯¹é½</strong>: è®°å½•æŒ‰é¡µé¢è¾¹ç•Œå¯¹é½</li>
<li><strong>é¢„åˆ†é…</strong>: é¿å…è¿è¡Œæ—¶å†…å­˜åˆ†é…</li>
</ul>
<h4 id="é«˜æ€§èƒ½crudæ“ä½œè®¾è®¡"><a class="header" href="#é«˜æ€§èƒ½crudæ“ä½œè®¾è®¡">é«˜æ€§èƒ½CRUDæ“ä½œè®¾è®¡</a></h4>
<p><strong>æ“ä½œæµæ°´çº¿æ¶æ„</strong>:</p>
<pre><code>CRUDæ“ä½œæµç¨‹:
è¯·æ±‚ â†’ æ§½ä½åˆ†é… â†’ æ•°æ®å†™å…¥ â†’ ç´¢å¼•æ›´æ–° â†’ ç»Ÿè®¡æ›´æ–°
  â†“       â†“         â†“         â†“         â†“
è§£æ    ä½å›¾æ“ä½œ   å†…å­˜æ‹·è´   ç´¢å¼•æ’å…¥   è®¡æ•°å™¨
</code></pre>
<p><strong>æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</strong>:</p>
<ul>
<li><strong>æ‰¹é‡æ“ä½œ</strong>: æ‰¹é‡å¤„ç†å¤šä¸ªè®°å½•</li>
<li><strong>å‘é‡åŒ–</strong>: ä½¿ç”¨SIMDæŒ‡ä»¤åŠ é€Ÿ</li>
<li><strong>é¢„å–ä¼˜åŒ–</strong>: æ™ºèƒ½å†…å­˜é¢„å–</li>
<li><strong>å¹¶è¡Œå¤„ç†</strong>: å¤šçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œ</li>
</ul>
<h3 id="22-ç´¢å¼•ç®¡ç†ç³»ç»Ÿè®¾è®¡-index-management-system"><a class="header" href="#22-ç´¢å¼•ç®¡ç†ç³»ç»Ÿè®¾è®¡-index-management-system">2.2 ç´¢å¼•ç®¡ç†ç³»ç»Ÿè®¾è®¡ (Index Management System)</a></h3>
<h4 id="ä¸»ç´¢å¼•æ¶æ„è®¾è®¡"><a class="header" href="#ä¸»ç´¢å¼•æ¶æ„è®¾è®¡">ä¸»ç´¢å¼•æ¶æ„è®¾è®¡</a></h4>
<p><strong>RecordIDåˆ°SlotIndexæ˜ å°„</strong>:</p>
<pre><code>ä¸»ç´¢å¼•ç»“æ„:
RecordID(64bit) â†’ å“ˆå¸Œå‡½æ•° â†’ æ¡¶ä½ç½® â†’ SlotIndex
       â†“            â†“          â†“         â†“
   Snowflakeæ ¼å¼   ä¸€è‡´æ€§å“ˆå¸Œ   å“ˆå¸Œæ¡¶   æ§½ä½ä½ç½®
</code></pre>
<p><strong>è®¾è®¡ç‰¹æ€§</strong>:</p>
<ul>
<li><strong>å“ˆå¸Œç´¢å¼•</strong>: O(1)æŸ¥æ‰¾æ€§èƒ½</li>
<li><strong>Snowflake ID</strong>: å…¨å±€å”¯ä¸€ã€æ—¶é—´æ’åº</li>
<li><strong>å†²çªè§£å†³</strong>: é“¾å¼å†²çªè§£å†³</li>
<li><strong>å†…å­˜å¸¸é©»</strong>: ç´¢å¼•å®Œå…¨åœ¨å†…å­˜ä¸­</li>
</ul>
<h4 id="äºŒçº§ç´¢å¼•æ¶æ„"><a class="header" href="#äºŒçº§ç´¢å¼•æ¶æ„">äºŒçº§ç´¢å¼•æ¶æ„</a></h4>
<p><strong>å­—æ®µå€¼åˆ°RecordIDé›†åˆæ˜ å°„</strong>:</p>
<pre><code>äºŒçº§ç´¢å¼•ç±»å‹:
â”œâ”€â”€ å“ˆå¸Œç´¢å¼• (ç­‰å€¼æŸ¥è¯¢)
â”‚   â”œâ”€â”€ å­—æ®µå€¼ â†’ RecordIDåˆ—è¡¨
â”‚   â””â”€â”€ O(1)æŸ¥æ‰¾æ€§èƒ½
â”œâ”€â”€ B+æ ‘ç´¢å¼• (èŒƒå›´æŸ¥è¯¢)
â”‚   â”œâ”€â”€ æœ‰åºå­—æ®µå€¼ â†’ RecordIDåˆ—è¡¨
â”‚   â””â”€â”€ O(log n)æŸ¥æ‰¾æ€§èƒ½
â””â”€â”€ ç»„åˆç´¢å¼• (å¤šå­—æ®µæŸ¥è¯¢)
    â”œâ”€â”€ ç»„åˆé”® â†’ RecordIDåˆ—è¡¨
    â””â”€â”€ å¤æ‚æŸ¥è¯¢ä¼˜åŒ–
</code></pre>
<p><strong>ç´¢å¼•ä¼˜åŒ–ç­–ç•¥</strong>:</p>
<ul>
<li><strong>ç´¢å¼•é€‰æ‹©</strong>: æ™ºèƒ½ç´¢å¼•é€‰æ‹©ç®—æ³•</li>
<li><strong>ç´¢å¼•å‹ç¼©</strong>: å‡å°‘å†…å­˜å ç”¨</li>
<li><strong>å¢é‡æ›´æ–°</strong>: é¿å…å…¨é‡é‡å»º</li>
<li><strong>å¹¶å‘è®¿é—®</strong>: è¯»å†™é”ä¼˜åŒ–</li>
</ul>
<h3 id="23-æŸ¥è¯¢æ‰§è¡Œå¼•æ“è®¾è®¡-query-executor"><a class="header" href="#23-æŸ¥è¯¢æ‰§è¡Œå¼•æ“è®¾è®¡-query-executor">2.3 æŸ¥è¯¢æ‰§è¡Œå¼•æ“è®¾è®¡ (Query Executor)</a></h3>
<h4 id="æŸ¥è¯¢å¤„ç†æµæ°´çº¿"><a class="header" href="#æŸ¥è¯¢å¤„ç†æµæ°´çº¿">æŸ¥è¯¢å¤„ç†æµæ°´çº¿</a></h4>
<p><strong>äº”é˜¶æ®µæŸ¥è¯¢å¤„ç†</strong>:</p>
<pre><code>æŸ¥è¯¢å¤„ç†æµç¨‹:
æŸ¥è¯¢è§£æ â†’ æŸ¥è¯¢ä¼˜åŒ– â†’ æ‰§è¡Œè®¡åˆ’ â†’ å¹¶è¡Œæ‰§è¡Œ â†’ ç»“æœæ±‡èš
   â†“         â†“         â†“         â†“         â†“
 è¯­æ³•åˆ†æ   æˆæœ¬ä¼°ç®—   æ“ä½œåºåˆ—   å¹¶å‘å¤„ç†   ç»“æœç»„è£…
</code></pre>
<p><strong>ä¼˜åŒ–ç­–ç•¥</strong>:</p>
<ul>
<li><strong>è®¡åˆ’ç¼“å­˜</strong>: ç¼“å­˜å¸¸ç”¨æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’</li>
<li><strong>ç»Ÿè®¡é©±åŠ¨</strong>: åŸºäºç»Ÿè®¡ä¿¡æ¯çš„æŸ¥è¯¢ä¼˜åŒ–</li>
<li><strong>å¹¶è¡Œæ‰§è¡Œ</strong>: å¤šçº¿ç¨‹å¹¶è¡ŒæŸ¥è¯¢å¤„ç†</li>
<li><strong>ç»“æœç¼“å­˜</strong>: æŸ¥è¯¢ç»“æœæ™ºèƒ½ç¼“å­˜</li>
</ul>
<h4 id="ç‰¹åŒ–æŸ¥è¯¢ä¼˜åŒ–"><a class="header" href="#ç‰¹åŒ–æŸ¥è¯¢ä¼˜åŒ–">ç‰¹åŒ–æŸ¥è¯¢ä¼˜åŒ–</a></h4>
<p><strong>é’ˆå¯¹å†…ç½‘ç¯å¢ƒçš„æŸ¥è¯¢ä¼˜åŒ–</strong>:</p>
<ul>
<li><strong>ç‚¹æŸ¥è¯¢å¿«é€Ÿè·¯å¾„</strong>: ç»•è¿‡é€šç”¨æŸ¥è¯¢å¼•æ“</li>
<li><strong>æ‰¹é‡æŸ¥è¯¢</strong>: æ‰¹é‡å¤„ç†ç›¸ä¼¼æŸ¥è¯¢</li>
<li><strong>é¢„ç¼–è¯‘æŸ¥è¯¢</strong>: é¢„ç¼–è¯‘å¸¸ç”¨æŸ¥è¯¢æ¨¡å¼</li>
<li><strong>ç´¢å¼•æç¤º</strong>: æ˜¾å¼ç´¢å¼•é€‰æ‹©</li>
</ul>
<h3 id="24-å†…å­˜ç®¡ç†å™¨è®¾è®¡-memory-manager"><a class="header" href="#24-å†…å­˜ç®¡ç†å™¨è®¾è®¡-memory-manager">2.4 å†…å­˜ç®¡ç†å™¨è®¾è®¡ (Memory Manager)</a></h3>
<h4 id="numaæ„ŸçŸ¥å†…å­˜åˆ†é…"><a class="header" href="#numaæ„ŸçŸ¥å†…å­˜åˆ†é…">NUMAæ„ŸçŸ¥å†…å­˜åˆ†é…</a></h4>
<p><strong>åˆ†å±‚å†…å­˜ç®¡ç†</strong>:</p>
<pre><code>å†…å­˜ç®¡ç†å±‚æ¬¡:
åº”ç”¨è¯·æ±‚ â†’ NUMAåˆ†é…å™¨ â†’ é¡µé¢åˆ†é…å™¨ â†’ ç³»ç»Ÿå†…å­˜
    â†“         â†“           â†“           â†“
  å†…å­˜éœ€æ±‚   æœ¬åœ°èŠ‚ç‚¹    é¡µé¢å¯¹é½     ç‰©ç†å†…å­˜
</code></pre>
<p><strong>ä¼˜åŒ–ç­–ç•¥</strong>:</p>
<ul>
<li><strong>æœ¬åœ°åˆ†é…</strong>: ä¼˜å…ˆä»æœ¬åœ°NUMAèŠ‚ç‚¹åˆ†é…</li>
<li><strong>å¤§é¡µé¢</strong>: ä½¿ç”¨2MBå¤§é¡µé¢å‡å°‘TLBå‹åŠ›</li>
<li><strong>é¢„åˆ†é…</strong>: å¯åŠ¨æ—¶é¢„åˆ†é…å¤§å—å†…å­˜</li>
<li><strong>ç¢ç‰‡æ•´ç†</strong>: å®šæœŸå†…å­˜ç¢ç‰‡æ•´ç†</li>
</ul>
<h2 id="ç¬¬ä¸‰å±‚æŒä¹…åŒ–å¼•æ“ç»„ä»¶è®¾è®¡"><a class="header" href="#ç¬¬ä¸‰å±‚æŒä¹…åŒ–å¼•æ“ç»„ä»¶è®¾è®¡">ç¬¬ä¸‰å±‚ï¼šæŒä¹…åŒ–å¼•æ“ç»„ä»¶è®¾è®¡</a></h2>
<h3 id="31-walå†™å…¥å¼•æ“è®¾è®¡-wal-engine"><a class="header" href="#31-walå†™å…¥å¼•æ“è®¾è®¡-wal-engine">3.1 WALå†™å…¥å¼•æ“è®¾è®¡ (WAL Engine)</a></h3>
<p><strong>è®¾è®¡ç›®æ ‡</strong>: å»¶è¿Ÿé¢„ç®— 0.5ms</p>
<h4 id="é«˜é€Ÿwalæ¶æ„"><a class="header" href="#é«˜é€Ÿwalæ¶æ„">é«˜é€ŸWALæ¶æ„</a></h4>
<p><strong>WALå†™å…¥æµæ°´çº¿</strong>:</p>
<pre><code>WALå†™å…¥æµç¨‹:
äº‹åŠ¡æäº¤ â†’ æ—¥å¿—æ„å»º â†’ æ‰¹é‡å†™å…¥ â†’ åˆ·ç›˜ç¡®è®¤
    â†“         â†“         â†“         â†“
  äº‹åŠ¡æ•°æ®   æ—¥å¿—è®°å½•   ç”¨æˆ·æ€I/O   æŒä¹…åŒ–ç¡®è®¤
</code></pre>
<p><strong>æ€§èƒ½ä¼˜åŒ–</strong>:</p>
<ul>
<li><strong>æ‰¹é‡å†™å…¥</strong>: èšåˆå¤šä¸ªäº‹åŠ¡çš„æ—¥å¿—è®°å½•</li>
<li><strong>ç”¨æˆ·æ€I/O</strong>: ä½¿ç”¨SPDKç»•è¿‡å†…æ ¸</li>
<li><strong>å¹¶è¡Œå†™å…¥</strong>: å¤šä¸ªWALå†™å…¥å™¨å¹¶è¡Œå·¥ä½œ</li>
<li><strong>å‹ç¼©ä¼˜åŒ–</strong>: å®æ—¶æ—¥å¿—å‹ç¼©</li>
</ul>
<h3 id="32-å¼‚æ­¥åˆ·ç›˜ç®¡ç†è®¾è®¡-async-flush-manager"><a class="header" href="#32-å¼‚æ­¥åˆ·ç›˜ç®¡ç†è®¾è®¡-async-flush-manager">3.2 å¼‚æ­¥åˆ·ç›˜ç®¡ç†è®¾è®¡ (Async Flush Manager)</a></h3>
<h4 id="æ™ºèƒ½åˆ·ç›˜ç­–ç•¥"><a class="header" href="#æ™ºèƒ½åˆ·ç›˜ç­–ç•¥">æ™ºèƒ½åˆ·ç›˜ç­–ç•¥</a></h4>
<p><strong>å¤šå±‚åˆ·ç›˜æ¶æ„</strong>:</p>
<pre><code>åˆ·ç›˜ç®¡ç†å±‚æ¬¡:
çƒ­é¡µé¢ â†’ åˆ·ç›˜é˜Ÿåˆ— â†’ æ‰¹é‡I/O â†’ å­˜å‚¨è®¾å¤‡
  â†“        â†“         â†“         â†“
è„é¡µç›‘æ§  ä¼˜å…ˆçº§é˜Ÿåˆ—  åˆå¹¶I/O   NVMeè®¾å¤‡
</code></pre>
<p><strong>ä¼˜åŒ–ç­–ç•¥</strong>:</p>
<ul>
<li><strong>é¡µé¢çº§åˆ·ç›˜</strong>: æŒ‰é¡µé¢æ‰¹é‡åˆ·ç›˜</li>
<li><strong>ä¼˜å…ˆçº§è°ƒåº¦</strong>: çƒ­é¡µé¢ä¼˜å…ˆåˆ·ç›˜</li>
<li><strong>I/Oåˆå¹¶</strong>: åˆå¹¶ç›¸é‚»é¡µé¢çš„I/Oæ“ä½œ</li>
<li><strong>åå°å¤„ç†</strong>: ä¸å½±å“å‰å°ä¸šåŠ¡å¤„ç†</li>
</ul>
<h3 id="33-æ¢å¤åè°ƒå™¨è®¾è®¡-recovery-coordinator"><a class="header" href="#33-æ¢å¤åè°ƒå™¨è®¾è®¡-recovery-coordinator">3.3 æ¢å¤åè°ƒå™¨è®¾è®¡ (Recovery Coordinator)</a></h3>
<h4 id="å¿«é€Ÿæ¢å¤æœºåˆ¶"><a class="header" href="#å¿«é€Ÿæ¢å¤æœºåˆ¶">å¿«é€Ÿæ¢å¤æœºåˆ¶</a></h4>
<p><strong>æ¢å¤æµç¨‹è®¾è®¡</strong>:</p>
<pre><code>æ¢å¤å¤„ç†æµç¨‹:
æ•…éšœæ£€æµ‹ â†’ çŠ¶æ€åˆ†æ â†’ æ•°æ®ä¿®å¤ â†’ ä¸€è‡´æ€§éªŒè¯
   â†“         â†“         â†“         â†“
å¼‚å¸¸è¯†åˆ«   æŸåè¯„ä¼°   WALå›æ”¾   å®Œæ•´æ€§æ£€æŸ¥
</code></pre>
<p><strong>æ¢å¤ä¼˜åŒ–</strong>:</p>
<ul>
<li><strong>å¢é‡æ¢å¤</strong>: åªæ¢å¤å¿…è¦çš„æ•°æ®</li>
<li><strong>å¹¶è¡Œæ¢å¤</strong>: å¤šçº¿ç¨‹å¹¶è¡Œæ•°æ®ä¿®å¤</li>
<li><strong>æ£€æŸ¥ç‚¹</strong>: å®šæœŸåˆ›å»ºæ¢å¤æ£€æŸ¥ç‚¹</li>
<li><strong>å¿«é€ŸéªŒè¯</strong>: é«˜æ•ˆçš„ä¸€è‡´æ€§æ£€æŸ¥</li>
</ul>
<h2 id="ç¬¬å››å±‚ç¡¬ä»¶æŠ½è±¡å±‚ç»„ä»¶è®¾è®¡"><a class="header" href="#ç¬¬å››å±‚ç¡¬ä»¶æŠ½è±¡å±‚ç»„ä»¶è®¾è®¡">ç¬¬å››å±‚ï¼šç¡¬ä»¶æŠ½è±¡å±‚ç»„ä»¶è®¾è®¡</a></h2>
<h3 id="41-å­˜å‚¨æ¥å£è®¾è®¡-storage-interface"><a class="header" href="#41-å­˜å‚¨æ¥å£è®¾è®¡-storage-interface">4.1 å­˜å‚¨æ¥å£è®¾è®¡ (Storage Interface)</a></h3>
<h4 id="ç”¨æˆ·æ€nvmeè®¿é—®"><a class="header" href="#ç”¨æˆ·æ€nvmeè®¿é—®">ç”¨æˆ·æ€NVMeè®¿é—®</a></h4>
<p><strong>ç›´æ¥è®¾å¤‡è®¿é—®æ¶æ„</strong>:</p>
<pre><code>å­˜å‚¨è®¿é—®è·¯å¾„:
åº”ç”¨è¯·æ±‚ â†’ SPDKé©±åŠ¨ â†’ NVMeé˜Ÿåˆ— â†’ å­˜å‚¨è®¾å¤‡
   â†“         â†“         â†“         â†“
 I/Oè¯·æ±‚   ç”¨æˆ·æ€é©±åŠ¨  ç¡¬ä»¶é˜Ÿåˆ—   NVMe SSD
</code></pre>
<p><strong>æ€§èƒ½ç‰¹æ€§</strong>:</p>
<ul>
<li><strong>ç»•è¿‡å†…æ ¸</strong>: ç”¨æˆ·æ€ç›´æ¥è®¾å¤‡è®¿é—®</li>
<li><strong>æ‰¹é‡I/O</strong>: æ‰¹é‡æäº¤I/Oè¯·æ±‚</li>
<li><strong>ä¸­æ–­ä¼˜åŒ–</strong>: ä¸­æ–­ç»‘å®šå’Œè½®è¯¢æ¨¡å¼</li>
<li><strong>é˜Ÿåˆ—ç®¡ç†</strong>: å¤šé˜Ÿåˆ—å¹¶è¡ŒI/O</li>
</ul>
<h3 id="42-å†…å­˜æ¥å£è®¾è®¡-memory-interface"><a class="header" href="#42-å†…å­˜æ¥å£è®¾è®¡-memory-interface">4.2 å†…å­˜æ¥å£è®¾è®¡ (Memory Interface)</a></h3>
<h4 id="numaä¼˜åŒ–å†…å­˜ç®¡ç†"><a class="header" href="#numaä¼˜åŒ–å†…å­˜ç®¡ç†">NUMAä¼˜åŒ–å†…å­˜ç®¡ç†</a></h4>
<p><strong>å†…å­˜æ‹“æ‰‘æ„ŸçŸ¥</strong>:</p>
<pre><code>NUMAå†…å­˜ç®¡ç†:
å†…å­˜è¯·æ±‚ â†’ NUMAæ£€æµ‹ â†’ æœ¬åœ°åˆ†é… â†’ è·¨èŠ‚ç‚¹fallback
   â†“         â†“         â†“         â†“
åˆ†é…éœ€æ±‚   èŠ‚ç‚¹æ‹“æ‰‘   æœ¬åœ°å†…å­˜   è¿œç¨‹å†…å­˜
</code></pre>
<p><strong>ä¼˜åŒ–ç­–ç•¥</strong>:</p>
<ul>
<li><strong>æ‹“æ‰‘æ„ŸçŸ¥</strong>: è‡ªåŠ¨æ£€æµ‹NUMAæ‹“æ‰‘</li>
<li><strong>æœ¬åœ°ä¼˜å…ˆ</strong>: ä¼˜å…ˆæœ¬åœ°èŠ‚ç‚¹å†…å­˜åˆ†é…</li>
<li><strong>å¤§é¡µé¢</strong>: é€æ˜å¤§é¡µé¢æ”¯æŒ</li>
<li><strong>é¢„å–ä¼˜åŒ–</strong>: ç¡¬ä»¶é¢„å–ä¼˜åŒ–</li>
</ul>
<h3 id="43-ç½‘ç»œæ¥å£è®¾è®¡-network-interface"><a class="header" href="#43-ç½‘ç»œæ¥å£è®¾è®¡-network-interface">4.3 ç½‘ç»œæ¥å£è®¾è®¡ (Network Interface)</a></h3>
<h4 id="é›¶æ‹·è´ç½‘ç»œä¼˜åŒ–"><a class="header" href="#é›¶æ‹·è´ç½‘ç»œä¼˜åŒ–">é›¶æ‹·è´ç½‘ç»œä¼˜åŒ–</a></h4>
<p><strong>ç½‘ç»œå¤„ç†ä¼˜åŒ–</strong>:</p>
<pre><code>ç½‘ç»œå¤„ç†è·¯å¾„:
ç½‘ç»œæ•°æ® â†’ DMAç¼“å†² â†’ åº”ç”¨ç¼“å†² â†’ å¤„ç†é€»è¾‘
   â†“         â†“         â†“         â†“
æ•°æ®åŒ…    é›¶æ‹·è´æ¥æ”¶  å†…å­˜è§†å›¾   ç›´æ¥å¤„ç†
</code></pre>
<p><strong>å†…ç½‘ä¼˜åŒ–</strong>:</p>
<ul>
<li><strong>RDMAæ”¯æŒ</strong>: è¿œç¨‹ç›´æ¥å†…å­˜è®¿é—®</li>
<li><strong>SR-IOV</strong>: è™šæ‹ŸåŒ–ç¯å¢ƒç½‘ç»œä¼˜åŒ–</li>
<li><strong>ä¸­æ–­åˆå¹¶</strong>: å‡å°‘ç½‘ç»œä¸­æ–­å¼€é”€</li>
<li><strong>æ‰¹é‡å¤„ç†</strong>: æ‰¹é‡ç½‘ç»œæ•°æ®å¤„ç†</li>
</ul>
<h2 id="ç»„ä»¶é—´åä½œè®¾è®¡"><a class="header" href="#ç»„ä»¶é—´åä½œè®¾è®¡">ç»„ä»¶é—´åä½œè®¾è®¡</a></h2>
<h3 id="ç»„ä»¶å…³ç³»æ€»è§ˆ"><a class="header" href="#ç»„ä»¶å…³ç³»æ€»è§ˆ">ç»„ä»¶å…³ç³»æ€»è§ˆ</a></h3>
<pre><code class="language-mermaid">graph TB
    subgraph "ç»„ä»¶åä½œå…³ç³»å›¾"
        subgraph "ç¬¬ä¸€å±‚ï¼šé«˜æ€§èƒ½æ¥å£å±‚ (0.5ms)"
            A[åè®®å¤„ç†å™¨&lt;br/&gt;gRPC/TCPä¼˜åŒ–]
            B[è¿æ¥ç®¡ç†å™¨&lt;br/&gt;é›¶æ‹·è´ç¼“å†²]
            C[ç›‘æ§æ”¶é›†å™¨&lt;br/&gt;è½»é‡çº§æŒ‡æ ‡]
        end

        subgraph "ç¬¬äºŒå±‚ï¼šå­˜å‚¨å¼•æ“æ ¸å¿ƒ (6ms)"
            D[è¡¨ç®¡ç†å¼•æ“&lt;br/&gt;è®°å½•CRUD]
            E[ç´¢å¼•ç®¡ç†ç³»ç»Ÿ&lt;br/&gt;ä¸»ç´¢å¼•+äºŒçº§ç´¢å¼•]
            F[æŸ¥è¯¢æ‰§è¡Œå¼•æ“&lt;br/&gt;ä¼˜åŒ–æ‰§è¡Œ]
            G[å†…å­˜ç®¡ç†å™¨&lt;br/&gt;NUMAæ„ŸçŸ¥]
        end

        subgraph "ç¬¬ä¸‰å±‚ï¼šæŒä¹…åŒ–å¼•æ“ (0.5ms)"
            H[WALå†™å…¥å¼•æ“&lt;br/&gt;é«˜é€Ÿæ—¥å¿—]
            I[å¼‚æ­¥åˆ·ç›˜ç®¡ç†&lt;br/&gt;æ™ºèƒ½åˆ·ç›˜]
            J[æ¢å¤åè°ƒå™¨&lt;br/&gt;æ•…éšœæ¢å¤]
        end

        subgraph "ç¬¬å››å±‚ï¼šç¡¬ä»¶æŠ½è±¡å±‚ (0.4ms)"
            K[å­˜å‚¨æ¥å£&lt;br/&gt;ç”¨æˆ·æ€NVMe]
            L[å†…å­˜æ¥å£&lt;br/&gt;NUMA+å¤§é¡µé¢]
            M[ç½‘ç»œæ¥å£&lt;br/&gt;RDMAé›¶æ‹·è´]
        end
    end

    A --&gt; D
    B --&gt; D
    C --&gt; A
    
    D --&gt; E
    D --&gt; F
    D --&gt; G
    E --&gt; F
    
    F --&gt; H
    G --&gt; H
    H --&gt; I
    I --&gt; J
    
    H --&gt; K
    I --&gt; K
    G --&gt; L
    A --&gt; M

    classDef layer1 fill:#e1f5fe
    classDef layer2 fill:#f3e5f5
    classDef layer3 fill:#e8f5e8
    classDef layer4 fill:#fff3e0
    
    class A,B,C layer1
    class D,E,F,G layer2
    class H,I,J layer3
    class K,L,M layer4
</code></pre>
<h3 id="æ•°æ®æµåä½œæœºåˆ¶"><a class="header" href="#æ•°æ®æµåä½œæœºåˆ¶">æ•°æ®æµåä½œæœºåˆ¶</a></h3>
<p><strong>è¯·æ±‚å¤„ç†æµç¨‹</strong>:</p>
<pre><code>å®¢æˆ·ç«¯è¯·æ±‚ â†’ åè®®å¤„ç†å™¨ â†’ è¡¨ç®¡ç†å¼•æ“ â†’ ç´¢å¼•ç³»ç»Ÿ â†’ æŸ¥è¯¢æ‰§è¡Œå™¨
     â†“            â†“            â†“           â†“           â†“
   ç½‘ç»œæ•°æ®      åè®®è§£æ      è®°å½•æ“ä½œ     ç´¢å¼•æŸ¥æ‰¾    æŸ¥è¯¢ä¼˜åŒ–
     â†“            â†“            â†“           â†“           â†“
å†…å­˜ç®¡ç†å™¨ â†’ WALå¼•æ“ â†’ ç¡¬ä»¶æ¥å£ â†’ å­˜å‚¨è®¾å¤‡ â†’ å¼‚æ­¥åˆ·ç›˜
     â†“         â†“        â†“         â†“          â†“
  å†…å­˜åˆ†é…    æ—¥å¿—å†™å…¥   ç”¨æˆ·æ€I/O  æŒä¹…åŒ–     åå°åˆ·ç›˜
</code></pre>
<h3 id="æ€§èƒ½åè°ƒæœºåˆ¶"><a class="header" href="#æ€§èƒ½åè°ƒæœºåˆ¶">æ€§èƒ½åè°ƒæœºåˆ¶</a></h3>
<p><strong>è·¨ç»„ä»¶æ€§èƒ½ä¼˜åŒ–</strong>:</p>
<ul>
<li><strong>å»¶è¿Ÿé¢„ç®—åè°ƒ</strong>: å„ç»„ä»¶ä¸¥æ ¼éµå®ˆå»¶è¿Ÿé¢„ç®—</li>
<li><strong>èµ„æºäº‰ç”¨é¿å…</strong>: æ™ºèƒ½èµ„æºè°ƒåº¦é¿å…ç»„ä»¶é—´äº‰ç”¨</li>
<li><strong>åé¦ˆæœºåˆ¶</strong>: æ€§èƒ½ç›‘æ§é©±åŠ¨çš„è‡ªé€‚åº”ä¼˜åŒ–</li>
<li><strong>é™çº§ç­–ç•¥</strong>: è¿‡è½½æ—¶çš„åŠŸèƒ½é™çº§æœºåˆ¶</li>
</ul>
<p>è¿™ä¸ªè®¾è®¡æ–¹æ¡ˆä¸“æ³¨äºæ¶æ„å±‚é¢çš„ç»„ä»¶è®¾è®¡ï¼Œé¿å…äº†å…·ä½“çš„ä»£ç å®ç°ç»†èŠ‚ï¼Œæ›´ç¬¦åˆç³»ç»Ÿè®¾è®¡å¸ˆçš„è§†è§’ã€‚</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
